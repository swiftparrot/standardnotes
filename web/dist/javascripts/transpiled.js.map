{"version":3,"sources":["app.js"],"names":["Object","defineProperty","exports","value","SNTheme","SNSmartTag","SNServerExtension","SNMfa","SNEncryptedStorage","SNTag","SNNote","SNExtension","Action","SNEditor","SNComponent","SNComponentManager","undefined","_get","get","object","property","receiver","Function","prototype","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","getter","call","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","_standardFileJs","require","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","TypeError","create","constructor","setPrototypeOf","__proto__","_asyncToGenerator","fn","gen","apply","arguments","Promise","resolve","reject","step","arg","info","error","done","then","err","_classCallCheck","instance","_ref","modelManager","syncManager","desktopManager","nativeExtManager","alertManager","$uiRunner","$timeout","environment","platform","ClientDataDomain","setTimeout","bind","window","streamObservers","contextStreamObservers","activeComponents","isDesktop","isMobile","configureForNonMobileUsage","configureForGeneralUsage","permissionDialogs","handlers","_this","addItemSyncObserver","allItems","validItems","deletedItems","source","sourceKey","syncedComponents","filter","item","content_type","SFModelManager","MappingSourceRemoteSaved","syncComponentsInstallation","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","Symbol","iterator","_step","next","component","activeComponent","_","find","uuid","active","deleted","activateComponent","deactivateComponent","return","_loop","observer","relevantItems","contentTypes","indexOf","requiredPermissions","name","content_types","sort","runWithPermissions","sendItemsInReply","originalMessage","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_ret","requiredContextPermissions","_loop2","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","handler","areas","includes","area","contextRequestHandler","itemInContext","matchingItem","sendContextItemInReply","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","_ret2","_this2","detectFocusChange","event","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","document","activeElement","iframeForComponent","focusChangedForComponent","addEventListener","attachEvent","registerUpdateObserver","isTheme","postActiveThemesToAllComponents","loggingEnabled","console","log","data","sessionKey","handleMessage","componentForSessionKey","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_iterator6","components","_step6","postActiveThemesToComponent","getActiveThemes","componentsForArea","theme","urlsForActiveThemes","_this3","themes","map","urlForComponent","urls","sendMessageToComponent","action","contextItemDidChangeInArea","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_iterator7","_step7","observers","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_iterator8","_step8","setComponentHidden","hidden","contextObserver","identifier","handleStreamContextItemMessage","streamObserver","handleStreamItemsMessage","jsonForItem","params","created_at","updated_at","content","createContentJSONFromProperties","clientData","getDomainDataItem","getClientDataKey","MappingSourceLocalSaved","isMetadataUpdate","removePrivatePropertiesFromResponseItems","type","items","message","_this4","response","mapped","replyToMessage","replyData","reply","original","permissibleActionsWhileHidden","origin","startsWith","location","href","alert","text","JSON","stringify","postMessage","offlinePrefix","offlineOnly","local_url","replace","getApplicationDataPath","url","hosted_url","legacy_url","localReplacement","componentForUrl","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_iterator9","_step9","componentForSessionKeyHandler","_this5","readwriteActions","readonly","handleSetComponentDataMessage","handleDeleteItemsMessage","handleCreateItemsMessage","handleSaveItemsMessage","componentToToggle","findItem","handleToggleComponentMessage","handleRequestPermissionsMessage","handleInstallLocalComponentMessage","handleDuplicateItemMessage","_loop3","actionHandler","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_iterator10","_step10","responseItems","options","privateTopLevelProperties","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","responseItem","setDirty","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_iterator12","_step12","privateProperty","isSystemExtension","privateContentProperties","includeUrls","concat","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_iterator13","_step13","_responseItem","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_iterator14","_step14","prop","_this6","push","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_iterator15","_step15","contentType","validItemsForContentType","_this7","_iteratorNormalCompletion16","_didIteratorError16","_iteratorError16","_iterator16","handlersForArea","_step16","isItemIdWithinComponentContextJurisdiction","itemIdsInJurisdiction","itemIdsInContextJurisdictionForComponent","itemIds","_iteratorNormalCompletion17","_didIteratorError17","_iteratorError17","_iterator17","_step17","candidate","_ref2","mark","_callee2","_this8","itemIdsInContextJurisdiction","pendingResponseItems","_iteratorNormalCompletion18","_didIteratorError18","_iteratorError18","_iterator18","_step18","requiredContentTypes","wrap","_callee2$","_context2","prev","slice","pull","abrupt","t0","finish","uniq","_callee","ids","lockedCount","_iteratorNormalCompletion19","_didIteratorError19","_iteratorError19","_iterator19","_step19","itemNoun","auxVerb","localItems","_iteratorNormalCompletion20","_didIteratorError20","_iteratorError20","_iterator20","_step20","_responseItem2","_item","_callee$","_context","findItems","locked","remove","title","mapResponseItemsToLocalModels","MappingSourceComponentRetrieved","sent","setDomainDataItem","setItemDirty","t1","sync","saveMessage","assign","stop","_x3","_x4","_this9","itemParams","duplicate","duplicateItemAndAdd","_this10","uniqueContentTypes","processedItems","_iteratorNormalCompletion21","_didIteratorError21","_iteratorError21","_iterator21","_step21","createItem","addItem","resolveReferencesForItem","_this11","_callee3","itemsData","noun","didConfirm","_iteratorNormalCompletion22","_didIteratorError22","_iteratorError22","_iterator22","_step22","itemData","model","_callee3$","_context3","confirm","catch","setItemToBeDeleted","notifySyncObserversOfModels","_this12","permissions","approved","_this13","componentData","sourceComponent","targetComponent","toggleComponent","_this14","openModalComponent","activeThemes","isLayerable","_iteratorNormalCompletion23","_didIteratorError23","_iteratorError23","_iterator23","_step23","installComponent","runFunction","parse","acquiredPermissions","_loop4","required","respectiveAcquired","_iteratorNormalCompletion25","_didIteratorError25","_iteratorError25","_iterator25","_step25","acquiredContentType","_iteratorNormalCompletion24","_didIteratorError24","_iteratorError24","_iterator24","_step24","_ret4","promptForPermissions","callback","_this15","permissionsString","permissionsStringForPermissions","actionBlock","_loop5","permission","matchingPermission","_iteratorNormalCompletion26","_didIteratorError26","_iteratorError26","_iterator26","_step26","pendingDialog","containsObjectSubset","some","val","presentPermissionsDialog","existingDialog","dialog","registerHandler","deregisterHandler","splice","_ref5","_callee4","componentWindow","_callee4$","_context4","SFJS","crypto","generateUUID","activeThemeUrls","notifyComponentActivation","registerComponentWindow","_x5","_x6","_this16","dontSync","didChange","_loop6","activationHandler","_iteratorNormalCompletion27","_didIteratorError27","_iteratorError27","_iterator27","_step27","_this17","_loop7","_iteratorNormalCompletion28","_didIteratorError28","_iteratorError28","_iterator28","_step28","o","_ref6","_callee5","_this18","_loop8","_iteratorNormalCompletion29","_didIteratorError29","_iteratorError29","_iterator29","_step29","_callee5$","_context5","_iteratorNormalCompletion30","_didIteratorError30","_iteratorError30","_iterator30","_step30","reloadComponent","_x9","deleteComponent","isComponentActive","_iteratorNormalCompletion31","_didIteratorError31","_iteratorError31","_iterator31","Array","from","getElementsByTagName","_step31","frame","componentId","dataset","focused","_iteratorNormalCompletion32","_didIteratorError32","_iteratorError32","_iterator32","_step32","focusHandler","handleSetSizeEvent","setSize","element","size","widthString","width","heightString","height","setAttribute","selector","getElementById","iframe","parentElement","editorForNote","note","editors","_iteratorNormalCompletion33","_didIteratorError33","_iteratorError33","_iterator33","_step33","editor","isExplicitlyEnabledForItem","mobilePrefersPlainEditor","getDefaultEditor","getAppDataItem","e","isDefaultEditor","_this19","finalString","permissionsCount","addSeparator","index","forEach","types","humanReadableDisplayForContentType","typesString","mapping","allItemsMatchingTypes","_SFItem","json_obj","_this20","disassociatedItemIds","associatedItemIds","mapContentToLocalProperties","valid_until","Date","autoupdateDisabled","package_info","handleDeletedContent","structureParams","superParams","isEditor","setLastSize","setAppDataItem","getLastSize","acceptsThemes","hasValidHostedUrl","keysToIgnoreWhenCheckingContentEquality","isAssociative","Component","associativeAreas","associateWithItem","isExplicitlyDisabledForItem","SFItem","_SFItem2","_this21","notes","default","systemEditor","referenceParams","references","addItemAsRelationship","removeItemAsRelationship","removeAndDirtyAllRelationships","removeReferencesNotPresentIn","uuids","ref","potentialItemOfInterestHasChangedItsUUID","newItem","oldUUID","newUUID","setData","dataHasChanged","dataForKey","json","merge","running","lastExecuted","_SFItem3","_this22","actions","actionsWithContextForItem","context","description","supported_types","a","omit","_SFItem4","_this23","tags","setIsBeingReferencedBy","clearSavedTagsString","setIsNoLongerBeingReferencedBy","isBeingRemovedLocally","tag","informReferencesOfUUIDChange","_iteratorNormalCompletion34","_didIteratorError34","_iteratorError34","_iterator34","_step34","tagDidFinishSyncing","safeText","safeTitle","savedTagsString","tagsString","arrayToDisplayString","filterDummyNotes","filtered","dummy","_SFItem5","_this24","updateLocalRelationships","_this25","_iteratorNormalCompletion35","_didIteratorError35","_iteratorError35","_iterator35","_step35","didFinishSyncing","_iteratorNormalCompletion36","_didIteratorError36","_iteratorError36","_iterator36","_step36","isSmartTag","b","join","_SFItem6","storage","_SFItem7","doNotEncrypt","_SFItem8","_SNTag","json_ob","_this29","systemSmartTags","SystemSmartTagIdAllNotes","isSystemTag","isAllTag","predicate","SFPredicate","fromArray","SystemSmartTagIdArchivedNotes","isArchiveTag","SystemSmartTagIdTrashedNotes","isTrashTag","_SNComponent","_this30","layerable","setMobileRules","rules","getMobileRules","constants","hasMobileRules","setNotAvailOnMobile","na","getNotAvailOnMobile","setMobileActive","isMobileActive","SN","angular","module","getParameterByName","regex","RegExp","results","exec","decodeURIComponent","parametersFromURL","split","obj","m","getPlatformString","navigator","toLowerCase","trimmed","isDesktopApplication","process","versions","isMacApplication","containsPrimitiveSubset","array","searchElement","fromIndex","len","n","k","Math","max","abs","sameValueZero","x","y","isNaN","constant","config","$locationProvider","history","pushState","html5Mode","enabled","requireBase","NoteHistoryEntry","toLocaleString","hasPreviousEntry","textCharDiffLength","SFItemHistoryEntry","directive","$sce","restrict","scope","updateTags","templateUrl","controller","controllerAs","bindToController","link","elem","attrs","ctrl","$watch","oldNote","noteDidChange","authManager","$rootScope","actionsManager","themeManager","componentManager","storageManager","sessionHistory","privilegesManager","keyboardManager","spellcheck","componentStack","MinimumStatusDurationMs","addEventHandler","eventName","syncTakingTooLong","dirty","savedItem","savedItems","isInErrorState","saveError","showAllChangesSavedStatus","showErrorStatus","syncStatusObserver","registerSyncStatusObserver","status","localError","trashed","notifyDelete","isMappingSourceRetrieved","matchingNote","loadTagsString","hasRelationshipWithItem","reloadComponentStackArray","selectedEditor","reloadFont","setNote","reloadComponentContext","showExtensions","showMenu","noteStatus","altKeyDown","onReady","noteReady","loadPreferences","associatedEditor","focusTitle","saveNote","closeAllMenus","showEditorMenu","toggleMenu","menu","allMenus","editorMenuOnSelect","disassociateComponentWithCurrentNote","associateComponentWithCurrentNote","toggleStackComponentForCurrentItem","hasAvailableExtensions","extensionsInContextOfItem","focusEditor","delay","focus","clickedTextArea","EditorNgDebounce","SyncDebouce","SyncNoDebounce","bypassDebouncer","updateClientModified","dontUpdatePreviews","showSavingStatus","limit","truncate","preview_plain","substring","preview_html","saveTimeout","cancel","syncDebouceMs","offline","didShowErrorAlert","setStatus","wait","waitForMs","date","statusTimeout","contentChanged","onTitleEnter","$event","blur","onTitleChange","onNameFocus","editingName","onContentFocus","$broadcast","onNameBlur","selectedMenuItem","hide","deleteNote","permanently","run","actionRequiresPrivilege","PrivilegesManager","ActionDeleteNote","presentPrivilegesModal","restoreTrashedNote","deleteNotePermanantely","getTrashCount","trashedItems","emptyTrash","count","togglePin","pinned","toggleLockNote","toggleProtectNote","protected","actionHasPrivilegesConfigured","ActionViewProtectedNotes","configured","presentPrivilegesManagementModal","toggleNotePreview","hidePreview","toggleArchiveNote","archived","clickedEditNote","addTag","strings","_tag","removeTag","updateTagsFromTagsString","string","trim","leftResizeControl","rightResizeControl","onPanelResizeFinish","left","isMaxWidth","setUserPrefValue","setWidth","setLeft","syncUserPreferences","$on","monospaceFont","getUserPrefValue","defaultSpellcheckStatus","marginResizersEnabled","editable","style","fontFamily","toggleKey","flash","onEditorLoad","redoSearch","tagsComponent","container","id","altKeyObserver","addKeyObserver","modifiers","KeyboardManager","KeyModifierAlt","onKeyDown","onKeyUp","trashKeyObserver","KeyBackspace","notElementIds","KeyModifierMeta","deleteKeyObserver","KeyModifierShift","preventDefault","onSystemEditorLoad","loadedTabListener","tabObserver","KeyTab","shiftKey","insertSuccessful","execCommand","start","selectionStart","end","selectionEnd","spaces","on","removeKeyObserver","syncUpdated","findErrors","updateOfflineStatus","dbManager","passcodeManager","singletonManager","statusManager","checkForSecurityUpdate","available","securityUpdateAvailable","addStatusObserver","arbitraryStatusMessage","backupStatus","addStatusFromString","success","replaceStatusWithString","removeStatus","openSecurityUpdate","presentPasswordWizard","reloadExtendedData","reloadInProgress","extWindow","rooms","room","extensionsManagerIdentifier","queueExtReload","selectRoom","getUser","user","syncEvent","noteCount","showAccountMenu","outOfSync","syncStatus","onAuthSuccess","accountMenuPressed","closeAllRooms","toggleSyncResolutionMenu","showSyncResolution","closeAccountMenu","hasPasscode","lockApp","lockApplication","refreshData","isRefreshing","force","performIntegrityCheck","lastSyncDate","version","onNewUpdateAvailable","newUpdateAvailable","clickedNewUpdateAnnouncement","themesWithIcons","dock_icon","differ","reloadDockShortcuts","shortcuts","icon","dockShortcuts","aType","bType","initSvgForShortcut","shortcut","parser","DOMParser","svg","doc","parseFromString","appendChild","documentElement","selectShortcut","onRoomDismiss","showRoom","ActionManageExtensions","clickOutsideAccountMenu","authenticationInProgress","$scope","$location","migrationManager","server","urlParam","email","pw","getServerURL","signout","reload","login","autoSignInFromParams","initialize","isEphemeralSession","onUpdateAvailable","panel","notesCollapsed","collapsed","tagsCollapsed","appClass","initiateSync","loadInitialData","retrievedCount","showingDownloadStatus","total","uploadSyncStatus","current","setKeyRequestHandler","passcodeAuthParams","getAuthParams","auth_params","keys","lastSessionInvalidAlert","showInterval","encryptionEnabled","incrementalCallback","notesString","loadLocalItems","setInterval","SFAuthManager","DidSignOutEvent","handleSignout","load","openDatabase","isLocked","needsUnlock","onSuccessfulUnlock","setLocked","clearSyncToken","updateTagsForNote","stringTags","toRemove","tagToRemove","setItemsDirty","tagString","existingRelationship","findOrCreateTagByTitle","tagsSelectionMade","selectedTag","selectedNote","removeItemLocally","tagsAddNew","tagsSave","resortTag","safeApply","notesSelectionMade","notesAddNew","phase","$root","$$phase","$eval","$apply","search","LockScreen","onSuccess","formData","visibilityObserver","addVisibilityObserver","visible","input","removeVisibilityObserver","submitPasscodeForm","passcode","unlock","forgotPasscode","showRecovery","beginDeleteData","addNew","selectionMade","oldTag","tagDidChange","panelController","searchSubmitted","reloadNotes","DidSignInEvent","selectNote","createDummyOnSynCompletionIfNoNotes","createNewNote","loadFlagsForNote","cachedCreatedAtString","createdAtString","cachedUpdatedAtString","updatedAtString","selectFirstNote","setNotes","filterNotes","sortNotes","sortBy","sortReverse","shouldShowTags","shouldShowTagsForNote","reloadPanelTitle","errorDecrypting","reorderNotes","prevSortValue","showArchived","hidePinned","hideNotePreview","hideDate","hideTags","isCollapsed","onPanelResize","newWidth","lastLeft","isAtMaxWidth","ready","onNoteRemoval","visibleNotes","selectedIndex","onresize","resetPagination","keepCurrentIfLarger","paginate","notesToDisplay","DefaultNotesToDisplayValue","searchText","noteFilter","MinNoteHeight","clientHeight","isFiltering","panelTitle","optionsSubtitle","base","flags","class","conflict_of","scrollable","scrollTop","scrollLeft","initialDataLoaded","renderedNotes","selectNextNote","currentIndex","selectPreviousNote","viaClick","dummyNote","newNote","onFilterEnter","clearFilterText","filterTextChanged","togglePrefKey","selectedSortByCreated","setSortBy","selectedSortByUpdated","selectedSortByTitle","toggleReverseSort","canShowArchived","canShowPinned","isTrash","filterText","words","matchesTitle","every","word","matchesBody","reverse","sortValueFn","pinCheck","aValue","bValue","vector","result","newNoteKeyObserver","KeyModifierCtrl","getSearchBar","nextNoteKeyObserver","KeyDown","elements","body","searchBar","KeyUp","searchKeyObserver","save","smartTags","getSmartTags","selectTag","reloadNoteCounts","allTags","validNotes","cachedNoteCount","smartTag","notesMatchingSmartTag","clickedAddNewTag","editingTag","newTag","tagTitleDidChange","saveTag","originalTagName","savedTag","inputElementForTag","selectedRenameTag","selectedDeleteTag","ActionsManager","httpManager","$compile","previousPasswords","extensions","ext","extension","getAbsolute","item_uuid","updateExtensionFromRemoteResponse","customCallback","decrypted","access_type","triedPasswords","handleResponseDecryption","itemTransformer","decryptItem","MappingSourceRemoteActionRetrieved","mappedItem","passwordCandidate","computeEncryptionKeysForUser","keyResults","presentPasswordModal","password","verb","win","open","outgoingParamsForItem","performPost","SFItemParams","paramsForExtension","postAbsolute","$new","el","append","service","ArchiveManager","encrypted","downloadBackupOfItems","authParams","__itemsData","modifier","__downloadData","__formattedDate","__downloadZippedItems","ActionManageBackups","matches","match","getJSONDataForItems","blobData","Blob","zip","scriptTag","createElement","src","async","headTag","onload","workerScriptsPath","__loadZip","createWriter","BlobWriter","zipWriter","nextFile","contents","blob","filePrefix","fileSuffix","fileName","add","BlobReader","close","onerror","textFile","URL","revokeObjectURL","createObjectURL","__hrefForData","click","AuthManager","userData","getItemSync","idData","configureUserPrefs","userPreferencesDidChange","ephemeral","StorageManager","Fixed","setModelStorageMode","Ephemeral","setItemsMode","bestStorageMode","setItem","extraParams","strictSignin","setEphemeral","current_server_pw","newKeys","newAuthParams","displayOfflineAlert","mk","latest","protocolVersion","updateAvailable","_authParams","prefsContentType","contentTypePredicate","registerSingleton","resolvedSingleton","userPreferences","valueCallback","prefs","defaultValue","ComponentManager","SFAlertManager","DBManager","onUgradeNeeded","request","indexedDB","errorCode","onsuccess","db","onversionchange","errorEvent","onblocked","onupgradeneeded","objectStore","createObjectStore","keyPath","createIndex","unique","transaction","oncomplete","openCursor","cursor","continue","saveModels","onabort","code","itemObjectStore","putNext","put","delete","deleteRequest","deleteDatabase","DesktopManager","timeout","updateObservers","componentActivationObservers","dataLoaded","dataLoadHandler","majorDataChangeHandler","assert","applicationDataPath","paramsForExportFile","all","convertComponentForTransmission","installationSyncHandler","installComponentHandler","random","lastSearchedText","searchHandler","permissableKeys","MappingSourceDesktopInstalled","serializedComponent","path","getAllItemsJSONData","HttpManager","setJWTRequestHandler","getItem","SFHttpManager","KeyEventDown","KeyEventUp","AllModifiers","handleKeyDown","handleKeyUp","eventModifiers","ctrlKey","metaKey","altKey","modifiersForEvent","keyEventType","notElement","eventMatchesKeyAndModifiers","notifyObserver","MigrationManager","editorToComponentMigration","componentUrlToHostedUrl","removeTagReferencesFromNotes","hasChanges","needsSync","dirtyCount","newReferences","reference","saveBackup","SFMigrationManager","ContentTypeClassMapping","SFPrivileges","AppDomain","ModelManager","buildSystemSmartTags","globalOnly","sortedIndexBy","unshift","removeItemFromRespectiveArray","deleteModel","predicates","notTrashedPredicate","itemsMatchingPredicates","trashSmartTag","userTags","NativeExtManager","batchManagerIdentifier","systemExtensions","resolveExtensionsManager","resolveBatchManager","packagePredicate","_extensions_manager_location","p","packageInfo","_batch_manager_location","MillisecondsPerSecond","PasscodeManager","_hasPasscode","_locked","visibilityObservers","passcodeChangeObservers","configureAutoLock","cancelAutoLockTimer","_keys","interval","AutoLockIntervalKey","FixedEncrypted","AutoLockIntervalNone","ak","hash","decryptLocalStorage","generateUUIDSync","generateInitialKeysAndAuthParamsForUser","encryptLocalStorage","notifyObserversOfPasscodeChange","newPasscode","setPasscode","removeItem","setKeys","decryptStorage","documentVisibilityChanged","visibilityState","AutoLockIntervalImmediate","AutoLockIntervalOneMinute","AutoLockIntervalFiveMinutes","AutoLockIntervalOneHour","label","lockAfterDate","beginAutoLockTimer","notifiyVisibilityObservers","getAutoLockInterval","addToNow","seconds","setSeconds","getSeconds","lockTimeout","clearTimeout","setDelegate","isOffline","hasLocalPasscode","saveToStorage","getFromStorage","verifyAccountPassword","verifyLocalPasscode","verifyPasscode","onCancel","customSuccess","currentAuthenticationElement","customCancel","SFPrivilegesManager","SessionHistory","SFItemHistory","HistoryEntryClassMapping","addPasscodeChangeObserver","saveToDisk","keyRequestHandler","SFSessionHistoryManager","SingletonManager","SFSingletonManager","StatusManager","statuses","addStatus","statusFromString","notifyObservers","getStatusString","MemoryStorage","memory","memoryStorage","itemsStorageMode","localStorage","modelStorageMode","mode","newStorage","getVault","clear","writeEncryptedStorageToDisk","vaultKey","vault","encryptedStorageKeys","encryptedStorageAuthParams","encryptedStorage","storageAsHash","paramsForSync","syncParams","stored","clearAllModels","getAllModels","_memoryStorage","SFStorageManager","SyncManager","$interval","contentTypeLoadPriority","item1","item2","SFSyncManager","ThemeManager","CachedThemesKey","registerObservers","cacheThemes","activateCachedThemes","cachedThemes","getCachedThemes","writeToCache","activateTheme","deactivateTheme","decacheThemes","rel","media","disabled","parentNode","removeChild","transformer","paramsForLocalStorage","parsed","locale","formatter","$filter","Intl","DateTimeFormat","languages","language","year","month","day","hour","minute","format","trustAsResourceUrl","shouldFocus","$element","$document","didApplyClickOutside","isOpen","stopPropagation","clickOutside","show","showTimer","showElement","newVal","showSpinner","hideSpinner","hidePromise","getDelay","css","display","parseInt","isNumber","$parse","func","elemReady","files","$window","offset","threshold","canLoad","offsetHeight","scrollHeight","infiniteScroll","modelCtrl","lowercase","inputValue","lowercased","$setViewValue","$render","$parsers","ngModel","getSelection","toString","setSelectionRange","which","snEnter","AccountMenu","archiveManager","appVersion","mergeLocal","closeFunction","encryptedBackupsAvailable","canAddPasscode","submitMfaForm","mfa","payload","mfa_key","userMfaCode","submitAuthForm","user_password","showLogin","register","lockSyncing","authenticating","unlockSyncing","confirmation","password_conf","confirmPassword","mergeLocalChanged","block","onSuccessfulAuth","refreshErroredItems","clearDatabaseAndRewriteAllItems","removeAllItemsFromMemory","openPasswordWizard","openPrivilegesModal","ActionManagePrivileges","alternateUuids","markAllItemsDirtyAndSaveOffline","destroyLocalData","archiveFormData","submitImportPassword","performImport","importData","loading","importJSONData","errorCount","importFileSelected","file","reader","FileReader","requestPassword","scrollIntoView","readAsText","onDataReady","importItems","decryptMultipleItems","enc_item_key","auth_hash","downloadDataArchive","downloadBackup","notesAndTagsCount","encryptionStatusForNotes","encryptionSource","encryptionStatusString","passcodeAutoLockOptions","getAutoLockIntervalOptions","reloadAutoLockInterval","selectedAutoLockInterval","selectAutoLockInterval","setAutoLockInterval","ActionManagePasscode","addPasscodeClicked","showPasscodeForm","confirmPasscode","changingPasscode","changePasscode","changePasscodePressed","removePasscodePressed","signedIn","clearPasscode","ActionsMenu","loadExtensionInContextOfItem","scopedExtension","executeAction","parentAction","subrows","subRowsForAction","handleActionResponse","presentRevisionPreviewModal","subactions","subaction","onClick","subtitle","spinnerClass","ComponentModal","onDismiss","dismiss","$destroy","ComponentView","onLoad","manualDealloc","componentValid","updateObserver","prevComponent","componentValueChanging","onVisibilityChange","issueLoading","themeHandlerIdentifier","reloadThemeStatus","handleActivation","loadTimeout","didAttemptReload","desktopError","contentWindow","reloadStatus","doManualReload","reloading","previouslyValid","offlineRestricted","urlError","expired","lockReadonly","hasActiveTheme","dismissedNoThemesMessage","showNoThemesMessage","noThemesMessageDismiss","disableActiveTheme","deactivateAllThemes","getUrl","runningLocally","destroy","deregisterUpdateObserver","removeEventListener","ConflictResolutionModal","createContentString","item1Content","item2Content","keepItem1","applyCallback","keepItem2","keepBoth","export","EditorMenu","currentItem","defaultEditor","selectComponent","toggleDefaultForEditor","removeEditorDefault","makeEditorDefault","offlineAvailableForComponent","currentDefault","shouldDisplayRunningLocallyLabel","InputModal","placeholder","submit","MenuRow","transclude","circle","circleAlign","hasButton","buttonText","buttonClass","buttonAction","subRows","faded","stylekitClass","clickButton","PanelResizer","panelId","onResize","defaultWidth","onResizeFinish","control","alwaysVisible","minWidth","hoverable","collapsable","resizerColumn","resizerWidth","offsetWidth","pressed","startWidth","scrollWidth","startX","lastDownX","lastWidth","startLeft","offsetLeft","appFrame","round","getParentRect","widthBeforeLastDblClick","ondblclick","preClickCollapseState","finishSettingWidth","newCollapseState","getBoundingClientRect","handleReize","debounce","reloadDefaultValues","handleWidthEvent","classList","parentRect","maxWidth","flexBasis","addInvisibleOverlay","overlay","prepend","removeInvisibleOverlay","clientX","handleLeftEvent","deltaX","panelRect","newLeft","immediate","args","later","callNow","PasswordWizard","onbeforeunload","lockContinue","IntroStep","BackupStep","SignoutStep","PasswordStep","SyncStep","FinishStep","DefaultContinueTitle","continueTitle","titleForStep","changePassword","configure","securityUpdate","isContinuing","initializeStep","preprocessor","preprocessorForStep","onFail","validateCurrentPassword","FailedSyncMessage","processing","processPasswordChange","passwordSuccess","statusError","resyncData","syncSuccess","currentPassword","newPass","newPassword","newPasswordConfirmation","currentServerPw","setAllItemsDirty","newUserPassword","syncResponse","PermissionsModal","accept","deny","PrivilegesAuthModal","authenticationParameters","sessionLengthOptions","getSessionLengthOptions","getSelectedSessionLength","selectedSessionLength","selectSessionLength","netCredentialsForAction","credentials","requiredCredentials","promptForCredential","credential","displayInfoForCredential","prompt","isCredentialInFailureState","failedCredentials","validate","failed","cred","authenticateAction","setSessionLength","PrivilegesManagementModal","hasAccount","CredentialLocalPasscode","CredentialAccountPassword","displayInfoForAction","isCredentialRequiredForAction","privileges","clearSession","reloadPrivileges","availableActions","getAvailableActions","availableCredentials","getAvailableCredentials","getSessionExpirey","sessionEndDate","sessionExpirey","sessionExpired","credentialDisplayInfo","getPrivileges","privs","checkboxValueChanged","toggleCredentialForAction","savePrivileges","RevisionPreviewModal","editorCopy","restore","asCopy","contentCopy","SessionHistoryMenu","diskEnabled","autoOptimize","reloadHistory","historyForItem","entries","openRevision","revision","classForRevision","operationVector","clearItemHistory","clearAllHistory","toggleDiskSaving","toggleAutoOptimize","SyncResolutionMenu","backupFinished","skipBackup","performSyncResolution","resolving","resolveOutOfSync","attemptedResolution","isOutOfSync","fail"],"mappings":"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","file":"transpiled.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SNTheme = exports.SNSmartTag = exports.SNServerExtension = exports.SNMfa = exports.SNEncryptedStorage = exports.SNTag = exports.SNNote = exports.SNExtension = exports.Action = exports.SNEditor = exports.SNComponent = exports.SNComponentManager = undefined;\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _standardFileJs = require(\"standard-file-js\");\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SNComponentManager = exports.SNComponentManager = function () {\n\n  /*\n    @param {string} environment: one of [web, desktop, mobile]\n    @param {string} platform: one of [ios, android, linux-${environment}, mac-${environment}, windows-${environment}]\n  */\n  function SNComponentManager(_ref) {\n    var modelManager = _ref.modelManager,\n        syncManager = _ref.syncManager,\n        desktopManager = _ref.desktopManager,\n        nativeExtManager = _ref.nativeExtManager,\n        alertManager = _ref.alertManager,\n        $uiRunner = _ref.$uiRunner,\n        $timeout = _ref.$timeout,\n        environment = _ref.environment,\n        platform = _ref.platform;\n\n    _classCallCheck(this, SNComponentManager);\n\n    /* This domain will be used to save context item client data */\n    SNComponentManager.ClientDataDomain = \"org.standardnotes.sn.components\";\n\n    // Some actions need to be run on the ui thread (desktop/web only)\n    this.$uiRunner = $uiRunner || function (fn) {\n      fn();\n    };\n    this.$timeout = $timeout || setTimeout.bind(window);\n\n    this.modelManager = modelManager;\n    this.syncManager = syncManager;\n    this.desktopManager = desktopManager;\n    this.nativeExtManager = nativeExtManager;\n    this.alertManager = alertManager;\n\n    this.streamObservers = [];\n    this.contextStreamObservers = [];\n    this.activeComponents = [];\n\n    this.environment = environment;\n    this.platform = platform;\n    this.isDesktop = this.environment == \"desktop\";\n    this.isMobile = this.environment == \"mobile\";\n\n    if (environment != \"mobile\") {\n      this.configureForNonMobileUsage();\n    }\n\n    this.configureForGeneralUsage();\n\n    // this.loggingEnabled = true;\n\n    this.permissionDialogs = [];\n\n    this.handlers = [];\n  }\n\n  _createClass(SNComponentManager, [{\n    key: \"configureForGeneralUsage\",\n    value: function configureForGeneralUsage() {\n      var _this = this;\n\n      this.modelManager.addItemSyncObserver(\"component-manager\", \"*\", function (allItems, validItems, deletedItems, source, sourceKey) {\n        var syncedComponents = allItems.filter(function (item) {\n          return item.content_type === \"SN|Component\" || item.content_type == \"SN|Theme\";\n        });\n\n        /* We only want to sync if the item source is Retrieved, not MappingSourceRemoteSaved to avoid\n          recursion caused by the component being modified and saved after it is updated.\n        */\n        if (syncedComponents.length > 0 && source != SFModelManager.MappingSourceRemoteSaved) {\n          // Ensure any component in our data is installed by the system\n          if (_this.isDesktop) {\n            _this.desktopManager.syncComponentsInstallation(syncedComponents);\n          }\n        }\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = syncedComponents[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var component = _step.value;\n\n            var activeComponent = _.find(_this.activeComponents, { uuid: component.uuid });\n            if (component.active && !component.deleted && !activeComponent) {\n              _this.activateComponent(component);\n            } else if (!component.active && activeComponent) {\n              _this.deactivateComponent(component);\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        var _loop = function _loop(observer) {\n          if (sourceKey && sourceKey == observer.component.uuid) {\n            // Don't notify source of change, as it is the originator, doesn't need duplicate event.\n            return \"continue\";\n          }\n\n          var relevantItems = allItems.filter(function (item) {\n            return observer.contentTypes.indexOf(item.content_type) !== -1;\n          });\n\n          if (relevantItems.length == 0) {\n            return \"continue\";\n          }\n\n          var requiredPermissions = [{\n            name: \"stream-items\",\n            content_types: observer.contentTypes.sort()\n          }];\n\n          _this.runWithPermissions(observer.component, requiredPermissions, function () {\n            _this.sendItemsInReply(observer.component, relevantItems, observer.originalMessage);\n          });\n        };\n\n        var _iteratorNormalCompletion2 = true;\n        var _didIteratorError2 = false;\n        var _iteratorError2 = undefined;\n\n        try {\n          for (var _iterator2 = _this.streamObservers[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var observer = _step2.value;\n\n            var _ret = _loop(observer);\n\n            if (_ret === \"continue\") continue;\n          }\n        } catch (err) {\n          _didIteratorError2 = true;\n          _iteratorError2 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n              _iterator2.return();\n            }\n          } finally {\n            if (_didIteratorError2) {\n              throw _iteratorError2;\n            }\n          }\n        }\n\n        var requiredContextPermissions = [{\n          name: \"stream-context-item\"\n        }];\n\n        var _loop2 = function _loop2(observer) {\n          if (sourceKey && sourceKey == observer.component.uuid) {\n            // Don't notify source of change, as it is the originator, doesn't need duplicate event.\n            return \"continue\";\n          }\n\n          var _iteratorNormalCompletion4 = true;\n          var _didIteratorError4 = false;\n          var _iteratorError4 = undefined;\n\n          try {\n            for (var _iterator4 = _this.handlers[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n              var handler = _step4.value;\n\n              if (!handler.areas.includes(observer.component.area) && !handler.areas.includes(\"*\")) {\n                continue;\n              }\n              if (handler.contextRequestHandler) {\n                itemInContext = handler.contextRequestHandler(observer.component);\n\n                if (itemInContext) {\n                  matchingItem = _.find(allItems, { uuid: itemInContext.uuid });\n\n                  if (matchingItem) {\n                    _this.runWithPermissions(observer.component, requiredContextPermissions, function () {\n                      _this.sendContextItemInReply(observer.component, matchingItem, observer.originalMessage, source);\n                    });\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError4 = true;\n            _iteratorError4 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion4 && _iterator4.return) {\n                _iterator4.return();\n              }\n            } finally {\n              if (_didIteratorError4) {\n                throw _iteratorError4;\n              }\n            }\n          }\n        };\n\n        var _iteratorNormalCompletion3 = true;\n        var _didIteratorError3 = false;\n        var _iteratorError3 = undefined;\n\n        try {\n          for (var _iterator3 = _this.contextStreamObservers[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n            var observer = _step3.value;\n            var itemInContext;\n            var matchingItem;\n\n            var _ret2 = _loop2(observer);\n\n            if (_ret2 === \"continue\") continue;\n          }\n        } catch (err) {\n          _didIteratorError3 = true;\n          _iteratorError3 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion3 && _iterator3.return) {\n              _iterator3.return();\n            }\n          } finally {\n            if (_didIteratorError3) {\n              throw _iteratorError3;\n            }\n          }\n        }\n      });\n    }\n  }, {\n    key: \"configureForNonMobileUsage\",\n    value: function configureForNonMobileUsage() {\n      var _this2 = this;\n\n      var detectFocusChange = function detectFocusChange(event) {\n        var _iteratorNormalCompletion5 = true;\n        var _didIteratorError5 = false;\n        var _iteratorError5 = undefined;\n\n        try {\n          for (var _iterator5 = _this2.activeComponents[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n            var component = _step5.value;\n\n            if (document.activeElement == _this2.iframeForComponent(component)) {\n              _this2.$timeout(function () {\n                _this2.focusChangedForComponent(component);\n              });\n              break;\n            }\n          }\n        } catch (err) {\n          _didIteratorError5 = true;\n          _iteratorError5 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion5 && _iterator5.return) {\n              _iterator5.return();\n            }\n          } finally {\n            if (_didIteratorError5) {\n              throw _iteratorError5;\n            }\n          }\n        }\n      };\n\n      window.addEventListener ? window.addEventListener('focus', detectFocusChange, true) : window.attachEvent('onfocusout', detectFocusChange);\n      window.addEventListener ? window.addEventListener('blur', detectFocusChange, true) : window.attachEvent('onblur', detectFocusChange);\n\n      this.desktopManager.registerUpdateObserver(function (component) {\n        // Reload theme if active\n        if (component.active && component.isTheme()) {\n          _this2.postActiveThemesToAllComponents();\n        }\n      });\n\n      // On mobile, events listeners are handled by a respective component\n      window.addEventListener(\"message\", function (event) {\n        if (_this2.loggingEnabled) {\n          console.log(\"Web app: received message\", event);\n        }\n\n        // Make sure this message is for us\n        if (event.data.sessionKey) {\n          _this2.handleMessage(_this2.componentForSessionKey(event.data.sessionKey), event.data);\n        }\n      }, false);\n    }\n  }, {\n    key: \"postActiveThemesToAllComponents\",\n    value: function postActiveThemesToAllComponents() {\n      var _iteratorNormalCompletion6 = true;\n      var _didIteratorError6 = false;\n      var _iteratorError6 = undefined;\n\n      try {\n        for (var _iterator6 = this.components[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n          var component = _step6.value;\n\n          // Skip over components that are themes themselves,\n          // or components that are not active, or components that don't have a window\n          if (component.isTheme() || !component.active || !component.window) {\n            continue;\n          }\n\n          this.postActiveThemesToComponent(component);\n        }\n      } catch (err) {\n        _didIteratorError6 = true;\n        _iteratorError6 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion6 && _iterator6.return) {\n            _iterator6.return();\n          }\n        } finally {\n          if (_didIteratorError6) {\n            throw _iteratorError6;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"getActiveThemes\",\n    value: function getActiveThemes() {\n      return this.componentsForArea(\"themes\").filter(function (theme) {\n        return theme.active;\n      });\n    }\n  }, {\n    key: \"urlsForActiveThemes\",\n    value: function urlsForActiveThemes() {\n      var _this3 = this;\n\n      var themes = this.getActiveThemes();\n      return themes.map(function (theme) {\n        return _this3.urlForComponent(theme);\n      });\n    }\n  }, {\n    key: \"postActiveThemesToComponent\",\n    value: function postActiveThemesToComponent(component) {\n      var urls = this.urlsForActiveThemes();\n      var data = { themes: urls };\n\n      this.sendMessageToComponent(component, { action: \"themes\", data: data });\n    }\n  }, {\n    key: \"contextItemDidChangeInArea\",\n    value: function contextItemDidChangeInArea(area) {\n      var _iteratorNormalCompletion7 = true;\n      var _didIteratorError7 = false;\n      var _iteratorError7 = undefined;\n\n      try {\n        for (var _iterator7 = this.handlers[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n          var handler = _step7.value;\n\n          if (handler.areas.includes(area) === false && !handler.areas.includes(\"*\")) {\n            continue;\n          }\n          var observers = this.contextStreamObservers.filter(function (observer) {\n            return observer.component.area === area;\n          });\n\n          var _iteratorNormalCompletion8 = true;\n          var _didIteratorError8 = false;\n          var _iteratorError8 = undefined;\n\n          try {\n            for (var _iterator8 = observers[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n              var observer = _step8.value;\n\n              if (handler.contextRequestHandler) {\n                var itemInContext = handler.contextRequestHandler(observer.component);\n                if (itemInContext) {\n                  this.sendContextItemInReply(observer.component, itemInContext, observer.originalMessage);\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError8 = true;\n            _iteratorError8 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion8 && _iterator8.return) {\n                _iterator8.return();\n              }\n            } finally {\n              if (_didIteratorError8) {\n                throw _iteratorError8;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError7 = true;\n        _iteratorError7 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion7 && _iterator7.return) {\n            _iterator7.return();\n          }\n        } finally {\n          if (_didIteratorError7) {\n            throw _iteratorError7;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"setComponentHidden\",\n    value: function setComponentHidden(component, hidden) {\n      /*\n        A hidden component will not receive messages.\n        However, when a component is unhidden, we need to send it any items it may have\n        registered streaming for.\n      */\n      if (hidden) {\n        component.hidden = true;\n      } else if (component.hidden) {\n        // Only enter this condition if component is hidden to make this note have double side effects.\n        component.hidden = false;\n\n        // streamContextItem\n        var contextObserver = _.find(this.contextStreamObservers, { identifier: component.uuid });\n        if (contextObserver) {\n          this.handleStreamContextItemMessage(component, contextObserver.originalMessage);\n        }\n\n        // streamItems\n        var streamObserver = _.find(this.streamObservers, { identifier: component.uuid });\n        if (streamObserver) {\n          this.handleStreamItemsMessage(component, streamObserver.originalMessage);\n        }\n      }\n    }\n  }, {\n    key: \"jsonForItem\",\n    value: function jsonForItem(item, component, source) {\n      var params = { uuid: item.uuid, content_type: item.content_type, created_at: item.created_at, updated_at: item.updated_at, deleted: item.deleted };\n      params.content = item.createContentJSONFromProperties();\n      params.clientData = item.getDomainDataItem(component.getClientDataKey(), SNComponentManager.ClientDataDomain) || {};\n\n      // isMetadataUpdate implies that the extension should make reference of updated metadata,\n      // but not update content values as they may be stale relative to what the extension currently has\n      // Changes are always metadata updates if the mapping source is SFModelManager.MappingSourceRemoteSaved || source == SFModelManager.MappingSourceLocalSaved.\n      //\n      if (source && (source == SFModelManager.MappingSourceRemoteSaved || source == SFModelManager.MappingSourceLocalSaved)) {\n        params.isMetadataUpdate = true;\n      }\n\n      this.removePrivatePropertiesFromResponseItems([params], component, { type: \"outgoing\" });\n      return params;\n    }\n  }, {\n    key: \"sendItemsInReply\",\n    value: function sendItemsInReply(component, items, message, source) {\n      var _this4 = this;\n\n      if (this.loggingEnabled) {\n        console.log(\"Web|componentManager|sendItemsInReply\", component, items, message);\n      };\n      var response = { items: {} };\n      var mapped = items.map(function (item) {\n        return _this4.jsonForItem(item, component, source);\n      });\n\n      response.items = mapped;\n      this.replyToMessage(component, message, response);\n    }\n  }, {\n    key: \"sendContextItemInReply\",\n    value: function sendContextItemInReply(component, item, originalMessage, source) {\n      if (this.loggingEnabled) {\n        console.log(\"Web|componentManager|sendContextItemInReply\", component, item, originalMessage);\n      };\n      var response = { item: this.jsonForItem(item, component, source) };\n      this.replyToMessage(component, originalMessage, response);\n    }\n  }, {\n    key: \"replyToMessage\",\n    value: function replyToMessage(component, originalMessage, replyData) {\n      var reply = {\n        action: \"reply\",\n        original: originalMessage,\n        data: replyData\n      };\n\n      this.sendMessageToComponent(component, reply);\n    }\n  }, {\n    key: \"sendMessageToComponent\",\n    value: function sendMessageToComponent(component, message) {\n      var permissibleActionsWhileHidden = [\"component-registered\", \"themes\"];\n      if (component.hidden && !permissibleActionsWhileHidden.includes(message.action)) {\n        if (this.loggingEnabled) {\n          console.log(\"Component disabled for current item, not sending any messages.\", component.name);\n        }\n        return;\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Web|sendMessageToComponent\", component, message);\n      }\n\n      var origin = this.urlForComponent(component, \"file://\");\n      if (!origin.startsWith(\"http\") && !origin.startsWith(\"file\")) {\n        // Native extension running in web, prefix current host\n        origin = window.location.href + origin;\n      }\n\n      if (!component.window) {\n        this.alertManager.alert({ text: \"Standard Notes is trying to communicate with \" + component.name + \", but an error is occurring. Please restart this extension and try again.\" });\n      }\n\n      // Mobile messaging requires json\n      if (this.isMobile) {\n        message = JSON.stringify(message);\n      }\n\n      component.window.postMessage(message, origin);\n    }\n  }, {\n    key: \"componentsForArea\",\n    value: function componentsForArea(area) {\n      return this.components.filter(function (component) {\n        return component.area === area;\n      });\n    }\n  }, {\n    key: \"urlForComponent\",\n    value: function urlForComponent(component) {\n      var offlinePrefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n\n      // offlineOnly is available only on desktop, and not on web or mobile.\n      if (component.offlineOnly && !this.isDesktop) {\n        return null;\n      }\n\n      if (component.offlineOnly || this.isDesktop && component.local_url) {\n        return component.local_url && component.local_url.replace(\"sn://\", offlinePrefix + this.desktopManager.getApplicationDataPath() + \"/\");\n      } else {\n        var url = component.hosted_url || component.legacy_url;\n        if (this.isMobile) {\n          var localReplacement = this.platform == \"ios\" ? \"localhost\" : \"10.0.2.2\";\n          url = url.replace(\"localhost\", localReplacement).replace(\"sn.local\", localReplacement);\n        }\n        return url;\n      }\n    }\n  }, {\n    key: \"componentForUrl\",\n    value: function componentForUrl(url) {\n      return this.components.filter(function (component) {\n        return component.hosted_url === url || component.legacy_url === url;\n      })[0];\n    }\n  }, {\n    key: \"componentForSessionKey\",\n    value: function componentForSessionKey(key) {\n      var component = _.find(this.components, { sessionKey: key });\n      if (!component) {\n        var _iteratorNormalCompletion9 = true;\n        var _didIteratorError9 = false;\n        var _iteratorError9 = undefined;\n\n        try {\n          for (var _iterator9 = this.handlers[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n            var handler = _step9.value;\n\n            if (handler.componentForSessionKeyHandler) {\n              component = handler.componentForSessionKeyHandler(key);\n              if (component) {\n                break;\n              }\n            }\n          }\n        } catch (err) {\n          _didIteratorError9 = true;\n          _iteratorError9 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion9 && _iterator9.return) {\n              _iterator9.return();\n            }\n          } finally {\n            if (_didIteratorError9) {\n              throw _iteratorError9;\n            }\n          }\n        }\n      }\n      return component;\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(component, message) {\n      var _this5 = this;\n\n      if (!component) {\n        console.log(\"Component not defined for message, returning\", message);\n        this.alertManager.alert({ text: \"An extension is trying to communicate with Standard Notes, but there is an error establishing a bridge. Please restart the app and try again.\" });\n        return;\n      }\n\n      // Actions that won't succeeed with readonly mode\n      var readwriteActions = [\"save-items\", \"associate-item\", \"deassociate-item\", \"create-item\", \"create-items\", \"delete-items\", \"set-component-data\"];\n\n      if (component.readonly && readwriteActions.includes(message.action)) {\n        // A component can be marked readonly if changes should not be saved.\n        // Particullary used for revision preview windows where the notes should not be savable.\n        this.alertManager.alert({ text: \"The extension \" + component.name + \" is trying to save, but it is in a locked state and cannot accept changes.\" });\n        return;\n      }\n\n      /**\n      Possible Messages:\n        set-size\n        stream-items\n        stream-context-item\n        save-items\n        select-item\n        associate-item\n        deassociate-item\n        clear-selection\n        create-item\n        create-items\n        delete-items\n        set-component-data\n        install-local-component\n        toggle-activate-component\n        request-permissions\n        present-conflict-resolution\n      */\n\n      if (message.action === \"stream-items\") {\n        this.handleStreamItemsMessage(component, message);\n      } else if (message.action === \"stream-context-item\") {\n        this.handleStreamContextItemMessage(component, message);\n      } else if (message.action === \"set-component-data\") {\n        this.handleSetComponentDataMessage(component, message);\n      } else if (message.action === \"delete-items\") {\n        this.handleDeleteItemsMessage(component, message);\n      } else if (message.action === \"create-items\" || message.action === \"create-item\") {\n        this.handleCreateItemsMessage(component, message);\n      } else if (message.action === \"save-items\") {\n        this.handleSaveItemsMessage(component, message);\n      } else if (message.action === \"toggle-activate-component\") {\n        var componentToToggle = this.modelManager.findItem(message.data.uuid);\n        this.handleToggleComponentMessage(component, componentToToggle, message);\n      } else if (message.action === \"request-permissions\") {\n        this.handleRequestPermissionsMessage(component, message);\n      } else if (message.action === \"install-local-component\") {\n        this.handleInstallLocalComponentMessage(component, message);\n      } else if (message.action === \"duplicate-item\") {\n        this.handleDuplicateItemMessage(component, message);\n      }\n\n      // Notify observers\n\n      var _loop3 = function _loop3(handler) {\n        if (handler.actionHandler && (handler.areas.includes(component.area) || handler.areas.includes(\"*\"))) {\n          _this5.$timeout(function () {\n            handler.actionHandler(component, message.action, message.data);\n          });\n        }\n      };\n\n      var _iteratorNormalCompletion10 = true;\n      var _didIteratorError10 = false;\n      var _iteratorError10 = undefined;\n\n      try {\n        for (var _iterator10 = this.handlers[Symbol.iterator](), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n          var handler = _step10.value;\n\n          _loop3(handler);\n        }\n      } catch (err) {\n        _didIteratorError10 = true;\n        _iteratorError10 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion10 && _iterator10.return) {\n            _iterator10.return();\n          }\n        } finally {\n          if (_didIteratorError10) {\n            throw _iteratorError10;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"removePrivatePropertiesFromResponseItems\",\n    value: function removePrivatePropertiesFromResponseItems(responseItems, component) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      // can be 'incoming' or 'outgoing'. We want to remove updated_at if incoming, but keep it if outgoing\n      if (options.type == \"incoming\") {\n        var privateTopLevelProperties = [\"updated_at\"];\n        // Maintaining our own updated_at value is imperative for sync to work properly, we ignore any incoming value.\n        var _iteratorNormalCompletion11 = true;\n        var _didIteratorError11 = false;\n        var _iteratorError11 = undefined;\n\n        try {\n          for (var _iterator11 = responseItems[Symbol.iterator](), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n            var responseItem = _step11.value;\n\n            if (typeof responseItem.setDirty === 'function') {\n              console.error(\"Attempting to pass object. Use JSON.\");\n              continue;\n            }\n            var _iteratorNormalCompletion12 = true;\n            var _didIteratorError12 = false;\n            var _iteratorError12 = undefined;\n\n            try {\n              for (var _iterator12 = privateTopLevelProperties[Symbol.iterator](), _step12; !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {\n                var privateProperty = _step12.value;\n\n                delete responseItem[privateProperty];\n              }\n            } catch (err) {\n              _didIteratorError12 = true;\n              _iteratorError12 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion12 && _iterator12.return) {\n                  _iterator12.return();\n                }\n              } finally {\n                if (_didIteratorError12) {\n                  throw _iteratorError12;\n                }\n              }\n            }\n          }\n        } catch (err) {\n          _didIteratorError11 = true;\n          _iteratorError11 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion11 && _iterator11.return) {\n              _iterator11.return();\n            }\n          } finally {\n            if (_didIteratorError11) {\n              throw _iteratorError11;\n            }\n          }\n        }\n      }\n\n      if (component) {\n        // System extensions can bypass this step\n        if (this.nativeExtManager && this.nativeExtManager.isSystemExtension(component)) {\n          return;\n        }\n      }\n      // Don't allow component to overwrite these properties.\n      var privateContentProperties = [\"autoupdateDisabled\", \"permissions\", \"active\"];\n      if (options) {\n        if (options.includeUrls) {\n          privateContentProperties = privateContentProperties.concat([\"url\", \"hosted_url\", \"local_url\"]);\n        }\n      }\n      var _iteratorNormalCompletion13 = true;\n      var _didIteratorError13 = false;\n      var _iteratorError13 = undefined;\n\n      try {\n        for (var _iterator13 = responseItems[Symbol.iterator](), _step13; !(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done); _iteratorNormalCompletion13 = true) {\n          var _responseItem = _step13.value;\n\n          // Do not pass in actual items here, otherwise that would be destructive.\n          // Instead, generic JS/JSON objects should be passed.\n          if (typeof _responseItem.setDirty === 'function') {\n            console.error(\"Attempting to pass object. Use JSON.\");\n            continue;\n          }\n\n          var _iteratorNormalCompletion14 = true;\n          var _didIteratorError14 = false;\n          var _iteratorError14 = undefined;\n\n          try {\n            for (var _iterator14 = privateContentProperties[Symbol.iterator](), _step14; !(_iteratorNormalCompletion14 = (_step14 = _iterator14.next()).done); _iteratorNormalCompletion14 = true) {\n              var prop = _step14.value;\n\n              delete _responseItem.content[prop];\n            }\n          } catch (err) {\n            _didIteratorError14 = true;\n            _iteratorError14 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion14 && _iterator14.return) {\n                _iterator14.return();\n              }\n            } finally {\n              if (_didIteratorError14) {\n                throw _iteratorError14;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError13 = true;\n        _iteratorError13 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion13 && _iterator13.return) {\n            _iterator13.return();\n          }\n        } finally {\n          if (_didIteratorError13) {\n            throw _iteratorError13;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"handleStreamItemsMessage\",\n    value: function handleStreamItemsMessage(component, message) {\n      var _this6 = this;\n\n      var requiredPermissions = [{\n        name: \"stream-items\",\n        content_types: message.data.content_types.sort()\n      }];\n\n      this.runWithPermissions(component, requiredPermissions, function () {\n        if (!_.find(_this6.streamObservers, { identifier: component.uuid })) {\n          // for pushing laster as changes come in\n          _this6.streamObservers.push({\n            identifier: component.uuid,\n            component: component,\n            originalMessage: message,\n            contentTypes: message.data.content_types\n          });\n        }\n\n        // push immediately now\n        var items = [];\n        var _iteratorNormalCompletion15 = true;\n        var _didIteratorError15 = false;\n        var _iteratorError15 = undefined;\n\n        try {\n          for (var _iterator15 = message.data.content_types[Symbol.iterator](), _step15; !(_iteratorNormalCompletion15 = (_step15 = _iterator15.next()).done); _iteratorNormalCompletion15 = true) {\n            var contentType = _step15.value;\n\n            items = items.concat(_this6.modelManager.validItemsForContentType(contentType));\n          }\n        } catch (err) {\n          _didIteratorError15 = true;\n          _iteratorError15 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion15 && _iterator15.return) {\n              _iterator15.return();\n            }\n          } finally {\n            if (_didIteratorError15) {\n              throw _iteratorError15;\n            }\n          }\n        }\n\n        _this6.sendItemsInReply(component, items, message);\n      });\n    }\n  }, {\n    key: \"handleStreamContextItemMessage\",\n    value: function handleStreamContextItemMessage(component, message) {\n      var _this7 = this;\n\n      var requiredPermissions = [{\n        name: \"stream-context-item\"\n      }];\n\n      this.runWithPermissions(component, requiredPermissions, function () {\n        if (!_.find(_this7.contextStreamObservers, { identifier: component.uuid })) {\n          // for pushing laster as changes come in\n          _this7.contextStreamObservers.push({\n            identifier: component.uuid,\n            component: component,\n            originalMessage: message\n          });\n        }\n\n        // push immediately now\n        var _iteratorNormalCompletion16 = true;\n        var _didIteratorError16 = false;\n        var _iteratorError16 = undefined;\n\n        try {\n          for (var _iterator16 = _this7.handlersForArea(component.area)[Symbol.iterator](), _step16; !(_iteratorNormalCompletion16 = (_step16 = _iterator16.next()).done); _iteratorNormalCompletion16 = true) {\n            var handler = _step16.value;\n\n            if (handler.contextRequestHandler) {\n              var itemInContext = handler.contextRequestHandler(component);\n              if (itemInContext) {\n                _this7.sendContextItemInReply(component, itemInContext, message);\n              }\n            }\n          }\n        } catch (err) {\n          _didIteratorError16 = true;\n          _iteratorError16 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion16 && _iterator16.return) {\n              _iterator16.return();\n            }\n          } finally {\n            if (_didIteratorError16) {\n              throw _iteratorError16;\n            }\n          }\n        }\n      });\n    }\n  }, {\n    key: \"isItemIdWithinComponentContextJurisdiction\",\n    value: function isItemIdWithinComponentContextJurisdiction(uuid, component) {\n      var itemIdsInJurisdiction = this.itemIdsInContextJurisdictionForComponent(component);\n      return itemIdsInJurisdiction.includes(uuid);\n    }\n\n    /* Returns items that given component has context permissions for */\n\n  }, {\n    key: \"itemIdsInContextJurisdictionForComponent\",\n    value: function itemIdsInContextJurisdictionForComponent(component) {\n      var itemIds = [];\n      var _iteratorNormalCompletion17 = true;\n      var _didIteratorError17 = false;\n      var _iteratorError17 = undefined;\n\n      try {\n        for (var _iterator17 = this.handlersForArea(component.area)[Symbol.iterator](), _step17; !(_iteratorNormalCompletion17 = (_step17 = _iterator17.next()).done); _iteratorNormalCompletion17 = true) {\n          var handler = _step17.value;\n\n          if (handler.contextRequestHandler) {\n            var itemInContext = handler.contextRequestHandler(component);\n            if (itemInContext) {\n              itemIds.push(itemInContext.uuid);\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError17 = true;\n        _iteratorError17 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion17 && _iterator17.return) {\n            _iterator17.return();\n          }\n        } finally {\n          if (_didIteratorError17) {\n            throw _iteratorError17;\n          }\n        }\n      }\n\n      return itemIds;\n    }\n  }, {\n    key: \"handlersForArea\",\n    value: function handlersForArea(area) {\n      return this.handlers.filter(function (candidate) {\n        return candidate.areas.includes(area);\n      });\n    }\n  }, {\n    key: \"handleSaveItemsMessage\",\n    value: function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(component, message) {\n        var _this8 = this;\n\n        var responseItems, requiredPermissions, itemIdsInContextJurisdiction, pendingResponseItems, _iteratorNormalCompletion18, _didIteratorError18, _iteratorError18, _iterator18, _step18, responseItem, requiredContentTypes;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                responseItems = message.data.items;\n                requiredPermissions = [];\n                itemIdsInContextJurisdiction = this.itemIdsInContextJurisdictionForComponent(component);\n\n                // Pending as in needed to be accounted for in permissions.\n\n                pendingResponseItems = responseItems.slice();\n                _iteratorNormalCompletion18 = true;\n                _didIteratorError18 = false;\n                _iteratorError18 = undefined;\n                _context2.prev = 7;\n                _iterator18 = responseItems.slice()[Symbol.iterator]();\n\n              case 9:\n                if (_iteratorNormalCompletion18 = (_step18 = _iterator18.next()).done) {\n                  _context2.next = 18;\n                  break;\n                }\n\n                responseItem = _step18.value;\n\n                if (!itemIdsInContextJurisdiction.includes(responseItem.uuid)) {\n                  _context2.next = 15;\n                  break;\n                }\n\n                requiredPermissions.push({\n                  name: \"stream-context-item\"\n                });\n                _.pull(pendingResponseItems, responseItem);\n                // We break because there can only be one context item\n                return _context2.abrupt(\"break\", 18);\n\n              case 15:\n                _iteratorNormalCompletion18 = true;\n                _context2.next = 9;\n                break;\n\n              case 18:\n                _context2.next = 24;\n                break;\n\n              case 20:\n                _context2.prev = 20;\n                _context2.t0 = _context2[\"catch\"](7);\n                _didIteratorError18 = true;\n                _iteratorError18 = _context2.t0;\n\n              case 24:\n                _context2.prev = 24;\n                _context2.prev = 25;\n\n                if (!_iteratorNormalCompletion18 && _iterator18.return) {\n                  _iterator18.return();\n                }\n\n              case 27:\n                _context2.prev = 27;\n\n                if (!_didIteratorError18) {\n                  _context2.next = 30;\n                  break;\n                }\n\n                throw _iteratorError18;\n\n              case 30:\n                return _context2.finish(27);\n\n              case 31:\n                return _context2.finish(24);\n\n              case 32:\n\n                // Check to see if additional privileges are required\n                if (pendingResponseItems.length > 0) {\n                  requiredContentTypes = _.uniq(pendingResponseItems.map(function (i) {\n                    return i.content_type;\n                  })).sort();\n\n                  requiredPermissions.push({\n                    name: \"stream-items\",\n                    content_types: requiredContentTypes\n                  });\n                }\n\n                this.runWithPermissions(component, requiredPermissions, _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n                  var ids, items, lockedCount, _iteratorNormalCompletion19, _didIteratorError19, _iteratorError19, _iterator19, _step19, item, itemNoun, auxVerb, localItems, _iteratorNormalCompletion20, _didIteratorError20, _iteratorError20, _iterator20, _step20, _responseItem2, _item;\n\n                  return regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n\n                          _this8.removePrivatePropertiesFromResponseItems(responseItems, component, { includeUrls: true, type: \"incoming\" });\n\n                          /*\n                          We map the items here because modelManager is what updates the UI. If you were to instead get the items directly,\n                          this would update them server side via sync, but would never make its way back to the UI.\n                          */\n\n                          // Filter locked items\n                          ids = responseItems.map(function (i) {\n                            return i.uuid;\n                          });\n                          items = _this8.modelManager.findItems(ids);\n                          lockedCount = 0;\n                          _iteratorNormalCompletion19 = true;\n                          _didIteratorError19 = false;\n                          _iteratorError19 = undefined;\n                          _context.prev = 7;\n\n                          for (_iterator19 = items[Symbol.iterator](); !(_iteratorNormalCompletion19 = (_step19 = _iterator19.next()).done); _iteratorNormalCompletion19 = true) {\n                            item = _step19.value;\n\n                            if (item.locked) {\n                              _.remove(responseItems, { uuid: item.uuid });\n                              lockedCount++;\n                            }\n                          }\n\n                          _context.next = 15;\n                          break;\n\n                        case 11:\n                          _context.prev = 11;\n                          _context.t0 = _context[\"catch\"](7);\n                          _didIteratorError19 = true;\n                          _iteratorError19 = _context.t0;\n\n                        case 15:\n                          _context.prev = 15;\n                          _context.prev = 16;\n\n                          if (!_iteratorNormalCompletion19 && _iterator19.return) {\n                            _iterator19.return();\n                          }\n\n                        case 18:\n                          _context.prev = 18;\n\n                          if (!_didIteratorError19) {\n                            _context.next = 21;\n                            break;\n                          }\n\n                          throw _iteratorError19;\n\n                        case 21:\n                          return _context.finish(18);\n\n                        case 22:\n                          return _context.finish(15);\n\n                        case 23:\n                          if (lockedCount > 0) {\n                            itemNoun = lockedCount == 1 ? \"item\" : \"items\";\n                            auxVerb = lockedCount == 1 ? \"is\" : \"are\";\n\n                            _this8.alertManager.alert({ title: 'Items Locked', text: lockedCount + \" \" + itemNoun + \" you are attempting to save \" + auxVerb + \" locked and cannot be edited.\" });\n                          }\n\n                          _context.next = 26;\n                          return _this8.modelManager.mapResponseItemsToLocalModels(responseItems, SFModelManager.MappingSourceComponentRetrieved, component.uuid);\n\n                        case 26:\n                          localItems = _context.sent;\n                          _iteratorNormalCompletion20 = true;\n                          _didIteratorError20 = false;\n                          _iteratorError20 = undefined;\n                          _context.prev = 30;\n                          _iterator20 = responseItems[Symbol.iterator]();\n\n                        case 32:\n                          if (_iteratorNormalCompletion20 = (_step20 = _iterator20.next()).done) {\n                            _context.next = 42;\n                            break;\n                          }\n\n                          _responseItem2 = _step20.value;\n                          _item = _.find(localItems, { uuid: _responseItem2.uuid });\n\n                          if (_item) {\n                            _context.next = 38;\n                            break;\n                          }\n\n                          // An item this extension is trying to save was possibly removed locally, notify user\n                          _this8.alertManager.alert({ text: \"The extension \" + component.name + \" is trying to save an item with type \" + _responseItem2.content_type + \", but that item does not exist. Please restart this extension and try again.\" });\n                          return _context.abrupt(\"continue\", 39);\n\n                        case 38:\n\n                          if (!_item.locked) {\n                            if (_responseItem2.clientData) {\n                              _item.setDomainDataItem(component.getClientDataKey(), _responseItem2.clientData, SNComponentManager.ClientDataDomain);\n                            }\n                            _this8.modelManager.setItemDirty(_item, true, true, SFModelManager.MappingSourceComponentRetrieved, component.uuid);\n                          }\n\n                        case 39:\n                          _iteratorNormalCompletion20 = true;\n                          _context.next = 32;\n                          break;\n\n                        case 42:\n                          _context.next = 48;\n                          break;\n\n                        case 44:\n                          _context.prev = 44;\n                          _context.t1 = _context[\"catch\"](30);\n                          _didIteratorError20 = true;\n                          _iteratorError20 = _context.t1;\n\n                        case 48:\n                          _context.prev = 48;\n                          _context.prev = 49;\n\n                          if (!_iteratorNormalCompletion20 && _iterator20.return) {\n                            _iterator20.return();\n                          }\n\n                        case 51:\n                          _context.prev = 51;\n\n                          if (!_didIteratorError20) {\n                            _context.next = 54;\n                            break;\n                          }\n\n                          throw _iteratorError20;\n\n                        case 54:\n                          return _context.finish(51);\n\n                        case 55:\n                          return _context.finish(48);\n\n                        case 56:\n\n                          _this8.syncManager.sync().then(function (response) {\n                            // Allow handlers to be notified when a save begins and ends, to update the UI\n                            var saveMessage = Object.assign({}, message);\n                            saveMessage.action = response && response.error ? \"save-error\" : \"save-success\";\n                            _this8.replyToMessage(component, message, { error: response && response.error });\n                            _this8.handleMessage(component, saveMessage);\n                          });\n\n                        case 57:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee, _this8, [[7, 11, 15, 23], [16,, 18, 22], [30, 44, 48, 56], [49,, 51, 55]]);\n                })));\n\n              case 34:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[7, 20, 24, 32], [25,, 27, 31]]);\n      }));\n\n      function handleSaveItemsMessage(_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      }\n\n      return handleSaveItemsMessage;\n    }()\n  }, {\n    key: \"handleDuplicateItemMessage\",\n    value: function handleDuplicateItemMessage(component, message) {\n      var _this9 = this;\n\n      var itemParams = message.data.item;\n      var item = this.modelManager.findItem(itemParams.uuid);\n      var requiredPermissions = [{\n        name: \"stream-items\",\n        content_types: [item.content_type]\n      }];\n\n      this.runWithPermissions(component, requiredPermissions, function () {\n        var duplicate = _this9.modelManager.duplicateItemAndAdd(item);\n        _this9.syncManager.sync();\n\n        _this9.replyToMessage(component, message, { item: _this9.jsonForItem(duplicate, component) });\n      });\n    }\n  }, {\n    key: \"handleCreateItemsMessage\",\n    value: function handleCreateItemsMessage(component, message) {\n      var _this10 = this;\n\n      var responseItems = message.data.item ? [message.data.item] : message.data.items;\n      var uniqueContentTypes = _.uniq(responseItems.map(function (item) {\n        return item.content_type;\n      }));\n      var requiredPermissions = [{\n        name: \"stream-items\",\n        content_types: uniqueContentTypes\n      }];\n\n      this.runWithPermissions(component, requiredPermissions, function () {\n        _this10.removePrivatePropertiesFromResponseItems(responseItems, component, { type: \"incoming\" });\n        var processedItems = [];\n        var _iteratorNormalCompletion21 = true;\n        var _didIteratorError21 = false;\n        var _iteratorError21 = undefined;\n\n        try {\n          for (var _iterator21 = responseItems[Symbol.iterator](), _step21; !(_iteratorNormalCompletion21 = (_step21 = _iterator21.next()).done); _iteratorNormalCompletion21 = true) {\n            var responseItem = _step21.value;\n\n            var item = _this10.modelManager.createItem(responseItem);\n            if (responseItem.clientData) {\n              item.setDomainDataItem(component.getClientDataKey(), responseItem.clientData, SNComponentManager.ClientDataDomain);\n            }\n            _this10.modelManager.addItem(item);\n            _this10.modelManager.resolveReferencesForItem(item, true);\n            _this10.modelManager.setItemDirty(item, true);\n            processedItems.push(item);\n          }\n        } catch (err) {\n          _didIteratorError21 = true;\n          _iteratorError21 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion21 && _iterator21.return) {\n              _iterator21.return();\n            }\n          } finally {\n            if (_didIteratorError21) {\n              throw _iteratorError21;\n            }\n          }\n        }\n\n        _this10.syncManager.sync();\n\n        // \"create-item\" or \"create-items\" are possible messages handled here\n        var reply = message.action == \"create-item\" ? { item: _this10.jsonForItem(processedItems[0], component) } : { items: processedItems.map(function (item) {\n            return _this10.jsonForItem(item, component);\n          }) };\n\n        _this10.replyToMessage(component, message, reply);\n      });\n    }\n  }, {\n    key: \"handleDeleteItemsMessage\",\n    value: function handleDeleteItemsMessage(component, message) {\n      var _this11 = this;\n\n      var requiredContentTypes = _.uniq(message.data.items.map(function (i) {\n        return i.content_type;\n      })).sort();\n      var requiredPermissions = [{\n        name: \"stream-items\",\n        content_types: requiredContentTypes\n      }];\n\n      this.runWithPermissions(component, requiredPermissions, _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var itemsData, noun, reply, didConfirm, _iteratorNormalCompletion22, _didIteratorError22, _iteratorError22, _iterator22, _step22, itemData, model;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                itemsData = message.data.items;\n                noun = itemsData.length == 1 ? \"item\" : \"items\";\n                reply = null;\n                didConfirm = true;\n                _context3.next = 6;\n                return _this11.alertManager.confirm({ text: \"Are you sure you want to delete \" + itemsData.length + \" \" + noun + \"?\" }).catch(function () {\n                  didConfirm = false;\n                });\n\n              case 6:\n                if (!didConfirm) {\n                  _context3.next = 42;\n                  break;\n                }\n\n                // Filter for any components and deactivate before deleting\n                _iteratorNormalCompletion22 = true;\n                _didIteratorError22 = false;\n                _iteratorError22 = undefined;\n                _context3.prev = 10;\n                _iterator22 = itemsData[Symbol.iterator]();\n\n              case 12:\n                if (_iteratorNormalCompletion22 = (_step22 = _iterator22.next()).done) {\n                  _context3.next = 24;\n                  break;\n                }\n\n                itemData = _step22.value;\n                model = _this11.modelManager.findItem(itemData.uuid);\n\n                if (model) {\n                  _context3.next = 18;\n                  break;\n                }\n\n                _this11.alertManager.alert({ text: \"The item you are trying to delete cannot be found.\" });\n                return _context3.abrupt(\"continue\", 21);\n\n              case 18:\n                if ([\"SN|Component\", \"SN|Theme\"].includes(model.content_type)) {\n                  _this11.deactivateComponent(model, true);\n                }\n                _this11.modelManager.setItemToBeDeleted(model);\n                // Currently extensions are not notified of association until a full server sync completes.\n                // We manually notify observers.\n                _this11.modelManager.notifySyncObserversOfModels([model], SFModelManager.MappingSourceRemoteSaved);\n\n              case 21:\n                _iteratorNormalCompletion22 = true;\n                _context3.next = 12;\n                break;\n\n              case 24:\n                _context3.next = 30;\n                break;\n\n              case 26:\n                _context3.prev = 26;\n                _context3.t0 = _context3[\"catch\"](10);\n                _didIteratorError22 = true;\n                _iteratorError22 = _context3.t0;\n\n              case 30:\n                _context3.prev = 30;\n                _context3.prev = 31;\n\n                if (!_iteratorNormalCompletion22 && _iterator22.return) {\n                  _iterator22.return();\n                }\n\n              case 33:\n                _context3.prev = 33;\n\n                if (!_didIteratorError22) {\n                  _context3.next = 36;\n                  break;\n                }\n\n                throw _iteratorError22;\n\n              case 36:\n                return _context3.finish(33);\n\n              case 37:\n                return _context3.finish(30);\n\n              case 38:\n\n                _this11.syncManager.sync();\n                reply = { deleted: true };\n                _context3.next = 43;\n                break;\n\n              case 42:\n                // Rejected by user\n                reply = { deleted: false };\n\n              case 43:\n\n                _this11.replyToMessage(component, message, reply);\n\n              case 44:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, _this11, [[10, 26, 30, 38], [31,, 33, 37]]);\n      })));\n    }\n  }, {\n    key: \"handleRequestPermissionsMessage\",\n    value: function handleRequestPermissionsMessage(component, message) {\n      var _this12 = this;\n\n      this.runWithPermissions(component, message.data.permissions, function () {\n        _this12.replyToMessage(component, message, { approved: true });\n      });\n    }\n  }, {\n    key: \"handleSetComponentDataMessage\",\n    value: function handleSetComponentDataMessage(component, message) {\n      var _this13 = this;\n\n      // A component setting its own data does not require special permissions\n      this.runWithPermissions(component, [], function () {\n        component.componentData = message.data.componentData;\n        _this13.modelManager.setItemDirty(component, true);\n        _this13.syncManager.sync();\n      });\n    }\n  }, {\n    key: \"handleToggleComponentMessage\",\n    value: function handleToggleComponentMessage(sourceComponent, targetComponent, message) {\n      this.toggleComponent(targetComponent);\n    }\n  }, {\n    key: \"toggleComponent\",\n    value: function toggleComponent(component) {\n      var _this14 = this;\n\n      if (component.area == \"modal\") {\n        this.openModalComponent(component);\n      } else {\n        if (component.active) {\n          this.deactivateComponent(component);\n        } else {\n          if (component.content_type == \"SN|Theme\") {\n            // Deactive currently active theme if new theme is not layerable\n            var activeThemes = this.getActiveThemes();\n\n            // Activate current before deactivating others, so as not to flicker\n            this.activateComponent(component);\n\n            if (!component.isLayerable()) {\n              setTimeout(function () {\n                var _iteratorNormalCompletion23 = true;\n                var _didIteratorError23 = false;\n                var _iteratorError23 = undefined;\n\n                try {\n                  for (var _iterator23 = activeThemes[Symbol.iterator](), _step23; !(_iteratorNormalCompletion23 = (_step23 = _iterator23.next()).done); _iteratorNormalCompletion23 = true) {\n                    var theme = _step23.value;\n\n                    if (theme && !theme.isLayerable()) {\n                      _this14.deactivateComponent(theme);\n                    }\n                  }\n                } catch (err) {\n                  _didIteratorError23 = true;\n                  _iteratorError23 = err;\n                } finally {\n                  try {\n                    if (!_iteratorNormalCompletion23 && _iterator23.return) {\n                      _iterator23.return();\n                    }\n                  } finally {\n                    if (_didIteratorError23) {\n                      throw _iteratorError23;\n                    }\n                  }\n                }\n              }, 10);\n            }\n          } else {\n            this.activateComponent(component);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"handleInstallLocalComponentMessage\",\n    value: function handleInstallLocalComponentMessage(sourceComponent, message) {\n      // Only extensions manager has this permission\n      if (this.nativeExtManager && !this.nativeExtManager.isSystemExtension(sourceComponent)) {\n        return;\n      }\n\n      var targetComponent = this.modelManager.findItem(message.data.uuid);\n      this.desktopManager.installComponent(targetComponent);\n    }\n  }, {\n    key: \"runWithPermissions\",\n    value: function runWithPermissions(component, requiredPermissions, runFunction) {\n      if (!component.permissions) {\n        component.permissions = [];\n      }\n\n      // Make copy as not to mutate input values\n      requiredPermissions = JSON.parse(JSON.stringify(requiredPermissions));\n\n      var acquiredPermissions = component.permissions;\n\n      var _loop4 = function _loop4(required) {\n        // Remove anything we already have\n        var respectiveAcquired = acquiredPermissions.find(function (candidate) {\n          return candidate.name == required.name;\n        });\n        if (!respectiveAcquired) {\n          return \"continue\";\n        }\n\n        // We now match on name, lets substract from required.content_types anything we have in acquired.\n        var requiredContentTypes = required.content_types;\n\n        if (!requiredContentTypes) {\n          // If this permission does not require any content types (i.e stream-context-item)\n          // then we can remove this from required since we match by name (respectiveAcquired.name == required.name)\n          _.pull(requiredPermissions, required);\n          return \"continue\";\n        }\n\n        var _iteratorNormalCompletion25 = true;\n        var _didIteratorError25 = false;\n        var _iteratorError25 = undefined;\n\n        try {\n          for (var _iterator25 = respectiveAcquired.content_types[Symbol.iterator](), _step25; !(_iteratorNormalCompletion25 = (_step25 = _iterator25.next()).done); _iteratorNormalCompletion25 = true) {\n            var acquiredContentType = _step25.value;\n\n            // console.log(\"Removing content_type\", acquiredContentType, \"from\", requiredContentTypes);\n            _.pull(requiredContentTypes, acquiredContentType);\n          }\n        } catch (err) {\n          _didIteratorError25 = true;\n          _iteratorError25 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion25 && _iterator25.return) {\n              _iterator25.return();\n            }\n          } finally {\n            if (_didIteratorError25) {\n              throw _iteratorError25;\n            }\n          }\n        }\n\n        if (requiredContentTypes.length == 0) {\n          // We've removed all acquired and end up with zero, means we already have all these permissions\n          _.pull(requiredPermissions, required);\n        }\n      };\n\n      var _iteratorNormalCompletion24 = true;\n      var _didIteratorError24 = false;\n      var _iteratorError24 = undefined;\n\n      try {\n        for (var _iterator24 = requiredPermissions.slice()[Symbol.iterator](), _step24; !(_iteratorNormalCompletion24 = (_step24 = _iterator24.next()).done); _iteratorNormalCompletion24 = true) {\n          var required = _step24.value;\n\n          var _ret4 = _loop4(required);\n\n          if (_ret4 === \"continue\") continue;\n        }\n      } catch (err) {\n        _didIteratorError24 = true;\n        _iteratorError24 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion24 && _iterator24.return) {\n            _iterator24.return();\n          }\n        } finally {\n          if (_didIteratorError24) {\n            throw _iteratorError24;\n          }\n        }\n      }\n\n      if (requiredPermissions.length > 0) {\n        this.promptForPermissions(component, requiredPermissions, function (approved) {\n          if (approved) {\n            runFunction();\n          }\n        });\n      } else {\n        runFunction();\n      }\n    }\n  }, {\n    key: \"promptForPermissions\",\n    value: function promptForPermissions(component, permissions, callback) {\n      var _this15 = this;\n\n      var params = {};\n      params.component = component;\n      params.permissions = permissions;\n      params.permissionsString = this.permissionsStringForPermissions(permissions, component);\n      params.actionBlock = callback;\n\n      params.callback = function (approved) {\n        if (approved) {\n          var _loop5 = function _loop5(permission) {\n            var matchingPermission = component.permissions.find(function (candidate) {\n              return candidate.name == permission.name;\n            });\n            if (!matchingPermission) {\n              component.permissions.push(permission);\n            } else {\n              // Permission already exists, but content_types may have been expanded\n              var contentTypes = matchingPermission.content_types || [];\n              matchingPermission.content_types = _.uniq(contentTypes.concat(permission.content_types));\n            }\n          };\n\n          var _iteratorNormalCompletion26 = true;\n          var _didIteratorError26 = false;\n          var _iteratorError26 = undefined;\n\n          try {\n            for (var _iterator26 = permissions[Symbol.iterator](), _step26; !(_iteratorNormalCompletion26 = (_step26 = _iterator26.next()).done); _iteratorNormalCompletion26 = true) {\n              var permission = _step26.value;\n\n              _loop5(permission);\n            }\n          } catch (err) {\n            _didIteratorError26 = true;\n            _iteratorError26 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion26 && _iterator26.return) {\n                _iterator26.return();\n              }\n            } finally {\n              if (_didIteratorError26) {\n                throw _iteratorError26;\n              }\n            }\n          }\n\n          _this15.modelManager.setItemDirty(component, true);\n          _this15.syncManager.sync();\n        }\n\n        _this15.permissionDialogs = _this15.permissionDialogs.filter(function (pendingDialog) {\n          // Remove self\n          if (pendingDialog == params) {\n            pendingDialog.actionBlock && pendingDialog.actionBlock(approved);\n            return false;\n          }\n\n          var containsObjectSubset = function containsObjectSubset(source, target) {\n            return !target.some(function (val) {\n              return !source.find(function (candidate) {\n                return JSON.stringify(candidate) === JSON.stringify(val);\n              });\n            });\n          };\n\n          if (pendingDialog.component == component) {\n            // remove pending dialogs that are encapsulated by already approved permissions, and run its function\n            if (pendingDialog.permissions == permissions || containsObjectSubset(permissions, pendingDialog.permissions)) {\n              // If approved, run the action block. Otherwise, if canceled, cancel any pending ones as well, since the user was\n              // explicit in their intentions\n              if (approved) {\n                pendingDialog.actionBlock && pendingDialog.actionBlock(approved);\n              }\n              return false;\n            }\n          }\n          return true;\n        });\n\n        if (_this15.permissionDialogs.length > 0) {\n          _this15.presentPermissionsDialog(_this15.permissionDialogs[0]);\n        }\n      };\n\n      // since these calls are asyncronous, multiple dialogs may be requested at the same time. We only want to present one and trigger all callbacks based on one modal result\n      var existingDialog = _.find(this.permissionDialogs, { component: component });\n\n      this.permissionDialogs.push(params);\n\n      if (!existingDialog) {\n        this.presentPermissionsDialog(params);\n      } else {\n        console.log(\"Existing dialog, not presenting.\");\n      }\n    }\n  }, {\n    key: \"presentPermissionsDialog\",\n    value: function presentPermissionsDialog(dialog) {\n      console.error(\"Must override\");\n    }\n  }, {\n    key: \"openModalComponent\",\n    value: function openModalComponent(component) {\n      console.error(\"Must override\");\n    }\n  }, {\n    key: \"registerHandler\",\n    value: function registerHandler(handler) {\n      this.handlers.push(handler);\n    }\n  }, {\n    key: \"deregisterHandler\",\n    value: function deregisterHandler(identifier) {\n      var handler = _.find(this.handlers, { identifier: identifier });\n      if (!handler) {\n        console.log(\"Attempting to deregister non-existing handler\");\n        return;\n      }\n      this.handlers.splice(this.handlers.indexOf(handler), 1);\n    }\n\n    // Called by other views when the iframe is ready\n\n  }, {\n    key: \"registerComponentWindow\",\n    value: function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(component, componentWindow) {\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (component.window === componentWindow) {\n                  if (this.loggingEnabled) {\n                    console.log(\"Web|componentManager\", \"attempting to re-register same component window.\");\n                  }\n                }\n\n                if (this.loggingEnabled) {\n                  console.log(\"Web|componentManager|registerComponentWindow\", component);\n                }\n                component.window = componentWindow;\n                _context4.next = 5;\n                return SFJS.crypto.generateUUID();\n\n              case 5:\n                component.sessionKey = _context4.sent;\n\n                this.sendMessageToComponent(component, {\n                  action: \"component-registered\",\n                  sessionKey: component.sessionKey,\n                  componentData: component.componentData,\n                  data: {\n                    uuid: component.uuid,\n                    environment: this.environment,\n                    platform: this.platform,\n                    activeThemeUrls: this.urlsForActiveThemes()\n                  }\n                });\n\n                this.postActiveThemesToComponent(component);\n\n                if (this.desktopManager) {\n                  this.desktopManager.notifyComponentActivation(component);\n                }\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function registerComponentWindow(_x5, _x6) {\n        return _ref5.apply(this, arguments);\n      }\n\n      return registerComponentWindow;\n    }()\n  }, {\n    key: \"activateComponent\",\n    value: function activateComponent(component) {\n      var _this16 = this;\n\n      var dontSync = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      var didChange = component.active != true;\n\n      component.active = true;\n\n      var _loop6 = function _loop6(handler) {\n        if (handler.areas.includes(component.area) || handler.areas.includes(\"*\")) {\n          // We want to run the handler in a $timeout so the UI updates, but we also don't want it to run asyncronously\n          // so that the steps below this one are run before the handler. So we run in a waitTimeout.\n          // Update 12/18: We were using this.waitTimeout previously, however, that caused the iframe.onload callback to never be called\n          // for some reason for iframes on desktop inside the revision-preview-modal. So we'll use safeApply instead. I'm not quite sure\n          // where the original \"so the UI updates\" comment applies to, but we'll have to keep an eye out to see if this causes problems somewhere else.\n          _this16.$uiRunner(function () {\n            handler.activationHandler && handler.activationHandler(component);\n          });\n        }\n      };\n\n      var _iteratorNormalCompletion27 = true;\n      var _didIteratorError27 = false;\n      var _iteratorError27 = undefined;\n\n      try {\n        for (var _iterator27 = this.handlers[Symbol.iterator](), _step27; !(_iteratorNormalCompletion27 = (_step27 = _iterator27.next()).done); _iteratorNormalCompletion27 = true) {\n          var handler = _step27.value;\n\n          _loop6(handler);\n        }\n      } catch (err) {\n        _didIteratorError27 = true;\n        _iteratorError27 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion27 && _iterator27.return) {\n            _iterator27.return();\n          }\n        } finally {\n          if (_didIteratorError27) {\n            throw _iteratorError27;\n          }\n        }\n      }\n\n      if (didChange && !dontSync) {\n        this.modelManager.setItemDirty(component, true);\n        this.syncManager.sync();\n      }\n\n      if (!this.activeComponents.includes(component)) {\n        this.activeComponents.push(component);\n      }\n\n      if (component.area == \"themes\") {\n        this.postActiveThemesToAllComponents();\n      }\n    }\n  }, {\n    key: \"deactivateComponent\",\n    value: function deactivateComponent(component) {\n      var _this17 = this;\n\n      var dontSync = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      var didChange = component.active != false;\n      component.active = false;\n      component.sessionKey = null;\n\n      var _loop7 = function _loop7(handler) {\n        if (handler.areas.includes(component.area) || handler.areas.includes(\"*\")) {\n          // See comment in activateComponent regarding safeApply and awaitTimeout\n          _this17.$uiRunner(function () {\n            handler.activationHandler && handler.activationHandler(component);\n          });\n        }\n      };\n\n      var _iteratorNormalCompletion28 = true;\n      var _didIteratorError28 = false;\n      var _iteratorError28 = undefined;\n\n      try {\n        for (var _iterator28 = this.handlers[Symbol.iterator](), _step28; !(_iteratorNormalCompletion28 = (_step28 = _iterator28.next()).done); _iteratorNormalCompletion28 = true) {\n          var handler = _step28.value;\n\n          _loop7(handler);\n        }\n      } catch (err) {\n        _didIteratorError28 = true;\n        _iteratorError28 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion28 && _iterator28.return) {\n            _iterator28.return();\n          }\n        } finally {\n          if (_didIteratorError28) {\n            throw _iteratorError28;\n          }\n        }\n      }\n\n      if (didChange && !dontSync) {\n        this.modelManager.setItemDirty(component, true);\n        this.syncManager.sync();\n      }\n\n      _.pull(this.activeComponents, component);\n\n      this.streamObservers = this.streamObservers.filter(function (o) {\n        return o.component !== component;\n      });\n\n      this.contextStreamObservers = this.contextStreamObservers.filter(function (o) {\n        return o.component !== component;\n      });\n\n      if (component.area == \"themes\") {\n        this.postActiveThemesToAllComponents();\n      }\n    }\n  }, {\n    key: \"reloadComponent\",\n    value: function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(component) {\n        var _this18 = this;\n\n        var _loop8, _iteratorNormalCompletion29, _didIteratorError29, _iteratorError29, _iterator29, _step29, handler;\n\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                //\n                // Do soft deactivate\n                //\n                component.active = false;\n\n                _loop8 = function _loop8(handler) {\n                  if (handler.areas.includes(component.area) || handler.areas.includes(\"*\")) {\n                    // See comment in activateComponent regarding safeApply and awaitTimeout\n                    _this18.$uiRunner(function () {\n                      handler.activationHandler && handler.activationHandler(component);\n                    });\n                  }\n                };\n\n                _iteratorNormalCompletion29 = true;\n                _didIteratorError29 = false;\n                _iteratorError29 = undefined;\n                _context5.prev = 5;\n                for (_iterator29 = this.handlers[Symbol.iterator](); !(_iteratorNormalCompletion29 = (_step29 = _iterator29.next()).done); _iteratorNormalCompletion29 = true) {\n                  handler = _step29.value;\n\n                  _loop8(handler);\n                }\n\n                _context5.next = 13;\n                break;\n\n              case 9:\n                _context5.prev = 9;\n                _context5.t0 = _context5[\"catch\"](5);\n                _didIteratorError29 = true;\n                _iteratorError29 = _context5.t0;\n\n              case 13:\n                _context5.prev = 13;\n                _context5.prev = 14;\n\n                if (!_iteratorNormalCompletion29 && _iterator29.return) {\n                  _iterator29.return();\n                }\n\n              case 16:\n                _context5.prev = 16;\n\n                if (!_didIteratorError29) {\n                  _context5.next = 19;\n                  break;\n                }\n\n                throw _iteratorError29;\n\n              case 19:\n                return _context5.finish(16);\n\n              case 20:\n                return _context5.finish(13);\n\n              case 21:\n                this.streamObservers = this.streamObservers.filter(function (o) {\n                  return o.component !== component;\n                });\n\n                this.contextStreamObservers = this.contextStreamObservers.filter(function (o) {\n                  return o.component !== component;\n                });\n\n                if (component.area == \"themes\") {\n                  this.postActiveThemesToAllComponents();\n                }\n\n                //\n                // Do soft activate\n                //\n\n                return _context5.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this18.$timeout(function () {\n                    component.active = true;\n                    var _iteratorNormalCompletion30 = true;\n                    var _didIteratorError30 = false;\n                    var _iteratorError30 = undefined;\n\n                    try {\n                      for (var _iterator30 = _this18.handlers[Symbol.iterator](), _step30; !(_iteratorNormalCompletion30 = (_step30 = _iterator30.next()).done); _iteratorNormalCompletion30 = true) {\n                        var handler = _step30.value;\n\n                        if (handler.areas.includes(component.area) || handler.areas.includes(\"*\")) {\n                          // See comment in activateComponent regarding safeApply and awaitTimeout\n                          _this18.$uiRunner(function () {\n                            handler.activationHandler && handler.activationHandler(component);\n                            resolve();\n                          });\n                        }\n                      }\n                    } catch (err) {\n                      _didIteratorError30 = true;\n                      _iteratorError30 = err;\n                    } finally {\n                      try {\n                        if (!_iteratorNormalCompletion30 && _iterator30.return) {\n                          _iterator30.return();\n                        }\n                      } finally {\n                        if (_didIteratorError30) {\n                          throw _iteratorError30;\n                        }\n                      }\n                    }\n\n                    if (!_this18.activeComponents.includes(component)) {\n                      _this18.activeComponents.push(component);\n                    }\n\n                    if (component.area == \"themes\") {\n                      _this18.postActiveThemesToAllComponents();\n                    }\n                    // Resolve again in case first resolve in for loop isn't reached.\n                    // Should be no effect if resolved twice, only first will be used.\n                    resolve();\n                  });\n                }));\n\n              case 25:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[5, 9, 13, 21], [14,, 16, 20]]);\n      }));\n\n      function reloadComponent(_x9) {\n        return _ref6.apply(this, arguments);\n      }\n\n      return reloadComponent;\n    }()\n  }, {\n    key: \"deleteComponent\",\n    value: function deleteComponent(component) {\n      this.modelManager.setItemToBeDeleted(component);\n      this.syncManager.sync();\n    }\n  }, {\n    key: \"isComponentActive\",\n    value: function isComponentActive(component) {\n      return component.active;\n    }\n  }, {\n    key: \"iframeForComponent\",\n    value: function iframeForComponent(component) {\n      var _iteratorNormalCompletion31 = true;\n      var _didIteratorError31 = false;\n      var _iteratorError31 = undefined;\n\n      try {\n        for (var _iterator31 = Array.from(document.getElementsByTagName(\"iframe\"))[Symbol.iterator](), _step31; !(_iteratorNormalCompletion31 = (_step31 = _iterator31.next()).done); _iteratorNormalCompletion31 = true) {\n          var frame = _step31.value;\n\n          var componentId = frame.dataset.componentId;\n          if (componentId === component.uuid) {\n            return frame;\n          }\n        }\n      } catch (err) {\n        _didIteratorError31 = true;\n        _iteratorError31 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion31 && _iterator31.return) {\n            _iterator31.return();\n          }\n        } finally {\n          if (_didIteratorError31) {\n            throw _iteratorError31;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"focusChangedForComponent\",\n    value: function focusChangedForComponent(component) {\n      var focused = document.activeElement == this.iframeForComponent(component);\n      var _iteratorNormalCompletion32 = true;\n      var _didIteratorError32 = false;\n      var _iteratorError32 = undefined;\n\n      try {\n        for (var _iterator32 = this.handlers[Symbol.iterator](), _step32; !(_iteratorNormalCompletion32 = (_step32 = _iterator32.next()).done); _iteratorNormalCompletion32 = true) {\n          var handler = _step32.value;\n\n          // Notify all handlers, and not just ones that match this component type\n          handler.focusHandler && handler.focusHandler(component, focused);\n        }\n      } catch (err) {\n        _didIteratorError32 = true;\n        _iteratorError32 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion32 && _iterator32.return) {\n            _iterator32.return();\n          }\n        } finally {\n          if (_didIteratorError32) {\n            throw _iteratorError32;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"handleSetSizeEvent\",\n    value: function handleSetSizeEvent(component, data) {\n      var setSize = function setSize(element, size) {\n        var widthString = typeof size.width === 'string' ? size.width : data.width + \"px\";\n        var heightString = typeof size.height === 'string' ? size.height : data.height + \"px\";\n        if (element) {\n          element.setAttribute(\"style\", \"width:\" + widthString + \"; height:\" + heightString + \";\");\n        }\n      };\n\n      if (component.area == \"rooms\" || component.area == \"modal\") {\n        var selector = component.area == \"rooms\" ? \"inner\" : \"outer\";\n        var content = document.getElementById(\"component-content-\" + selector + \"-\" + component.uuid);\n        if (content) {\n          setSize(content, data);\n        }\n      } else {\n        var iframe = this.iframeForComponent(component);\n        if (!iframe) {\n          return;\n        }\n\n        setSize(iframe, data);\n\n        // On Firefox, resizing a component iframe does not seem to have an effect with editor-stack extensions.\n        // Sizing the parent does the trick, however, we can't do this globally, otherwise, areas like the note-tags will\n        // not be able to expand outside of the bounds (to display autocomplete, for example).\n        if (component.area == \"editor-stack\") {\n          var parent = iframe.parentElement;\n          if (parent) {\n            setSize(parent, data);\n          }\n        }\n\n        // content object in this case is === to the iframe object above. This is probably\n        // legacy code from when we would size content and container individually, which we no longer do.\n        // var content = document.getElementById(`component-iframe-${component.uuid}`);\n        // console.log(\"content === iframe\", content == iframe);\n        // if(content) {\n        //   setSize(content, data);\n        // }\n      }\n    }\n  }, {\n    key: \"editorForNote\",\n    value: function editorForNote(note) {\n      var editors = this.componentsForArea(\"editor-editor\");\n      var _iteratorNormalCompletion33 = true;\n      var _didIteratorError33 = false;\n      var _iteratorError33 = undefined;\n\n      try {\n        for (var _iterator33 = editors[Symbol.iterator](), _step33; !(_iteratorNormalCompletion33 = (_step33 = _iterator33.next()).done); _iteratorNormalCompletion33 = true) {\n          var editor = _step33.value;\n\n          if (editor.isExplicitlyEnabledForItem(note)) {\n            return editor;\n          }\n        }\n\n        // No editor found for note. Use default editor, if note does not prefer system editor\n      } catch (err) {\n        _didIteratorError33 = true;\n        _iteratorError33 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion33 && _iterator33.return) {\n            _iterator33.return();\n          }\n        } finally {\n          if (_didIteratorError33) {\n            throw _iteratorError33;\n          }\n        }\n      }\n\n      if (this.isMobile) {\n        if (!note.content.mobilePrefersPlainEditor) {\n          return this.getDefaultEditor();\n        }\n      } else {\n        if (!note.getAppDataItem(\"prefersPlainEditor\")) {\n          return editors.filter(function (e) {\n            return e.isDefaultEditor();\n          })[0];\n        }\n      }\n    }\n  }, {\n    key: \"permissionsStringForPermissions\",\n    value: function permissionsStringForPermissions(permissions, component) {\n      var _this19 = this;\n\n      var finalString = \"\";\n      var permissionsCount = permissions.length;\n\n      var addSeparator = function addSeparator(index, length) {\n        if (index > 0) {\n          if (index == length - 1) {\n            if (length == 2) {\n              return \" and \";\n            } else {\n              return \", and \";\n            }\n          } else {\n            return \", \";\n          }\n        }\n\n        return \"\";\n      };\n\n      permissions.forEach(function (permission, index) {\n        if (permission.name === \"stream-items\") {\n          var types = permission.content_types.map(function (type) {\n            var desc = _this19.modelManager.humanReadableDisplayForContentType(type);\n            if (desc) {\n              return desc + \"s\";\n            } else {\n              return \"items of type \" + type;\n            }\n          });\n          var typesString = \"\";\n\n          for (var i = 0; i < types.length; i++) {\n            var type = types[i];\n            typesString += addSeparator(i, types.length + permissionsCount - index - 1);\n            typesString += type;\n          }\n\n          finalString += addSeparator(index, permissionsCount);\n\n          finalString += typesString;\n\n          if (types.length >= 2 && index < permissionsCount - 1) {\n            // If you have a list of types, and still an additional root-level permission coming up, add a comma\n            finalString += \", \";\n          }\n        } else if (permission.name === \"stream-context-item\") {\n          var mapping = {\n            \"editor-stack\": \"working note\",\n            \"note-tags\": \"working note\",\n            \"editor-editor\": \"working note\"\n          };\n\n          finalString += addSeparator(index, permissionsCount, true);\n\n          finalString += mapping[component.area];\n        }\n      });\n\n      return finalString + \".\";\n    }\n  }, {\n    key: \"components\",\n    get: function get() {\n      return this.modelManager.allItemsMatchingTypes([\"SN|Component\", \"SN|Theme\"]);\n    }\n  }]);\n\n  return SNComponentManager;\n}();\n\n;\nvar SNComponent = exports.SNComponent = function (_SFItem) {\n  _inherits(SNComponent, _SFItem);\n\n  function SNComponent(json_obj) {\n    _classCallCheck(this, SNComponent);\n\n    // If making a copy of an existing component (usually during sign in if you have a component active in the session),\n    // which may have window set, you may get a cross-origin exception since you'll be trying to copy the window. So we clear it here.\n    json_obj.window = null;\n\n    var _this20 = _possibleConstructorReturn(this, (SNComponent.__proto__ || Object.getPrototypeOf(SNComponent)).call(this, json_obj));\n\n    if (!_this20.componentData) {\n      _this20.componentData = {};\n    }\n\n    if (!_this20.disassociatedItemIds) {\n      _this20.disassociatedItemIds = [];\n    }\n\n    if (!_this20.associatedItemIds) {\n      _this20.associatedItemIds = [];\n    }\n    return _this20;\n  }\n\n  _createClass(SNComponent, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      /* Legacy */\n      // We don't want to set the url directly, as we'd like to phase it out.\n      // If the content.url exists, we'll transfer it to legacy_url\n      // We'll only need to set this if content.hosted_url is blank, otherwise, hosted_url is the url replacement.\n      if (!content.hosted_url) {\n        this.legacy_url = content.url;\n      }\n\n      /* New */\n      this.local_url = content.local_url;\n      this.hosted_url = content.hosted_url || content.url;\n      this.offlineOnly = content.offlineOnly;\n\n      if (content.valid_until) {\n        this.valid_until = new Date(content.valid_until);\n      }\n\n      this.name = content.name;\n      this.autoupdateDisabled = content.autoupdateDisabled;\n\n      this.package_info = content.package_info;\n\n      // the location in the view this component is located in. Valid values are currently tags-list, note-tags, and editor-stack`\n      this.area = content.area;\n\n      this.permissions = content.permissions;\n      if (!this.permissions) {\n        this.permissions = [];\n      }\n\n      this.active = content.active;\n\n      // custom data that a component can store in itself\n      this.componentData = content.componentData || {};\n\n      // items that have requested a component to be disabled in its context\n      this.disassociatedItemIds = content.disassociatedItemIds || [];\n\n      // items that have requested a component to be enabled in its context\n      this.associatedItemIds = content.associatedItemIds || [];\n    }\n  }, {\n    key: \"handleDeletedContent\",\n    value: function handleDeletedContent() {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"handleDeletedContent\", this).call(this);\n\n      this.active = false;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        legacy_url: this.legacy_url,\n        hosted_url: this.hosted_url,\n        local_url: this.local_url,\n        valid_until: this.valid_until,\n        offlineOnly: this.offlineOnly,\n        name: this.name,\n        area: this.area,\n        package_info: this.package_info,\n        permissions: this.permissions,\n        active: this.active,\n        autoupdateDisabled: this.autoupdateDisabled,\n        componentData: this.componentData,\n        disassociatedItemIds: this.disassociatedItemIds,\n        associatedItemIds: this.associatedItemIds\n      };\n\n      var superParams = _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"isEditor\",\n    value: function isEditor() {\n      return this.area == \"editor-editor\";\n    }\n  }, {\n    key: \"isTheme\",\n    value: function isTheme() {\n      return this.content_type == \"SN|Theme\" || this.area == \"themes\";\n    }\n  }, {\n    key: \"isDefaultEditor\",\n    value: function isDefaultEditor() {\n      return this.getAppDataItem(\"defaultEditor\") == true;\n    }\n  }, {\n    key: \"setLastSize\",\n    value: function setLastSize(size) {\n      this.setAppDataItem(\"lastSize\", size);\n    }\n  }, {\n    key: \"getLastSize\",\n    value: function getLastSize() {\n      return this.getAppDataItem(\"lastSize\");\n    }\n  }, {\n    key: \"acceptsThemes\",\n    value: function acceptsThemes() {\n      if (this.content.package_info && \"acceptsThemes\" in this.content.package_info) {\n        return this.content.package_info.acceptsThemes;\n      }\n      return true;\n    }\n\n    /*\n      The key used to look up data that this component may have saved to an item.\n      This key will be look up on the item, and not on itself.\n     */\n\n  }, {\n    key: \"getClientDataKey\",\n    value: function getClientDataKey() {\n      if (this.legacy_url) {\n        return this.legacy_url;\n      } else {\n        return this.uuid;\n      }\n    }\n  }, {\n    key: \"hasValidHostedUrl\",\n    value: function hasValidHostedUrl() {\n      return this.hosted_url || this.legacy_url;\n    }\n  }, {\n    key: \"keysToIgnoreWhenCheckingContentEquality\",\n    value: function keysToIgnoreWhenCheckingContentEquality() {\n      return [\"active\", \"disassociatedItemIds\", \"associatedItemIds\"].concat(_get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"keysToIgnoreWhenCheckingContentEquality\", this).call(this));\n    }\n\n    /*\n      An associative component depends on being explicitly activated for a given item, compared to a dissaciative component,\n      which is enabled by default in areas unrelated to a certain item.\n     */\n\n  }, {\n    key: \"isAssociative\",\n    value: function isAssociative() {\n      return Component.associativeAreas().includes(this.area);\n    }\n  }, {\n    key: \"associateWithItem\",\n    value: function associateWithItem(item) {\n      this.associatedItemIds.push(item.uuid);\n    }\n  }, {\n    key: \"isExplicitlyEnabledForItem\",\n    value: function isExplicitlyEnabledForItem(item) {\n      return this.associatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"isExplicitlyDisabledForItem\",\n    value: function isExplicitlyDisabledForItem(item) {\n      return this.disassociatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Component\";\n    }\n  }], [{\n    key: \"associativeAreas\",\n    value: function associativeAreas() {\n      return [\"editor-editor\"];\n    }\n  }]);\n\n  return SNComponent;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEditor = exports.SNEditor = function (_SFItem2) {\n  _inherits(SNEditor, _SFItem2);\n\n  function SNEditor(json_obj) {\n    _classCallCheck(this, SNEditor);\n\n    var _this21 = _possibleConstructorReturn(this, (SNEditor.__proto__ || Object.getPrototypeOf(SNEditor)).call(this, json_obj));\n\n    if (!_this21.notes) {\n      _this21.notes = [];\n    }\n    if (!_this21.data) {\n      _this21.data = {};\n    }\n    return _this21;\n  }\n\n  _createClass(SNEditor, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n      this.name = content.name;\n      this.data = content.data || {};\n      this.default = content.default;\n      this.systemEditor = content.systemEditor;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        url: this.url,\n        name: this.name,\n        data: this.data,\n        default: this.default,\n        systemEditor: this.systemEditor\n      };\n\n      var superParams = _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"referenceParams\",\n    value: function referenceParams() {\n      var references = _.map(this.notes, function (note) {\n        return { uuid: note.uuid, content_type: note.content_type };\n      });\n\n      return references;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, item)) {\n          this.notes.push(item);\n        }\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.pull(this.notes, item);\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeAndDirtyAllRelationships\",\n    value: function removeAndDirtyAllRelationships() {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeAndDirtyAllRelationships\", this).call(this);\n      this.notes = [];\n    }\n  }, {\n    key: \"removeReferencesNotPresentIn\",\n    value: function removeReferencesNotPresentIn(references) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeReferencesNotPresentIn\", this).call(this, references);\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(this.notes, { uuid: note.uuid });\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"potentialItemOfInterestHasChangedItsUUID\",\n    value: function potentialItemOfInterestHasChangedItsUUID(newItem, oldUUID, newUUID) {\n      if (newItem.content_type === \"Note\" && _.find(this.notes, { uuid: oldUUID })) {\n        _.remove(this.notes, { uuid: oldUUID });\n        this.notes.push(newItem);\n      }\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(key, value) {\n      var dataHasChanged = JSON.stringify(this.data[key]) !== JSON.stringify(value);\n      if (dataHasChanged) {\n        this.data[key] = value;\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"dataForKey\",\n    value: function dataForKey(key) {\n      return this.data[key] || {};\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Editor\";\n    }\n  }]);\n\n  return SNEditor;\n}(_standardFileJs.SFItem);\n\n;\nvar Action = exports.Action = function Action(json) {\n  _classCallCheck(this, Action);\n\n  _.merge(this, json);\n  this.running = false; // in case running=true was synced with server since model is uploaded nondiscriminatory\n  this.error = false;\n  if (this.lastExecuted) {\n    // is string\n    this.lastExecuted = new Date(this.lastExecuted);\n  }\n};\n\nvar SNExtension = exports.SNExtension = function (_SFItem3) {\n  _inherits(SNExtension, _SFItem3);\n\n  function SNExtension(json) {\n    _classCallCheck(this, SNExtension);\n\n    var _this22 = _possibleConstructorReturn(this, (SNExtension.__proto__ || Object.getPrototypeOf(SNExtension)).call(this, json));\n\n    if (json.actions) {\n      _this22.actions = json.actions.map(function (action) {\n        return new Action(action);\n      });\n    }\n\n    if (!_this22.actions) {\n      _this22.actions = [];\n    }\n    return _this22;\n  }\n\n  _createClass(SNExtension, [{\n    key: \"actionsWithContextForItem\",\n    value: function actionsWithContextForItem(item) {\n      return this.actions.filter(function (action) {\n        return action.context == item.content_type || action.context == \"Item\";\n      });\n    }\n  }, {\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.description = content.description;\n      this.url = content.url;\n      this.name = content.name;\n      this.package_info = content.package_info;\n      this.supported_types = content.supported_types;\n      if (content.actions) {\n        this.actions = content.actions.map(function (action) {\n          return new Action(action);\n        });\n      }\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        name: this.name,\n        url: this.url,\n        package_info: this.package_info,\n        description: this.description,\n        actions: this.actions.map(function (a) {\n          return _.omit(a, [\"subrows\", \"subactions\"]);\n        }),\n        supported_types: this.supported_types\n      };\n\n      var superParams = _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Extension\";\n    }\n  }]);\n\n  return SNExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNNote = exports.SNNote = function (_SFItem4) {\n  _inherits(SNNote, _SFItem4);\n\n  function SNNote(json_obj) {\n    _classCallCheck(this, SNNote);\n\n    var _this23 = _possibleConstructorReturn(this, (SNNote.__proto__ || Object.getPrototypeOf(SNNote)).call(this, json_obj));\n\n    if (!_this23.text) {\n      // Some external editors can't handle a null value for text.\n      // Notes created on mobile with no text have a null value for it,\n      // so we'll just set a default here.\n      _this23.text = \"\";\n    }\n\n    if (!_this23.tags) {\n      _this23.tags = [];\n    }\n    return _this23;\n  }\n\n  _createClass(SNNote, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n      this.text = content.text;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title,\n        text: this.text\n      };\n\n      var superParams = _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      /*\n      Legacy.\n      Previously, note/tag relationships were bidirectional, however in some cases there\n      may be broken links such that a note has references to a tag and not vice versa.\n      Now, only tags contain references to notes. For old notes that may have references to tags,\n      we want to transfer them over to the tag.\n       */\n      if (item.content_type == \"Tag\") {\n        item.addItemAsRelationship(this);\n      }\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"setIsBeingReferencedBy\",\n    value: function setIsBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"setIsNoLongerBeingReferencedBy\",\n    value: function setIsNoLongerBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsNoLongerBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      this.tags.forEach(function (tag) {\n        _.remove(tag.notes, { uuid: this.uuid });\n      }.bind(this));\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"informReferencesOfUUIDChange\", this).call(this);\n      var _iteratorNormalCompletion34 = true;\n      var _didIteratorError34 = false;\n      var _iteratorError34 = undefined;\n\n      try {\n        for (var _iterator34 = this.tags[Symbol.iterator](), _step34; !(_iteratorNormalCompletion34 = (_step34 = _iterator34.next()).done); _iteratorNormalCompletion34 = true) {\n          var tag = _step34.value;\n\n          _.remove(tag.notes, { uuid: oldUUID });\n          tag.notes.push(this);\n        }\n      } catch (err) {\n        _didIteratorError34 = true;\n        _iteratorError34 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion34 && _iterator34.return) {\n            _iterator34.return();\n          }\n        } finally {\n          if (_didIteratorError34) {\n            throw _iteratorError34;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"tagDidFinishSyncing\",\n    value: function tagDidFinishSyncing(tag) {\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"safeText\",\n    value: function safeText() {\n      return this.text || \"\";\n    }\n  }, {\n    key: \"safeTitle\",\n    value: function safeTitle() {\n      return this.title || \"\";\n    }\n  }, {\n    key: \"clearSavedTagsString\",\n    value: function clearSavedTagsString() {\n      this.savedTagsString = null;\n    }\n  }, {\n    key: \"tagsString\",\n    value: function tagsString() {\n      this.savedTagsString = SNTag.arrayToDisplayString(this.tags);\n      return this.savedTagsString;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Note\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Note\";\n    }\n  }], [{\n    key: \"filterDummyNotes\",\n    value: function filterDummyNotes(notes) {\n      var filtered = notes.filter(function (note) {\n        return note.dummy == false || note.dummy == null;\n      });\n      return filtered;\n    }\n  }]);\n\n  return SNNote;\n}(_standardFileJs.SFItem);\n\n;\nvar SNTag = exports.SNTag = function (_SFItem5) {\n  _inherits(SNTag, _SFItem5);\n\n  function SNTag(json_obj) {\n    _classCallCheck(this, SNTag);\n\n    var _this24 = _possibleConstructorReturn(this, (SNTag.__proto__ || Object.getPrototypeOf(SNTag)).call(this, json_obj));\n\n    if (!_this24.content_type) {\n      _this24.content_type = \"Tag\";\n    }\n\n    if (!_this24.notes) {\n      _this24.notes = [];\n    }\n    return _this24;\n  }\n\n  _createClass(SNTag, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title\n      };\n\n      var superParams = _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, { uuid: item.uuid })) {\n          this.notes.push(item);\n          item.tags.push(this);\n        }\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.remove(this.notes, { uuid: item.uuid });\n        _.remove(item.tags, { uuid: this.uuid });\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"updateLocalRelationships\",\n    value: function updateLocalRelationships() {\n      var references = this.content.references;\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.slice().forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(note.tags, { uuid: this.uuid });\n          _.remove(this.notes, { uuid: note.uuid });\n\n          note.setIsNoLongerBeingReferencedBy(this);\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      var _this25 = this;\n\n      this.notes.forEach(function (note) {\n        _.remove(note.tags, { uuid: _this25.uuid });\n        note.setIsNoLongerBeingReferencedBy(_this25);\n      });\n\n      this.notes.length = 0;\n\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      var _iteratorNormalCompletion35 = true;\n      var _didIteratorError35 = false;\n      var _iteratorError35 = undefined;\n\n      try {\n        for (var _iterator35 = this.notes[Symbol.iterator](), _step35; !(_iteratorNormalCompletion35 = (_step35 = _iterator35.next()).done); _iteratorNormalCompletion35 = true) {\n          var note = _step35.value;\n\n          _.remove(note.tags, { uuid: oldUUID });\n          note.tags.push(this);\n        }\n      } catch (err) {\n        _didIteratorError35 = true;\n        _iteratorError35 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion35 && _iterator35.return) {\n            _iterator35.return();\n          }\n        } finally {\n          if (_didIteratorError35) {\n            throw _iteratorError35;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"didFinishSyncing\",\n    value: function didFinishSyncing() {\n      var _iteratorNormalCompletion36 = true;\n      var _didIteratorError36 = false;\n      var _iteratorError36 = undefined;\n\n      try {\n        for (var _iterator36 = this.notes[Symbol.iterator](), _step36; !(_iteratorNormalCompletion36 = (_step36 = _iterator36.next()).done); _iteratorNormalCompletion36 = true) {\n          var note = _step36.value;\n\n          note.tagDidFinishSyncing(this);\n        }\n      } catch (err) {\n        _didIteratorError36 = true;\n        _iteratorError36 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion36 && _iterator36.return) {\n            _iterator36.return();\n          }\n        } finally {\n          if (_didIteratorError36) {\n            throw _iteratorError36;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"isSmartTag\",\n    value: function isSmartTag() {\n      return this.content_type == \"SN|SmartTag\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Tag\";\n    }\n  }], [{\n    key: \"arrayToDisplayString\",\n    value: function arrayToDisplayString(tags) {\n      return tags.sort(function (a, b) {\n        return a.title > b.title;\n      }).map(function (tag, i) {\n        return \"#\" + tag.title;\n      }).join(\" \");\n    }\n  }]);\n\n  return SNTag;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEncryptedStorage = exports.SNEncryptedStorage = function (_SFItem6) {\n  _inherits(SNEncryptedStorage, _SFItem6);\n\n  function SNEncryptedStorage() {\n    _classCallCheck(this, SNEncryptedStorage);\n\n    return _possibleConstructorReturn(this, (SNEncryptedStorage.__proto__ || Object.getPrototypeOf(SNEncryptedStorage)).apply(this, arguments));\n  }\n\n  _createClass(SNEncryptedStorage, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEncryptedStorage.prototype.__proto__ || Object.getPrototypeOf(SNEncryptedStorage.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.storage = content.storage;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|EncryptedStorage\";\n    }\n  }]);\n\n  return SNEncryptedStorage;\n}(_standardFileJs.SFItem);\n\n;\nvar SNMfa = exports.SNMfa = function (_SFItem7) {\n  _inherits(SNMfa, _SFItem7);\n\n  function SNMfa(json_obj) {\n    _classCallCheck(this, SNMfa);\n\n    return _possibleConstructorReturn(this, (SNMfa.__proto__ || Object.getPrototypeOf(SNMfa)).call(this, json_obj));\n  }\n\n  // mapContentToLocalProperties(content) {\n  //   super.mapContentToLocalProperties(content)\n  //   this.serverContent = content;\n  // }\n  //\n  // structureParams() {\n  //   return _.merge(this.serverContent, super.structureParams());\n  // }\n\n  _createClass(SNMfa, [{\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|MFA\";\n    }\n  }]);\n\n  return SNMfa;\n}(_standardFileJs.SFItem);\n\n;\nvar SNServerExtension = exports.SNServerExtension = function (_SFItem8) {\n  _inherits(SNServerExtension, _SFItem8);\n\n  function SNServerExtension() {\n    _classCallCheck(this, SNServerExtension);\n\n    return _possibleConstructorReturn(this, (SNServerExtension.__proto__ || Object.getPrototypeOf(SNServerExtension)).apply(this, arguments));\n  }\n\n  _createClass(SNServerExtension, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNServerExtension.prototype.__proto__ || Object.getPrototypeOf(SNServerExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n    }\n  }, {\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|Extension\";\n    }\n  }]);\n\n  return SNServerExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNSmartTag = exports.SNSmartTag = function (_SNTag) {\n  _inherits(SNSmartTag, _SNTag);\n\n  function SNSmartTag(json_ob) {\n    _classCallCheck(this, SNSmartTag);\n\n    var _this29 = _possibleConstructorReturn(this, (SNSmartTag.__proto__ || Object.getPrototypeOf(SNSmartTag)).call(this, json_ob));\n\n    _this29.content_type = \"SN|SmartTag\";\n    return _this29;\n  }\n\n  _createClass(SNSmartTag, null, [{\n    key: \"systemSmartTags\",\n    value: function systemSmartTags() {\n      return [new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdAllNotes,\n        dummy: true,\n        content: {\n          title: \"All notes\",\n          isSystemTag: true,\n          isAllTag: true,\n          predicate: new SFPredicate.fromArray([\"content_type\", \"=\", \"Note\"])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdArchivedNotes,\n        dummy: true,\n        content: {\n          title: \"Archived\",\n          isSystemTag: true,\n          isArchiveTag: true,\n          predicate: new SFPredicate.fromArray([\"archived\", \"=\", true])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdTrashedNotes,\n        dummy: true,\n        content: {\n          title: \"Trash\",\n          isSystemTag: true,\n          isTrashTag: true,\n          predicate: new SFPredicate.fromArray([\"content.trashed\", \"=\", true])\n        }\n      })];\n    }\n  }]);\n\n  return SNSmartTag;\n}(SNTag);\n\nSNSmartTag.SystemSmartTagIdAllNotes = \"all-notes\";\nSNSmartTag.SystemSmartTagIdArchivedNotes = \"archived-notes\";\nSNSmartTag.SystemSmartTagIdTrashedNotes = \"trashed-notes\";\n;\nvar SNTheme = exports.SNTheme = function (_SNComponent) {\n  _inherits(SNTheme, _SNComponent);\n\n  function SNTheme(json_obj) {\n    _classCallCheck(this, SNTheme);\n\n    var _this30 = _possibleConstructorReturn(this, (SNTheme.__proto__ || Object.getPrototypeOf(SNTheme)).call(this, json_obj));\n\n    _this30.area = \"themes\";\n    return _this30;\n  }\n\n  _createClass(SNTheme, [{\n    key: \"isLayerable\",\n    value: function isLayerable() {\n      return this.package_info && this.package_info.layerable;\n    }\n  }, {\n    key: \"setMobileRules\",\n    value: function setMobileRules(rules) {\n      this.setAppDataItem(\"mobileRules\", rules);\n    }\n  }, {\n    key: \"getMobileRules\",\n    value: function getMobileRules() {\n      return this.getAppDataItem(\"mobileRules\") || { constants: {}, rules: {} };\n    }\n\n    // Same as getMobileRules but without default value\n\n  }, {\n    key: \"hasMobileRules\",\n    value: function hasMobileRules() {\n      return this.getAppDataItem(\"mobileRules\");\n    }\n  }, {\n    key: \"setNotAvailOnMobile\",\n    value: function setNotAvailOnMobile(na) {\n      this.setAppDataItem(\"notAvailableOnMobile\", na);\n    }\n  }, {\n    key: \"getNotAvailOnMobile\",\n    value: function getNotAvailOnMobile() {\n      return this.getAppDataItem(\"notAvailableOnMobile\");\n    }\n\n    /* We must not use .active because if you set that to true, it will also activate that theme on desktop/web */\n\n  }, {\n    key: \"setMobileActive\",\n    value: function setMobileActive(active) {\n      this.setAppDataItem(\"mobileActive\", active);\n    }\n  }, {\n    key: \"isMobileActive\",\n    value: function isMobileActive() {\n      return this.getAppDataItem(\"mobileActive\");\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Theme\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Theme\";\n    }\n  }]);\n\n  return SNTheme;\n}(SNComponent);\n\n;\n\nif (typeof window !== 'undefined' && window !== null) {\n  // window is for some reason defined in React Native, but throws an exception when you try to set to it\n  try {\n    window.SNNote = SNNote;\n    window.SNTag = SNTag;\n    window.SNSmartTag = SNSmartTag;\n    window.SNMfa = SNMfa;\n    window.SNServerExtension = SNServerExtension;\n    window.SNComponent = SNComponent;\n    window.SNEditor = SNEditor;\n    window.SNExtension = SNExtension;\n    window.SNTheme = SNTheme;\n    window.SNEncryptedStorage = SNEncryptedStorage;\n    window.SNComponentManager = SNComponentManager;\n  } catch (e) {\n    console.log(\"Exception while exporting snjs window variables\", e);\n  }\n}\n//# sourceMappingURL=transpiled.js.map\n;'use strict';\n\nvar SN = SN || {};\n\nangular.module('app', [\n  'ngSanitize'\n])\n\nfunction getParameterByName(name, url) {\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n      results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return '';\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nfunction parametersFromURL(url) {\n  url = url.split(\"?\").slice(-1)[0];\n  var obj = {};\n  url.replace(/([^=&]+)=([^&]*)/g, function(m, key, value) {\n    obj[decodeURIComponent(key)] = decodeURIComponent(value);\n  });\n  return obj;\n}\n\nfunction getPlatformString() {\n  try {\n    var platform = navigator.platform.toLowerCase();\n    var trimmed = \"\";\n    if(platform.indexOf(\"mac\") !== -1) {\n      trimmed = \"mac\";\n    } else if(platform.indexOf(\"win\") !== -1) {\n      trimmed = \"windows\";\n    } if(platform.indexOf(\"linux\") !== -1) {\n      trimmed = \"linux\";\n    }\n\n    return trimmed + (isDesktopApplication() ? \"-desktop\" : \"-web\");\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction isDesktopApplication() {\n  return window && window.process && window.process.type && window.process.versions[\"electron\"];\n}\n\nfunction isMacApplication() {\n  return window && window.process && window.process.type && window.process.platform == \"darwin\";\n}\n\n/* Use with numbers and strings, not objects */\nArray.prototype.containsPrimitiveSubset = function(array) {\n  return !array.some(val => this.indexOf(val) === -1);\n}\n\n// https://tc39.github.io/ecma262/#sec-array.prototype.includes\nif (!Array.prototype.includes) {\n  Object.defineProperty(Array.prototype, 'includes', {\n    value: function(searchElement, fromIndex) {\n\n      if (this == null) {\n        throw new TypeError('\"this\" is null or not defined');\n      }\n\n      // 1. Let O be ? ToObject(this value).\n      var o = Object(this);\n\n      // 2. Let len be ? ToLength(? Get(O, \"length\")).\n      var len = o.length >>> 0;\n\n      // 3. If len is 0, return false.\n      if (len === 0) {\n        return false;\n      }\n\n      // 4. Let n be ? ToInteger(fromIndex).\n      //    (If fromIndex is undefined, this step produces the value 0.)\n      var n = fromIndex | 0;\n\n      // 5. If n ≥ 0, then\n      //  a. Let k be n.\n      // 6. Else n < 0,\n      //  a. Let k be len + n.\n      //  b. If k < 0, let k be 0.\n      var k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n\n      function sameValueZero(x, y) {\n        return x === y || (typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y));\n      }\n\n      // 7. Repeat, while k < len\n      while (k < len) {\n        // a. Let elementK be the result of ? Get(O, ! ToString(k)).\n        // b. If SameValueZero(searchElement, elementK) is true, return true.\n        if (sameValueZero(o[k], searchElement)) {\n          return true;\n        }\n        // c. Increase k by 1.\n        k++;\n      }\n\n      // 8. Return false\n      return false;\n    }\n  });\n}\n;angular.module('app')\n\n.constant('appVersion', '3.0.15')\n\n;;angular.module('app')\n  .config(function ($locationProvider) {\n\n    if(!isDesktopApplication()) {\n      if (window.history && window.history.pushState) {\n        $locationProvider.html5Mode({\n          enabled: true,\n          requireBase: false\n        });\n      }\n    } else {\n      $locationProvider.html5Mode(false);\n    }\n  });\n;class NoteHistoryEntry extends SFItemHistoryEntry {\n\n  previewTitle() {\n    return this.item.updated_at.toLocaleString();\n  }\n\n  previewSubTitle() {\n    if(!this.hasPreviousEntry) {\n      return `${this.textCharDiffLength} characters loaded`\n    } else if(this.textCharDiffLength < 0) {\n      return `${this.textCharDiffLength * -1} characters removed`\n    } else if(this.textCharDiffLength > 0) {\n      return `${this.textCharDiffLength} characters added`\n    } else {\n      return \"Title or metadata changed\"\n    }\n  }\n}\n;angular.module('app')\n  .directive(\"editorSection\", function($timeout, $sce){\n    return {\n      restrict: 'E',\n      scope: {\n        remove: \"&\",\n        note: \"=\",\n        updateTags: \"&\"\n      },\n      templateUrl: 'editor.html',\n      replace: true,\n      controller: 'EditorCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n        scope.$watch('ctrl.note', (note, oldNote) => {\n          if(note) {\n            ctrl.noteDidChange(note, oldNote);\n          }\n        });\n      }\n    }\n  })\n  .controller('EditorCtrl', function ($sce, $timeout, authManager, $rootScope, actionsManager,\n    syncManager, modelManager, themeManager, componentManager, storageManager, sessionHistory,\n    privilegesManager, keyboardManager, desktopManager) {\n\n    this.spellcheck = true;\n    this.componentManager = componentManager;\n    this.componentStack = [];\n    this.isDesktop = isDesktopApplication();\n\n    const MinimumStatusDurationMs = 400;\n\n    syncManager.addEventHandler((eventName, data) => {\n      if(!this.note) {\n        return;\n      }\n\n      if(eventName == \"sync:taking-too-long\") {\n        this.syncTakingTooLong = true;\n      }\n\n      else if(eventName == \"sync:completed\") {\n        this.syncTakingTooLong = false;\n        if(this.note.dirty) {\n          // if we're still dirty, don't change status, a sync is likely upcoming.\n        } else {\n          let savedItem = data.savedItems.find((item) => item.uuid == this.note.uuid);\n          let isInErrorState = this.saveError;\n          if(isInErrorState || savedItem) {\n            this.showAllChangesSavedStatus();\n          }\n        }\n      } else if(eventName == \"sync:error\") {\n        // only show error status in editor if the note is dirty. Otherwise, it means the originating sync\n        // came from somewhere else and we don't want to display an error here.\n        if(this.note.dirty){\n          this.showErrorStatus();\n        }\n      }\n    });\n\n    // Right now this only handles offline saving status changes.\n    this.syncStatusObserver = syncManager.registerSyncStatusObserver((status) => {\n      if(status.localError) {\n        $timeout(() => {\n          this.showErrorStatus({\n            message: \"Offline Saving Issue\",\n            desc: \"Changes not saved\"\n          });\n        }, 500)\n      } else {\n      }\n    })\n\n    modelManager.addItemSyncObserver(\"editor-note-observer\", \"Note\", (allItems, validItems, deletedItems, source) => {\n      if(!this.note) { return; }\n\n      // Before checking if isMappingSourceRetrieved, we check if this item was deleted via a local source,\n      // such as alternating uuids during sign in. Otherwise, we only want to make interface updates if it's a\n      // remote retrieved source.\n      if(this.note.deleted || this.note.content.trashed) {\n        $rootScope.notifyDelete();\n        return;\n      }\n\n      if(!SFModelManager.isMappingSourceRetrieved(source)) {\n        return;\n      }\n\n      var matchingNote = allItems.find((item) => {\n        return item.uuid == this.note.uuid;\n      });\n\n      if(!matchingNote) {\n        return;\n      }\n\n      // Update tags\n      this.loadTagsString();\n    });\n\n    modelManager.addItemSyncObserver(\"editor-tag-observer\", \"Tag\", (allItems, validItems, deletedItems, source) => {\n      if(!this.note) { return; }\n\n      for(var tag of allItems) {\n        // If a tag is deleted then we'll have lost references to notes. Reload anyway.\n        if(this.note.savedTagsString == null || tag.deleted || tag.hasRelationshipWithItem(this.note)) {\n          this.loadTagsString();\n          return;\n        }\n      }\n    });\n\n\n    modelManager.addItemSyncObserver(\"editor-component-observer\", \"SN|Component\", (allItems, validItems, deletedItems, source) => {\n      if(!this.note) { return; }\n\n      // Reload componentStack in case new ones were added or removed\n      this.reloadComponentStackArray();\n\n      // Observe editor changes to see if the current note should update its editor\n      var editors = allItems.filter(function(item) {\n        return item.isEditor();\n      });\n\n      // If no editors have changed\n      if(editors.length == 0) {\n        return;\n      }\n\n      // Look through editors again and find the most proper one\n      var editor = this.editorForNote(this.note);\n      this.selectedEditor = editor;\n      if(!editor) {\n        this.reloadFont();\n      }\n    });\n\n    this.noteDidChange = function(note, oldNote) {\n      this.setNote(note, oldNote);\n      this.reloadComponentContext();\n    }\n\n    this.setNote = function(note, oldNote) {\n      this.showExtensions = false;\n      this.showMenu = false;\n      this.noteStatus = null;\n      // When setting alt key down and deleting note, an alert will come up and block the key up event when alt is released.\n      // We reset it on set note so that the alt menu restores to default.\n      this.altKeyDown = false;\n      this.loadTagsString();\n\n      let onReady = () => {\n        this.noteReady = true;\n        $timeout(() => {\n          this.loadPreferences();\n        })\n      }\n\n      let associatedEditor = this.editorForNote(note);\n      if(associatedEditor && associatedEditor != this.selectedEditor) {\n        // setting note to not ready will remove the editor from view in a flash,\n        // so we only want to do this if switching between external editors\n        this.noteReady = false;\n        // switch after timeout, so that note data isnt posted to current editor\n        $timeout(() => {\n          this.selectedEditor = associatedEditor;\n          onReady();\n        })\n      } else if(associatedEditor) {\n        // Same editor as currently active\n        onReady();\n      } else {\n        // No editor\n        this.selectedEditor = null;\n        onReady();\n      }\n\n      if(note.safeText().length == 0 && note.dummy) {\n        this.focusTitle(100);\n      }\n\n      if(oldNote && oldNote != note) {\n        if(oldNote.dirty) {\n          this.saveNote(oldNote);\n        } else if(oldNote.dummy) {\n          this.remove()(oldNote);\n        }\n      }\n    }\n\n    this.editorForNote = function(note) {\n      return componentManager.editorForNote(note);\n    }\n\n    this.closeAllMenus = function() {\n      this.showEditorMenu = false;\n      this.showMenu = false;\n      this.showExtensions = false;\n    }\n\n    this.toggleMenu = function(menu) {\n      this[menu] = !this[menu];\n\n      let allMenus = ['showMenu', 'showEditorMenu', 'showExtensions', 'showSessionHistory'];\n      for(var candidate of allMenus) {\n        if(candidate != menu) {\n          this[candidate] = false;\n        }\n      }\n    }\n\n    this.editorMenuOnSelect = function(component) {\n      if(!component || component.area == \"editor-editor\") {\n        // if plain editor or other editor\n        this.showEditorMenu = false;\n        var editor = component;\n        if(this.selectedEditor && editor !== this.selectedEditor) {\n          this.disassociateComponentWithCurrentNote(this.selectedEditor);\n        }\n        if(editor) {\n          if(this.note.getAppDataItem(\"prefersPlainEditor\") == true) {\n            this.note.setAppDataItem(\"prefersPlainEditor\", false);\n            modelManager.setItemDirty(this.note, true);\n          }\n          this.associateComponentWithCurrentNote(editor);\n        } else {\n          // Note prefers plain editor\n          if(!this.note.getAppDataItem(\"prefersPlainEditor\")) {\n            this.note.setAppDataItem(\"prefersPlainEditor\", true);\n            modelManager.setItemDirty(this.note, true);\n          }\n          $timeout(() => {\n            this.reloadFont();\n          })\n        }\n\n        this.selectedEditor = editor;\n      } else if(component.area == \"editor-stack\") {\n        // If component stack item\n        this.toggleStackComponentForCurrentItem(component);\n      }\n\n      // Lots of dirtying can happen above, so we'll sync\n      syncManager.sync();\n    }.bind(this)\n\n    this.hasAvailableExtensions = function() {\n      return actionsManager.extensionsInContextOfItem(this.note).length > 0;\n    }\n\n    this.focusEditor = function(delay) {\n      setTimeout(function(){\n        var element = document.getElementById(\"note-text-editor\");\n        if(element) {\n          element.focus();\n        }\n      }, delay)\n    }\n\n    this.focusTitle = function(delay) {\n      setTimeout(function(){\n        document.getElementById(\"note-title-editor\").focus();\n      }, delay)\n    }\n\n    this.clickedTextArea = function() {\n      this.showMenu = false;\n    }\n\n    this.EditorNgDebounce = 200;\n    const SyncDebouce = 350;\n    const SyncNoDebounce = 100;\n\n    this.saveNote = function({bypassDebouncer, updateClientModified, dontUpdatePreviews}) {\n      let note = this.note;\n      note.dummy = false;\n\n      if(note.deleted) {\n        alert(\"The note you are attempting to edit has been deleted, and is awaiting sync. Changes you make will be disregarded.\");\n        return;\n      }\n\n      if(!modelManager.findItem(note.uuid)) {\n        alert(\"The note you are attempting to save can not be found or has been deleted. Changes you make will not be synced. Please copy this note's text and start a new note.\");\n        return;\n      }\n\n      this.showSavingStatus();\n\n      if(!dontUpdatePreviews) {\n        let limit = 80;\n        var text = note.text || \"\";\n        var truncate = text.length > limit;\n        note.content.preview_plain = text.substring(0, limit) + (truncate ? \"...\" : \"\");\n        // Clear dynamic previews if using plain editor\n        note.content.preview_html = null;\n      }\n\n      modelManager.setItemDirty(note, true, updateClientModified);\n\n      if(this.saveTimeout) {\n        $timeout.cancel(this.saveTimeout);\n      }\n\n      let syncDebouceMs;\n      if(authManager.offline() || bypassDebouncer) {\n        syncDebouceMs = SyncNoDebounce;\n      } else {\n        syncDebouceMs = SyncDebouce;\n      }\n\n      this.saveTimeout = $timeout(() => {\n        syncManager.sync().then((response) => {\n          if(response && response.error && !this.didShowErrorAlert) {\n            this.didShowErrorAlert = true;\n            alert(\"There was an error saving your note. Please try again.\");\n          }\n        })\n      }, syncDebouceMs)\n    }\n\n    this.showSavingStatus = function() {\n      this.setStatus({message: \"Saving...\"}, false);\n    }\n\n    this.showAllChangesSavedStatus = function() {\n      this.saveError = false;\n      this.syncTakingTooLong = false;\n\n      var status = \"All changes saved\";\n      if(authManager.offline()) {\n        status += \" (offline)\";\n      }\n\n      this.setStatus({message: status});\n    }\n\n    this.showErrorStatus = function(error) {\n      if(!error) {\n        error = {\n          message: \"Sync Unreachable\",\n          desc: \"Changes saved offline\"\n        }\n      }\n      this.saveError = true;\n      this.syncTakingTooLong = false;\n      this.setStatus(error);\n    }\n\n    this.setStatus = function(status, wait = true) {\n      // Keep every status up for a minimum duration so it doesnt flash crazily.\n      let waitForMs;\n      if(!this.noteStatus || !this.noteStatus.date) {\n        waitForMs = 0;\n      } else {\n        waitForMs = MinimumStatusDurationMs - (new Date() - this.noteStatus.date);\n      }\n      if(!wait || waitForMs < 0) {waitForMs = 0;}\n      if(this.statusTimeout) $timeout.cancel(this.statusTimeout);\n      this.statusTimeout = $timeout(() => {\n        status.date = new Date();\n        this.noteStatus = status;\n      }, waitForMs)\n    }\n\n    this.contentChanged = function() {\n      this.saveNote({updateClientModified: true});\n    }\n\n    this.onTitleEnter = function($event) {\n      $event.target.blur();\n      this.onTitleChange();\n      this.focusEditor();\n    }\n\n    this.onTitleChange = function() {\n      this.saveNote({dontUpdatePreviews: true, updateClientModified: true});\n    }\n\n    this.onNameFocus = function() {\n      this.editingName = true;\n    }\n\n    this.onContentFocus = function() {\n      $rootScope.$broadcast(\"editorFocused\");\n    }\n\n    this.onNameBlur = function() {\n      this.editingName = false;\n    }\n\n    this.selectedMenuItem = function(hide) {\n      if(hide) {\n        this.showMenu = false;\n      }\n    }\n\n    this.deleteNote = async function(permanently) {\n      let run = () => {\n        $timeout(() => {\n          if(this.note.locked) {\n            alert(\"This note is locked. If you'd like to delete it, unlock it, and try again.\");\n            return;\n          }\n\n          let title = this.note.safeTitle().length ? `'${this.note.title}'` : \"this note\";\n          let message = permanently ? `Are you sure you want to permanently delete ${title}?`\n            : `Are you sure you want to move ${title} to the trash?`\n          if(confirm(message)) {\n            if(permanently) {\n              this.remove()(this.note);\n            } else {\n              this.note.content.trashed = true;\n              this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n            }\n            this.showMenu = false;\n          }\n        });\n      }\n\n      if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionDeleteNote)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionDeleteNote, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    this.restoreTrashedNote = function() {\n      this.note.content.trashed = false;\n      this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n    }\n\n    this.deleteNotePermanantely = function() {\n      this.deleteNote(true);\n    }\n\n    this.getTrashCount = function() {\n      return modelManager.trashedItems().length;\n    }\n\n    this.emptyTrash = function() {\n      let count = this.getTrashCount();\n      if(confirm(`Are you sure you want to permanently delete ${count} note(s)?`)) {\n        modelManager.emptyTrash();\n        syncManager.sync();\n      }\n    }\n\n    this.togglePin = function() {\n      this.note.setAppDataItem(\"pinned\", !this.note.pinned);\n      this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n    }\n\n    this.toggleLockNote = function() {\n      this.note.setAppDataItem(\"locked\", !this.note.locked);\n      this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n    }\n\n    this.toggleProtectNote = function() {\n      this.note.content.protected = !this.note.content.protected;\n      this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n\n      // Show privilegesManager if Protection is not yet set up\n      privilegesManager.actionHasPrivilegesConfigured(PrivilegesManager.ActionViewProtectedNotes).then((configured) => {\n        if(!configured) {\n          privilegesManager.presentPrivilegesManagementModal();\n        }\n      })\n    }\n\n    this.toggleNotePreview = function() {\n      this.note.content.hidePreview = !this.note.content.hidePreview;\n      this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n    }\n\n    this.toggleArchiveNote = function() {\n      this.note.setAppDataItem(\"archived\", !this.note.archived);\n      this.saveNote({bypassDebouncer: true, dontUpdatePreviews: true});\n      $rootScope.$broadcast(\"noteArchived\");\n    }\n\n    this.clickedEditNote = function() {\n      this.focusEditor(100);\n    }\n\n\n\n\n\n\n\n\n    /*\n    Tags\n    */\n\n    this.loadTagsString = function() {\n      this.tagsString = this.note.tagsString();\n    }\n\n    this.addTag = function(tag) {\n      var tags = this.note.tags;\n      var strings = tags.map(function(_tag){\n        return _tag.title;\n      })\n      strings.push(tag.title);\n      this.updateTags()(this.note, strings);\n      this.loadTagsString();\n    }\n\n    this.removeTag = function(tag) {\n      var tags = this.note.tags;\n      var strings = tags.map(function(_tag){\n        return _tag.title;\n      }).filter(function(_tag){\n        return _tag !== tag.title;\n      })\n      this.updateTags()(this.note, strings);\n      this.loadTagsString();\n    }\n\n    this.updateTagsFromTagsString = function() {\n      if(this.tagsString == this.note.tagsString()) {\n        return;\n      }\n\n      var strings = this.tagsString.split(\"#\").filter((string) => {\n        return string.length > 0;\n      }).map((string) => {\n        return string.trim();\n      })\n\n      this.note.dummy = false;\n      this.updateTags()(this.note, strings);\n    }\n\n\n    /* Resizability */\n\n    this.leftResizeControl = {};\n    this.rightResizeControl = {};\n\n    this.onPanelResizeFinish = (width, left, isMaxWidth) => {\n      if(isMaxWidth) {\n        authManager.setUserPrefValue(\"editorWidth\", null);\n      } else {\n        if(width !== undefined && width !== null) {\n          authManager.setUserPrefValue(\"editorWidth\", width);\n          this.leftResizeControl.setWidth(width);\n        }\n      }\n\n      if(left !== undefined && left !== null) {\n        authManager.setUserPrefValue(\"editorLeft\", left);\n        this.rightResizeControl.setLeft(left);\n      }\n      authManager.syncUserPreferences();\n    }\n\n    $rootScope.$on(\"user-preferences-changed\", () => {\n      this.loadPreferences();\n    });\n\n    this.loadPreferences = function() {\n      this.monospaceFont = authManager.getUserPrefValue(\"monospaceFont\", \"monospace\");\n\n      // On desktop application, disable spellcheck by default, as it is not performant.\n      let defaultSpellcheckStatus = isDesktopApplication() ? false : true;\n      this.spellcheck = authManager.getUserPrefValue(\"spellcheck\", defaultSpellcheckStatus);\n\n      this.marginResizersEnabled = authManager.getUserPrefValue(\"marginResizersEnabled\", true);\n\n      if(!document.getElementById(\"editor-content\")) {\n        // Elements have not yet loaded due to ng-if around wrapper\n        return;\n      }\n\n      this.reloadFont();\n\n      if(this.marginResizersEnabled) {\n        let width = authManager.getUserPrefValue(\"editorWidth\", null);\n        if(width !== null) {\n          this.leftResizeControl.setWidth(width);\n          this.rightResizeControl.setWidth(width);\n        }\n\n        let left = authManager.getUserPrefValue(\"editorLeft\", null);\n        if(left !== null) {\n          this.leftResizeControl.setLeft(left);\n          this.rightResizeControl.setLeft(left);\n        }\n      }\n    }\n\n    this.reloadFont = function() {\n      var editable = document.getElementById(\"note-text-editor\");\n\n      if(!editable) {\n        return;\n      }\n\n      if(this.monospaceFont) {\n        if(isDesktopApplication()) {\n          editable.style.fontFamily = \"Menlo, Consolas, 'DejaVu Sans Mono', monospace\";\n        } else {\n          editable.style.fontFamily = \"monospace\";\n        }\n      } else {\n        editable.style.fontFamily = \"inherit\";\n      }\n    }\n\n    this.toggleKey = function(key) {\n      this[key] = !this[key];\n      authManager.setUserPrefValue(key, this[key], true);\n      this.reloadFont();\n\n      if(key == \"spellcheck\") {\n        // Allows textarea to reload\n        this.noteReady = false;\n        $timeout(() => {\n          this.noteReady = true;\n          $timeout(() => {\n            this.reloadFont();\n          })\n        }, 0)\n      } else if(key == \"marginResizersEnabled\" && this[key] == true) {\n        $timeout(() => {\n          this.leftResizeControl.flash();\n          this.rightResizeControl.flash();\n        })\n      }\n    }\n\n\n\n    /*\n    Components\n    */\n\n    this.onEditorLoad = function(editor) {\n      desktopManager.redoSearch();\n    }\n\n    componentManager.registerHandler({identifier: \"editor\", areas: [\"note-tags\", \"editor-stack\", \"editor-editor\"], activationHandler: (component) => {\n      if(component.area === \"note-tags\") {\n        // Autocomplete Tags\n        this.tagsComponent = component.active ? component : null;\n      } else if(component.area == \"editor-editor\") {\n        // An editor is already active, ensure the potential replacement is explicitely enabled for this item\n        // We also check if the selectedEditor is active. If it's inactive, we want to treat it as an external reference wishing to deactivate this editor (i.e componentView)\n        if(this.selectedEditor && this.selectedEditor == component && component.active == false) {\n          this.selectedEditor = null;\n        }\n        else if(this.selectedEditor) {\n          if(this.selectedEditor.active) {\n            // In the case where an editor is duplicated, then you'll have two editors who are explicitely enabled for the same note.\n            // This will cause an infinite loop, where as soon as the first is enabled, the second will come in, pass the `isExplicitlyEnabledForItem` check,\n            // and replace the previous one. So we now check to make the current editor isn't also explicitely enabled, and if it is, then we'll just keep that one active.\n            if(component.isExplicitlyEnabledForItem(this.note) && !this.selectedEditor.isExplicitlyEnabledForItem(this.note)) {\n              this.selectedEditor = component;\n            }\n          }\n        }\n        else {\n          // If no selected editor, let's see if the incoming one is a candidate\n          if(component.active && this.note && (component.isExplicitlyEnabledForItem(this.note) || component.isDefaultEditor())) {\n            this.selectedEditor = component;\n          } else {\n            // Not a candidate, and no selected editor. Disable the current editor by setting selectedEditor to null\n            this.selectedEditor = null;\n          }\n        }\n\n      } else if(component.area == \"editor-stack\") {\n        this.reloadComponentContext();\n      }\n    }, contextRequestHandler: (component) => {\n      if(component == this.selectedEditor || component == this.tagsComponent || this.componentStack.includes(component)) {\n        return this.note;\n      }\n    }, focusHandler: (component, focused) => {\n      if(component.isEditor() && focused) {\n        this.closeAllMenus();\n      }\n    }, actionHandler: (component, action, data) => {\n      if(action === \"set-size\") {\n        var setSize = function(element, size) {\n          var widthString = typeof size.width === 'string' ? size.width : `${data.width}px`;\n          var heightString = typeof size.height === 'string' ? size.height : `${data.height}px`;\n          element.setAttribute(\"style\", `width:${widthString}; height:${heightString}; `);\n        }\n\n        if(data.type == \"container\") {\n          if(component.area == \"note-tags\") {\n            var container = document.getElementById(\"note-tags-component-container\");\n            setSize(container, data);\n          }\n        }\n      }\n\n      else if(action === \"associate-item\") {\n        if(data.item.content_type == \"Tag\") {\n          var tag = modelManager.findItem(data.item.uuid);\n          this.addTag(tag);\n        }\n      }\n\n      else if(action === \"deassociate-item\") {\n        var tag = modelManager.findItem(data.item.uuid);\n        this.removeTag(tag);\n      }\n\n      else if(action === \"save-items\") {\n        if(data.items.map((item) => {return item.uuid}).includes(this.note.uuid)) {\n          this.showSavingStatus();\n        }\n      }\n    }});\n\n    this.reloadComponentStackArray = function() {\n      this.componentStack = componentManager.componentsForArea(\"editor-stack\").sort((a, b) => {\n        // Careful here. For some reason (probably because re-assigning array everytime quickly destroys componentView elements, causing deallocs),\n        // sorting by updated_at (or any other property that may always be changing)\n        // causes weird problems with ext communication when changing notes or activating/deactivating in quick succession\n        return a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1;\n      });\n    }\n\n    this.reloadComponentContext = function() {\n      // componentStack is used by the template to ng-repeat\n      this.reloadComponentStackArray();\n      /*\n      In the past, we were doing this looping code even if the note wasn't currently defined.\n      The problem is if an editor stack item loaded first, requested to stream items, and the note was undefined,\n      we would set component.hidden = true. Which means messages would not be sent to the component.\n      Theoretically, upon the note loading, we would run this code again, and unhide the extension.\n      However, if you had requested to stream items when it was hidden, and then it unhid, it would never\n      resend those items upon unhiding.\n\n      Our solution here is to check that the note is defined before setting hidden. The question remains, when\n      would note really ever be undefined? Maybe temprarily when you're deleting a note?\n      */\n      if(this.note) {\n        for(var component of this.componentStack) {\n          if(component.active) {\n            componentManager.setComponentHidden(component, !component.isExplicitlyEnabledForItem(this.note));\n          }\n        }\n      }\n\n      componentManager.contextItemDidChangeInArea(\"note-tags\");\n      componentManager.contextItemDidChangeInArea(\"editor-stack\");\n      componentManager.contextItemDidChangeInArea(\"editor-editor\");\n    }\n\n    this.toggleStackComponentForCurrentItem = function(component) {\n      // If it's hidden, we want to show it\n      // If it's not active, then hidden won't be set, and we mean to activate and show it.\n      if(component.hidden || !component.active) {\n        // Unhide, associate with current item\n        componentManager.setComponentHidden(component, false);\n        this.associateComponentWithCurrentNote(component);\n        if(!component.active) {\n          componentManager.activateComponent(component);\n        }\n        componentManager.contextItemDidChangeInArea(\"editor-stack\");\n      } else {\n        // not hidden, hide\n        componentManager.setComponentHidden(component, true);\n        this.disassociateComponentWithCurrentNote(component);\n      }\n    }\n\n    this.disassociateComponentWithCurrentNote = function(component) {\n      component.associatedItemIds = component.associatedItemIds.filter((id) => {return id !== this.note.uuid});\n\n      if(!component.disassociatedItemIds.includes(this.note.uuid)) {\n        component.disassociatedItemIds.push(this.note.uuid);\n      }\n\n      modelManager.setItemDirty(component, true);\n      syncManager.sync();\n    }\n\n    this.associateComponentWithCurrentNote = function(component) {\n      component.disassociatedItemIds = component.disassociatedItemIds.filter((id) => {return id !== this.note.uuid});\n\n      if(!component.associatedItemIds.includes(this.note.uuid)) {\n        component.associatedItemIds.push(this.note.uuid);\n      }\n\n      modelManager.setItemDirty(component, true);\n      syncManager.sync();\n    }\n\n    this.altKeyObserver = keyboardManager.addKeyObserver({\n      modifiers: [KeyboardManager.KeyModifierAlt],\n      onKeyDown: () => {\n        $timeout(() => {\n          this.altKeyDown = true;\n        })\n      },\n      onKeyUp: () => {\n        $timeout(() => {\n          this.altKeyDown = false;\n        });\n      }\n    })\n\n    this.trashKeyObserver = keyboardManager.addKeyObserver({\n      key: KeyboardManager.KeyBackspace,\n      notElementIds: [\"note-text-editor\", \"note-title-editor\"],\n      modifiers: [KeyboardManager.KeyModifierMeta],\n      onKeyDown: () => {\n        $timeout(() => {\n          this.deleteNote();\n        });\n      },\n    })\n\n    this.deleteKeyObserver = keyboardManager.addKeyObserver({\n      key: KeyboardManager.KeyBackspace,\n      modifiers: [KeyboardManager.KeyModifierMeta, KeyboardManager.KeyModifierShift, KeyboardManager.KeyModifierAlt],\n      onKeyDown: (event) => {\n        event.preventDefault();\n        $timeout(() => {\n          this.deleteNote(true);\n        });\n      },\n    })\n\n    /*\n    Editor Customization\n    */\n\n    this.onSystemEditorLoad = function() {\n      if(this.loadedTabListener) {\n        return;\n      }\n      this.loadedTabListener = true;\n\n      /**\n       * Insert 4 spaces when a tab key is pressed,\n       * only used when inside of the text editor.\n       * If the shift key is pressed first, this event is\n       * not fired.\n      */\n\n      const editor = document.getElementById(\"note-text-editor\");\n      this.tabObserver = keyboardManager.addKeyObserver({\n        element: editor,\n        key: KeyboardManager.KeyTab,\n        onKeyDown: (event) => {\n          if(event.shiftKey) {\n            return;\n          }\n\n          if(this.note.locked) {\n            return;\n          }\n\n          event.preventDefault();\n\n          // Using document.execCommand gives us undo support\n          let insertSuccessful = document.execCommand(\"insertText\", false, \"\\t\");\n          if(!insertSuccessful) {\n            // document.execCommand works great on Chrome/Safari but not Firefox\n            var start = editor.selectionStart;\n            var end = editor.selectionEnd;\n            var spaces = \"    \";\n\n             // Insert 4 spaces\n            editor.value = editor.value.substring(0, start)\n              + spaces + editor.value.substring(end);\n\n            // Place cursor 4 spaces away from where\n            // the tab key was pressed\n            editor.selectionStart = editor.selectionEnd = start + 4;\n          }\n\n          $timeout(() => {\n            this.note.text = editor.value;\n            this.saveNote({bypassDebouncer: true});\n          })\n        },\n      })\n\n      // This handles when the editor itself is destroyed, and not when our controller is destroyed.\n      angular.element(editor).on('$destroy', function(){\n        if(this.tabObserver) {\n          keyboardManager.removeKeyObserver(this.tabObserver);\n          this.loadedTabListener = false;\n        }\n      }.bind(this));\n    }\n});\n;angular.module('app')\n  .directive(\"footer\", function(authManager){\n    return {\n      restrict: 'E',\n      scope: {},\n      templateUrl: 'footer.html',\n      replace: true,\n      controller: 'FooterCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n        scope.$on(\"sync:completed\", function(){\n          ctrl.syncUpdated();\n          ctrl.findErrors();\n          ctrl.updateOfflineStatus();\n        })\n        scope.$on(\"sync:error\", function(){\n          ctrl.findErrors();\n          ctrl.updateOfflineStatus();\n        })\n      }\n    }\n  })\n  .controller('FooterCtrl', function ($rootScope, authManager, modelManager, $timeout, dbManager,\n    syncManager, storageManager, passcodeManager, componentManager, singletonManager, nativeExtManager,\n    privilegesManager, statusManager) {\n\n      authManager.checkForSecurityUpdate().then((available) => {\n        this.securityUpdateAvailable = available;\n      })\n\n      $rootScope.$on(\"security-update-status-changed\", () => {\n        this.securityUpdateAvailable = authManager.securityUpdateAvailable;\n      })\n\n      statusManager.addStatusObserver((string) => {\n        $timeout(() => {\n          this.arbitraryStatusMessage = string;\n        })\n      })\n\n      $rootScope.$on(\"did-begin-local-backup\", () => {\n        $timeout(() => {\n          this.backupStatus = statusManager.addStatusFromString(\"Saving local backup...\");\n        })\n      });\n\n      $rootScope.$on(\"did-finish-local-backup\", (event, data) => {\n        $timeout(() => {\n          if(data.success) {\n            this.backupStatus = statusManager.replaceStatusWithString(this.backupStatus, \"Successfully saved backup.\");\n          } else {\n            this.backupStatus = statusManager.replaceStatusWithString(this.backupStatus, \"Unable to save local backup.\");\n          }\n\n          $timeout(() => {\n            this.backupStatus = statusManager.removeStatus(this.backupStatus);\n          }, 2000)\n        })\n      });\n\n      this.openSecurityUpdate = function() {\n        authManager.presentPasswordWizard(\"upgrade-security\");\n      }\n\n      $rootScope.$on(\"reload-ext-data\", () => {\n        this.reloadExtendedData();\n      });\n\n      this.reloadExtendedData = () => {\n        if(this.reloadInProgress) { return; }\n        this.reloadInProgress = true;\n\n        // A reload occurs when the extensions manager window is opened. We can close it after a delay\n        let extWindow = this.rooms.find((room) => {return room.package_info.identifier == nativeExtManager.extensionsManagerIdentifier});\n        if(!extWindow) {\n          this.queueExtReload = true; // try again when the ext is available\n          this.reloadInProgress = false;\n          return;\n        }\n\n        this.selectRoom(extWindow);\n\n        $timeout(() => {\n          this.selectRoom(extWindow);\n          this.reloadInProgress = false;\n          $rootScope.$broadcast(\"ext-reload-complete\");\n        }, 2000);\n      }\n\n      this.getUser = function() {\n        return authManager.user;\n      }\n\n      this.updateOfflineStatus = function() {\n        this.offline = authManager.offline();\n      }\n      this.updateOfflineStatus();\n\n\n      syncManager.addEventHandler((syncEvent, data) => {\n        $timeout(() => {\n          if(syncEvent == \"local-data-loaded\") {\n            // If the user has no notes and is offline, show Account menu\n            if(this.offline && modelManager.noteCount() == 0) {\n              this.showAccountMenu = true;\n            }\n          } else if(syncEvent == \"enter-out-of-sync\") {\n            this.outOfSync = true;\n          } else if(syncEvent == \"exit-out-of-sync\") {\n            this.outOfSync = false;\n          }\n        })\n      });\n\n      this.findErrors = function() {\n        this.error = syncManager.syncStatus.error;\n      }\n      this.findErrors();\n\n      this.onAuthSuccess = function() {\n        this.showAccountMenu = false;\n      }.bind(this)\n\n      this.accountMenuPressed = function() {\n        this.showAccountMenu = !this.showAccountMenu;\n        this.closeAllRooms();\n      }\n\n      this.toggleSyncResolutionMenu = function() {\n        this.showSyncResolution = !this.showSyncResolution;\n      }.bind(this);\n\n      this.closeAccountMenu = () => {\n        this.showAccountMenu = false;\n      }\n\n      this.hasPasscode = function() {\n        return passcodeManager.hasPasscode();\n      }\n\n      this.lockApp = function() {\n        $rootScope.lockApplication();\n      }\n\n      this.refreshData = function() {\n        this.isRefreshing = true;\n        // Enable integrity checking for this force request\n        syncManager.sync({force: true, performIntegrityCheck: true}).then((response) => {\n          $timeout(function(){\n            this.isRefreshing = false;\n          }.bind(this), 200)\n          if(response && response.error) {\n            alert(\"There was an error syncing. Please try again. If all else fails, try signing out and signing back in.\");\n          } else {\n            this.syncUpdated();\n          }\n        });\n      }\n\n      this.syncUpdated = function() {\n        this.lastSyncDate = new Date();\n      }\n\n      $rootScope.$on(\"new-update-available\", function(version){\n        $timeout(function(){\n          // timeout calls apply() which is needed\n          this.onNewUpdateAvailable();\n        }.bind(this))\n      }.bind(this))\n\n      this.onNewUpdateAvailable = function() {\n        this.newUpdateAvailable = true;\n      }\n\n      this.clickedNewUpdateAnnouncement = function() {\n        this.newUpdateAvailable = false;\n        alert(\"A new update is ready to install. Please use the top-level 'Updates' menu to manage installation.\")\n      }\n\n\n      /* Rooms */\n\n      this.componentManager = componentManager;\n      this.rooms = [];\n      this.themesWithIcons = [];\n\n      modelManager.addItemSyncObserver(\"room-bar\", \"SN|Component\", (allItems, validItems, deletedItems, source) => {\n        this.rooms = modelManager.components.filter((candidate) => {return candidate.area == \"rooms\" && !candidate.deleted});\n        if(this.queueExtReload) {\n          this.queueExtReload = false;\n          this.reloadExtendedData();\n        }\n      });\n\n      modelManager.addItemSyncObserver(\"footer-bar-themes\", \"SN|Theme\", (allItems, validItems, deletedItems, source) => {\n        let themes = modelManager.validItemsForContentType(\"SN|Theme\").filter((candidate) => {\n          return !candidate.deleted && candidate.content.package_info && candidate.content.package_info.dock_icon;\n        }).sort((a, b) => {\n          return a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1;\n        });\n\n        let differ = themes.length != this.themesWithIcons.length;\n\n        this.themesWithIcons = themes;\n\n        if(differ) {\n          this.reloadDockShortcuts();\n        }\n      });\n\n      this.reloadDockShortcuts = function() {\n        let shortcuts = [];\n        for(var theme of this.themesWithIcons) {\n          var icon = theme.content.package_info.dock_icon;\n          if(!icon) {\n            continue;\n          }\n          shortcuts.push({\n            component: theme,\n            icon: icon\n          })\n        }\n\n        this.dockShortcuts = shortcuts.sort((a, b) => {\n          // circles first, then images\n\n          var aType = a.icon.type;\n          var bType = b.icon.type;\n\n          if(aType == bType) {\n            return 0;\n          } else if(aType == \"circle\" && bType == \"svg\") {\n            return -1;\n          } else if(bType == \"circle\" && aType == \"svg\") {\n            return 1;\n          }\n        });\n      }\n\n      this.initSvgForShortcut = function(shortcut) {\n        var id = \"dock-svg-\" + shortcut.component.uuid;\n        var element = document.getElementById(id);\n        var parser = new DOMParser();\n        var svg = shortcut.component.content.package_info.dock_icon.source;\n        var doc = parser.parseFromString(svg, \"image/svg+xml\");\n        element.appendChild(doc.documentElement);\n      }\n\n      this.selectShortcut = function(shortcut) {\n        componentManager.toggleComponent(shortcut.component);\n      }\n\n      componentManager.registerHandler({identifier: \"roomBar\", areas: [\"rooms\", \"modal\"], activationHandler: (component) => {\n        // RIP: There used to be code here that checked if component.active was true, and if so, displayed the component.\n        // However, we no longer want to persist active state for footer extensions. If you open Extensions on one computer,\n        // it shouldn't open on another computer. Active state should only be persisted for persistent extensions, like Folders.\n      }, actionHandler: (component, action, data) => {\n        if(action == \"set-size\") {\n          component.setLastSize(data);\n        }\n      }, focusHandler: (component, focused) => {\n        if(component.isEditor() && focused) {\n          this.closeAllRooms();\n          this.closeAccountMenu();\n        }\n      }});\n\n      $rootScope.$on(\"editorFocused\", () => {\n        this.closeAllRooms();\n        this.closeAccountMenu();\n      })\n\n      this.onRoomDismiss = function(room) {\n        room.showRoom = false;\n      }\n\n      this.closeAllRooms = function() {\n        for(var room of this.rooms) {\n          room.showRoom = false;\n        }\n      }\n\n      this.selectRoom = async function(room) {\n        let run = () => {\n          $timeout(() => {\n            room.showRoom = !room.showRoom;\n          })\n        }\n\n        if(!room.showRoom) {\n          // About to show, check if has privileges\n          if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManageExtensions)) {\n            privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManageExtensions, () => {\n              run();\n            });\n          } else {\n            run();\n          }\n        } else {\n          run();\n        }\n      }\n\n      this.clickOutsideAccountMenu = function() {\n        if(privilegesManager.authenticationInProgress()) {\n          return;\n        }\n        this.showAccountMenu = false;\n      }\n});\n;angular.module('app')\n.controller('HomeCtrl', function ($scope, $location, $rootScope, $timeout, modelManager,\n  dbManager, syncManager, authManager, themeManager, passcodeManager, storageManager, migrationManager,\n  privilegesManager, statusManager) {\n\n    storageManager.initialize(passcodeManager.hasPasscode(), authManager.isEphemeralSession());\n\n    $scope.platform = getPlatformString();\n\n    $scope.onUpdateAvailable = function(version) {\n      $rootScope.$broadcast('new-update-available', version);\n    }\n\n    $rootScope.$on(\"panel-resized\", (event, info) => {\n      if(info.panel == \"notes\") { this.notesCollapsed = info.collapsed; }\n      if(info.panel == \"tags\") { this.tagsCollapsed = info.collapsed; }\n\n      let appClass = \"\";\n      if(this.notesCollapsed) { appClass += \"collapsed-notes\"; }\n      if(this.tagsCollapsed) { appClass += \" collapsed-tags\"; }\n\n      $scope.appClass = appClass;\n    })\n\n    /* Used to avoid circular dependencies where syncManager cannot be imported but rootScope can */\n    $rootScope.sync = function(source) {\n      syncManager.sync();\n    }\n\n    $rootScope.lockApplication = function() {\n      // Reloading wipes current objects from memory\n      window.location.reload();\n    }\n\n    const initiateSync = () => {\n      authManager.loadInitialData();\n\n      this.syncStatusObserver = syncManager.registerSyncStatusObserver((status) => {\n        if(status.retrievedCount > 20) {\n          var text = `Downloading ${status.retrievedCount} items. Keep app open.`\n          this.syncStatus = statusManager.replaceStatusWithString(this.syncStatus, text);\n          this.showingDownloadStatus = true;\n        } else if(this.showingDownloadStatus) {\n          this.showingDownloadStatus = false;\n          var text = \"Download Complete.\";\n          this.syncStatus = statusManager.replaceStatusWithString(this.syncStatus, text);\n          setTimeout(() => {\n            this.syncStatus = statusManager.removeStatus(this.syncStatus);\n          }, 2000);\n        } else if(status.total > 20) {\n          this.uploadSyncStatus = statusManager.replaceStatusWithString(this.uploadSyncStatus, `Syncing ${status.current}/${status.total} items...`)\n        } else if(this.uploadSyncStatus) {\n          this.uploadSyncStatus = statusManager.removeStatus(this.uploadSyncStatus);\n        }\n      })\n\n      syncManager.setKeyRequestHandler(async () => {\n        let offline = authManager.offline();\n        let auth_params = offline ? passcodeManager.passcodeAuthParams() : await authManager.getAuthParams();\n        let keys = offline ? passcodeManager.keys() : await authManager.keys();\n        return {\n          keys: keys,\n          offline: offline,\n          auth_params: auth_params\n        }\n      });\n\n      let lastSessionInvalidAlert;\n\n      syncManager.addEventHandler((syncEvent, data) => {\n        $rootScope.$broadcast(syncEvent, data || {});\n        if(syncEvent == \"sync-session-invalid\") {\n          // On Windows, some users experience issues where this message keeps appearing. It might be that on focus, the app syncs, and this message triggers again.\n          // We'll only show it once every X seconds\n          let showInterval = 30; // At most 30 seconds in between\n          if(!lastSessionInvalidAlert || (new Date() - lastSessionInvalidAlert)/1000 > showInterval) {\n            lastSessionInvalidAlert = new Date();\n            setTimeout(function () {\n              // If this alert is displayed on launch, it may sometimes dismiss automatically really quicky for some reason. So we wrap in timeout\n              alert(\"Your session has expired. New changes will not be pulled in. Please sign out and sign back in to refresh your session.\");\n            }, 500);\n          }\n        } else if(syncEvent == \"sync-exception\") {\n          alert(`There was an error while trying to save your items. Please contact support and share this message: ${data}`);\n        }\n      });\n\n      let encryptionEnabled = authManager.user || passcodeManager.hasPasscode();\n      this.syncStatus = statusManager.addStatusFromString(encryptionEnabled ? \"Decrypting items...\" : \"Loading items...\");\n\n      let incrementalCallback = (current, total) => {\n        let notesString = `${current}/${total} items...`\n        this.syncStatus = statusManager.replaceStatusWithString(this.syncStatus, encryptionEnabled ? `Decrypting ${notesString}` : `Loading ${notesString}`);\n      }\n\n      syncManager.loadLocalItems({incrementalCallback}).then(() => {\n        $timeout(() => {\n          $rootScope.$broadcast(\"initial-data-loaded\"); // This needs to be processed first before sync is called so that singletonManager observers function properly.\n          // Perform integrity check on first sync\n          this.syncStatus = statusManager.replaceStatusWithString(this.syncStatus, \"Syncing...\");\n          syncManager.sync({performIntegrityCheck: true}).then(() => {\n            this.syncStatus = statusManager.removeStatus(this.syncStatus);\n          })\n          // refresh every 30s\n          setInterval(function () {\n            syncManager.sync();\n          }, 30000);\n        })\n      });\n\n      authManager.addEventHandler((event) => {\n        if(event == SFAuthManager.DidSignOutEvent) {\n          modelManager.handleSignout();\n          syncManager.handleSignout();\n        }\n      })\n    }\n\n    function load() {\n      // pass keys to storageManager to decrypt storage\n      // Update: Wait, why? passcodeManager already handles this.\n      // storageManager.setKeys(passcodeManager.keys());\n\n      openDatabase();\n      // Retrieve local data and begin sycing timer\n      initiateSync();\n    }\n\n    if(passcodeManager.isLocked()) {\n      $scope.needsUnlock = true;\n    } else {\n      load();\n    }\n\n    $scope.onSuccessfulUnlock = function() {\n      $timeout(() => {\n        $scope.needsUnlock = false;\n        load();\n      })\n    }\n\n    function openDatabase() {\n      dbManager.setLocked(false);\n      dbManager.openDatabase(null, function() {\n        // new database, delete syncToken so that items can be refetched entirely from server\n        syncManager.clearSyncToken();\n        syncManager.sync();\n      })\n    }\n\n    /*\n    Editor Callbacks\n    */\n\n    $scope.updateTagsForNote = function(note, stringTags) {\n      var toRemove = [];\n      for(var tag of note.tags) {\n        if(stringTags.indexOf(tag.title) === -1) {\n          // remove this tag\n          toRemove.push(tag);\n        }\n      }\n\n      for(var tagToRemove of toRemove) {\n        tagToRemove.removeItemAsRelationship(note);\n      }\n\n      modelManager.setItemsDirty(toRemove, true);\n\n      var tags = [];\n      for(var tagString of stringTags) {\n        var existingRelationship = _.find(note.tags, {title: tagString});\n        if(!existingRelationship) {\n          tags.push(modelManager.findOrCreateTagByTitle(tagString));\n        }\n      }\n\n      for(var tag of tags) {\n        tag.addItemAsRelationship(note);\n      }\n\n      modelManager.setItemsDirty(tags, true);\n\n      syncManager.sync();\n    }\n\n    /*\n    Tags Ctrl Callbacks\n    */\n\n    $scope.tagsSelectionMade = function(tag) {\n      // If a tag is selected twice, then the needed dummy note is removed.\n      // So we perform this check.\n      if($scope.selectedTag && tag && $scope.selectedTag.uuid == tag.uuid) {\n        return;\n      }\n\n      if($scope.selectedNote && $scope.selectedNote.dummy) {\n        modelManager.removeItemLocally($scope.selectedNote);\n        $scope.selectedNote = null;\n      }\n\n      $scope.selectedTag = tag;\n    }\n\n    $scope.tagsAddNew = function(tag) {\n      modelManager.addItem(tag);\n    }\n\n    $scope.tagsSave = function(tag, callback) {\n      if(!tag.title || tag.title.length == 0) {\n        $scope.removeTag(tag);\n        return;\n      }\n\n      modelManager.setItemDirty(tag, true);\n      syncManager.sync().then(callback);\n      modelManager.resortTag(tag);\n    }\n\n    /*\n    Notes Ctrl Callbacks\n    */\n\n    $scope.removeTag = function(tag) {\n      if(confirm(\"Are you sure you want to delete this tag? Note: deleting a tag will not delete its notes.\")) {\n        modelManager.setItemToBeDeleted(tag);\n        syncManager.sync().then(() => {\n          // force scope tags to update on sub directives\n          $rootScope.safeApply();\n        });\n      }\n    }\n\n    $scope.notesSelectionMade = function(note) {\n      $scope.selectedNote = note;\n    }\n\n    $scope.notesAddNew = function(note) {\n      modelManager.addItem(note);\n      modelManager.setItemDirty(note);\n\n      if(!$scope.selectedTag.isSmartTag()) {\n        $scope.selectedTag.addItemAsRelationship(note);\n        modelManager.setItemDirty($scope.selectedTag, true);\n      }\n    }\n\n    /*\n    Shared Callbacks\n    */\n\n    $rootScope.safeApply = function(fn) {\n      var phase = this.$root.$$phase;\n      if(phase == '$apply' || phase == '$digest')\n        this.$eval(fn);\n      else\n        this.$apply(fn);\n    };\n\n    $rootScope.notifyDelete = function() {\n      $timeout(function() {\n        $rootScope.$broadcast(\"noteDeleted\");\n      }.bind(this), 0);\n    }\n\n    $scope.deleteNote = function(note) {\n      modelManager.setItemToBeDeleted(note);\n\n      if(note == $scope.selectedNote) {\n        $scope.selectedNote = null;\n      }\n\n      if(note.dummy) {\n        modelManager.removeItemLocally(note);\n        $rootScope.notifyDelete();\n        return;\n      }\n\n      syncManager.sync().then(() => {\n        if(authManager.offline()) {\n          // when deleting items while ofline, we need to explictly tell angular to refresh UI\n          setTimeout(function () {\n            $rootScope.notifyDelete();\n            $rootScope.safeApply();\n          }, 50);\n        } else {\n          $timeout(() => {\n            $rootScope.notifyDelete();\n          });\n        }\n      });\n    }\n\n    /*\n      Disable dragging and dropping of files into main SN interface.\n      both 'dragover' and 'drop' are required to prevent dropping of files.\n      This will not prevent extensions from receiving drop events.\n    */\n    window.addEventListener('dragover', (event) => {\n      event.preventDefault();\n    }, false)\n\n    window.addEventListener('drop', (event) => {\n      event.preventDefault();\n      alert(\"Please use FileSafe or the Bold Editor to attach images and files. Learn more at standardnotes.org/filesafe.\")\n    }, false)\n\n\n    /*\n      Handle Auto Sign In From URL\n    */\n\n    function urlParam(key) {\n      return $location.search()[key];\n    }\n\n    async function autoSignInFromParams() {\n      var server = urlParam(\"server\");\n      var email = urlParam(\"email\");\n      var pw = urlParam(\"pw\");\n\n      if(!authManager.offline()) {\n        // check if current account\n        if(await syncManager.getServerURL() === server && authManager.user.email === email) {\n          // already signed in, return\n          return;\n        } else {\n          // sign out\n          authManager.signout(true).then(() => {\n            window.location.reload();\n          });\n        }\n      } else {\n        authManager.login(server, email, pw, false, false, {}).then((response) => {\n          window.location.reload();\n        })\n      }\n    }\n\n    if(urlParam(\"server\")) {\n      autoSignInFromParams();\n    }\n});\n;class LockScreen {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"lock-screen.html\";\n    this.scope = {\n      onSuccess: \"&\",\n    };\n  }\n\n  controller($scope, passcodeManager, authManager, syncManager, storageManager) {\n    'ngInject';\n\n    $scope.formData = {};\n\n    this.visibilityObserver = passcodeManager.addVisibilityObserver((visible) => {\n      if(visible) {\n        let input = document.getElementById(\"passcode-input\");\n        if(input) {\n          input.focus();\n        }\n      }\n    })\n\n    $scope.$on(\"$destroy\", () => {\n      passcodeManager.removeVisibilityObserver(this.visibilityObserver);\n    });\n\n    $scope.submitPasscodeForm = function() {\n      if(!$scope.formData.passcode || $scope.formData.passcode.length == 0) {\n        return;\n      }\n      passcodeManager.unlock($scope.formData.passcode, (success) => {\n        if(!success) {\n          alert(\"Invalid passcode. Please try again.\");\n          return;\n        }\n\n        $scope.onSuccess()();\n      })\n    }\n\n    $scope.forgotPasscode = function() {\n      $scope.formData.showRecovery = true;\n    }\n\n    $scope.beginDeleteData = function() {\n      if(!confirm(\"Are you sure you want to clear all local data?\")) {\n        return;\n      }\n\n      authManager.signout(true).then(() => {\n        window.location.reload();\n      })\n    }\n  }\n}\n\nangular.module('app').directive('lockScreen', () => new LockScreen);\n;angular.module('app')\n  .directive(\"notesSection\", function(){\n    return {\n      scope: {\n        addNew: \"&\",\n        selectionMade: \"&\",\n        tag: \"=\"\n      },\n\n      templateUrl: 'notes.html',\n      replace: true,\n      controller: 'NotesCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n        scope.$watch('ctrl.tag', (tag, oldTag) => {\n          if(tag) {\n            ctrl.tagDidChange(tag, oldTag);\n          }\n        });\n      }\n    }\n  })\n  .controller('NotesCtrl', function (authManager, $timeout, $rootScope, modelManager,\n    syncManager, storageManager, desktopManager, privilegesManager, keyboardManager) {\n\n    this.panelController = {};\n    this.searchSubmitted = false;\n\n    $rootScope.$on(\"user-preferences-changed\", () => {\n      this.loadPreferences();\n      this.reloadNotes();\n    });\n\n    authManager.addEventHandler((event) => {\n      if(event == SFAuthManager.DidSignInEvent) {\n        // Delete dummy note if applicable\n        if(this.selectedNote && this.selectedNote.dummy) {\n          modelManager.removeItemLocally(this.selectedNote);\n          _.pull(this.notes, this.selectedNote);\n          this.selectedNote = null;\n          this.selectNote(null);\n\n          // We now want to see if the user will download any items from the server.\n          // If the next sync completes and our notes are still 0, we need to create a dummy.\n          this.createDummyOnSynCompletionIfNoNotes = true;\n        }\n      }\n    })\n\n    syncManager.addEventHandler((syncEvent, data) => {\n      if(syncEvent == \"local-data-loaded\") {\n        if(this.notes.length == 0) {\n          this.createNewNote();\n        }\n      } else if(syncEvent == \"sync:completed\") {\n        // Pad with a timeout just to be extra patient\n        $timeout(() => {\n          if(this.createDummyOnSynCompletionIfNoNotes && this.notes.length == 0) {\n            this.createDummyOnSynCompletionIfNoNotes = false;\n            this.createNewNote();\n          }\n        }, 100)\n      }\n    });\n\n    modelManager.addItemSyncObserver(\"note-list\", \"*\", (allItems, validItems, deletedItems, source, sourceKey) => {\n      // reload our notes\n      this.reloadNotes();\n\n      // Note has changed values, reset its flags\n      let notes = allItems.filter((item) => item.content_type == \"Note\");\n      for(let note of notes) {\n        this.loadFlagsForNote(note);\n        note.cachedCreatedAtString = note.createdAtString();\n        note.cachedUpdatedAtString = note.updatedAtString();\n      }\n\n      // select first note if none is selected\n      if(!this.selectedNote) {\n        $timeout(() => {\n          // required to be in timeout since selecting notes depends on rendered notes\n          this.selectFirstNote();\n        })\n      }\n    });\n\n    this.setNotes = function(notes) {\n      notes = this.filterNotes(notes);\n      notes = this.sortNotes(notes, this.sortBy, this.sortReverse);\n      for(let note of notes) {\n        note.shouldShowTags = this.shouldShowTagsForNote(note);\n      }\n      this.notes = notes;\n\n      this.reloadPanelTitle();\n    }\n\n    this.reloadNotes = function() {\n      let notes = this.tag.notes;\n\n      // Typically we reload flags via modelManager.addItemSyncObserver,\n      // but sync observers are not notified of errored items, so we'll do it here instead\n      for(let note of notes) {\n        if(note.errorDecrypting) {\n          this.loadFlagsForNote(note);\n        }\n      }\n\n      this.setNotes(notes);\n    }\n\n    this.reorderNotes = function() {\n      this.setNotes(this.notes);\n    }\n\n    this.loadPreferences = function() {\n      let prevSortValue = this.sortBy;\n\n      this.sortBy = authManager.getUserPrefValue(\"sortBy\", \"created_at\");\n      this.sortReverse = authManager.getUserPrefValue(\"sortReverse\", false);\n\n      if(this.sortBy == \"updated_at\") {\n        // use client_updated_at instead\n        this.sortBy = \"client_updated_at\";\n      }\n\n      if(prevSortValue && prevSortValue != this.sortBy) {\n        $timeout(() => {\n          this.selectFirstNote();\n        })\n      }\n\n      this.showArchived = authManager.getUserPrefValue(\"showArchived\", false);\n      this.hidePinned = authManager.getUserPrefValue(\"hidePinned\", false);\n      this.hideNotePreview = authManager.getUserPrefValue(\"hideNotePreview\", false);\n      this.hideDate = authManager.getUserPrefValue(\"hideDate\", false);\n      this.hideTags = authManager.getUserPrefValue(\"hideTags\", false);\n\n      let width = authManager.getUserPrefValue(\"notesPanelWidth\");\n      if(width) {\n        this.panelController.setWidth(width);\n        if(this.panelController.isCollapsed()) {\n          $rootScope.$broadcast(\"panel-resized\", {panel: \"notes\", collapsed: this.panelController.isCollapsed()})\n        }\n      }\n    }\n\n    this.loadPreferences();\n\n    this.onPanelResize = function(newWidth, lastLeft, isAtMaxWidth, isCollapsed) {\n      authManager.setUserPrefValue(\"notesPanelWidth\", newWidth);\n      authManager.syncUserPreferences();\n      $rootScope.$broadcast(\"panel-resized\", {panel: \"notes\", collapsed: isCollapsed})\n    }\n\n    angular.element(document).ready(() => {\n      this.loadPreferences();\n    });\n\n    $rootScope.$on(\"editorFocused\", function(){\n      this.showMenu = false;\n    }.bind(this))\n\n    $rootScope.$on(\"noteDeleted\", function() {\n      $timeout(this.onNoteRemoval.bind(this));\n    }.bind(this))\n\n    $rootScope.$on(\"noteArchived\", function() {\n      $timeout(this.onNoteRemoval.bind(this));\n    }.bind(this));\n\n\n    // When a note is removed from the list\n    this.onNoteRemoval = function() {\n      let visibleNotes = this.visibleNotes();\n      let index;\n      if(this.selectedIndex < visibleNotes.length) {\n        index = Math.max(this.selectedIndex, 0);\n      } else {\n        index = visibleNotes.length - 1;\n      }\n\n      let note = visibleNotes[index];\n      if(note) {\n        this.selectNote(note);\n      } else {\n        this.createNewNote();\n      }\n    }\n\n    window.onresize = (event) =>   {\n      this.resetPagination({keepCurrentIfLarger: true});\n    };\n\n    this.paginate = function() {\n      this.notesToDisplay += this.DefaultNotesToDisplayValue\n\n      if (this.searchSubmitted) {\n        desktopManager.searchText(this.noteFilter.text);\n      }\n    }\n\n    this.resetPagination = function({keepCurrentIfLarger} = {}) {\n      let MinNoteHeight = 51.0; // This is the height of a note cell with nothing but the title, which *is* a display option\n      this.DefaultNotesToDisplayValue = (document.documentElement.clientHeight / MinNoteHeight) || 20;\n      if(keepCurrentIfLarger && this.notesToDisplay > this.DefaultNotesToDisplayValue) {\n        return;\n      }\n      this.notesToDisplay = this.DefaultNotesToDisplayValue;\n    }\n\n    this.resetPagination();\n\n    this.reloadPanelTitle = function() {\n      if(this.isFiltering()) {\n        this.panelTitle = `${this.notes.filter((i) => {return i.visible;}).length} search results`;\n      } else if(this.tag) {\n        this.panelTitle = `${this.tag.title}`;\n      }\n    }\n\n    this.optionsSubtitle = function() {\n      var base = \"\";\n      if(this.sortBy == \"created_at\") {\n        base += \" Date Added\";\n      } else if(this.sortBy == \"client_updated_at\") {\n        base += \" Date Modified\";\n      } else if(this.sortBy == \"title\") {\n        base += \" Title\";\n      }\n\n      if(this.showArchived) {\n        base += \" | + Archived\"\n      }\n      if(this.hidePinned) {\n        base += \" | – Pinned\"\n      }\n      if(this.sortReverse) {\n        base += \" | Reversed\"\n      }\n\n      return base;\n    }\n\n    this.loadFlagsForNote = (note) => {\n      let flags = [];\n\n      if(note.pinned) {\n        flags.push({\n          text: \"Pinned\",\n          class: \"info\"\n        })\n      }\n\n      if(note.archived) {\n        flags.push({\n          text: \"Archived\",\n          class: \"warning\"\n        })\n      }\n\n      if(note.content.protected) {\n        flags.push({\n          text: \"Protected\",\n          class: \"success\"\n        })\n      }\n\n      if(note.locked) {\n        flags.push({\n          text: \"Locked\",\n          class: \"neutral\"\n        })\n      }\n\n      if(note.content.trashed) {\n        flags.push({\n          text: \"Deleted\",\n          class: \"danger\"\n        })\n      }\n\n      if(note.content.conflict_of) {\n        flags.push({\n          text: \"Conflicted Copy\",\n          class: \"danger\"\n        })\n      }\n\n      if(note.errorDecrypting) {\n        flags.push({\n          text: \"Missing Keys\",\n          class: \"danger\"\n        })\n      }\n\n      if(note.deleted) {\n        flags.push({\n          text: \"Deletion Pending Sync\",\n          class: \"danger\"\n        })\n      }\n\n      note.flags = flags;\n\n      return flags;\n    }\n\n    this.tagDidChange = function(tag, oldTag) {\n      var scrollable = document.getElementById(\"notes-scrollable\");\n      if(scrollable) {\n        scrollable.scrollTop = 0;\n        scrollable.scrollLeft = 0;\n      }\n\n      this.resetPagination();\n\n      this.showMenu = false;\n\n      if(this.selectedNote) {\n        if(this.selectedNote.dummy && oldTag) {\n          _.remove(oldTag.notes, this.selectedNote);\n        }\n      }\n\n      this.noteFilter.text = \"\";\n      desktopManager.searchText();\n\n      this.setNotes(tag.notes);\n\n      // perform in timeout since visibleNotes relies on renderedNotes which relies on render to complete\n      $timeout(() => {\n        if(this.notes.length > 0) {\n          this.notes.forEach((note) => { note.visible = true; })\n          this.selectFirstNote();\n        } else if(syncManager.initialDataLoaded()) {\n          if(!tag.isSmartTag()) {\n            this.createNewNote();\n          } else {\n            if(this.selectedNote && !this.notes.includes(this.selectedNote)) {\n              this.selectNote(null);\n            }\n          }\n        }\n      })\n    }\n\n    this.visibleNotes = function() {\n      return this.renderedNotes.filter(function(note){\n        return note.visible;\n      });\n    }\n\n    this.selectFirstNote = function() {\n      var visibleNotes = this.visibleNotes();\n      if(visibleNotes.length > 0) {\n        this.selectNote(visibleNotes[0]);\n      }\n    }\n\n    this.selectNextNote = function() {\n      var visibleNotes = this.visibleNotes();\n      let currentIndex = visibleNotes.indexOf(this.selectedNote);\n      if(currentIndex + 1 < visibleNotes.length) {\n        this.selectNote(visibleNotes[currentIndex + 1]);\n      }\n    }\n\n    this.selectPreviousNote = function() {\n      var visibleNotes = this.visibleNotes();\n      let currentIndex = visibleNotes.indexOf(this.selectedNote);\n      if(currentIndex - 1 >= 0) {\n        this.selectNote(visibleNotes[currentIndex - 1]);\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    this.selectNote = async function(note, viaClick = false) {\n      if(!note) {\n        this.selectionMade()(null);\n        return;\n      }\n\n      let run = () => {\n        $timeout(() => {\n          let dummyNote;\n          if(this.selectedNote && this.selectedNote != note && this.selectedNote.dummy) {\n            // remove dummy\n            dummyNote = this.selectedNote;\n          }\n\n          this.selectedNote = note;\n          if(note.content.conflict_of) {\n            note.content.conflict_of = null; // clear conflict\n            modelManager.setItemDirty(note, true);\n            syncManager.sync();\n          }\n          this.selectionMade()(note);\n          this.selectedIndex = Math.max(this.visibleNotes().indexOf(note), 0);\n\n          // There needs to be a long timeout after setting selection before removing the dummy\n          // Otherwise, you'll click a note, remove this one, and strangely, the click event registers for a lower cell\n          if(dummyNote) {\n            $timeout(() => {\n              modelManager.removeItemLocally(dummyNote);\n              _.pull(this.notes, dummyNote);\n            }, 250)\n          }\n\n          if(viaClick && this.isFiltering()) {\n            desktopManager.searchText(this.noteFilter.text);\n          }\n        })\n      }\n\n      if(note.content.protected && await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionViewProtectedNotes)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionViewProtectedNotes, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    this.isFiltering = function() {\n      return this.noteFilter.text && this.noteFilter.text.length > 0;\n    }\n\n    this.createNewNote = function() {\n      // The \"Note X\" counter is based off this.notes.length, but sometimes, what you see in the list is only a subset.\n      // We can use this.visibleNotes().length, but that only accounts for non-paginated results, so first 15 or so.\n      var title = \"Note\" + (this.notes ? (\" \" + (this.notes.length + 1)) : \"\");\n      let newNote = modelManager.createItem({content_type: \"Note\", content: {text: \"\", title: title}});\n      newNote.dummy = true;\n      this.newNote = newNote;\n      this.selectNote(this.newNote);\n      this.addNew()(this.newNote);\n    }\n\n    this.noteFilter = {text : ''};\n\n    this.onFilterEnter = function() {\n      // For Desktop, performing a search right away causes input to lose focus.\n      // We wait until user explicity hits enter before highlighting desktop search results.\n      this.searchSubmitted = true;\n      desktopManager.searchText(this.noteFilter.text);\n    }\n\n    this.clearFilterText = function() {\n      this.noteFilter.text = '';\n      this.onFilterEnter();\n      this.filterTextChanged();\n\n      // Reset loaded notes\n      this.resetPagination();\n    }\n\n    this.filterTextChanged = function() {\n      if(this.searchSubmitted) {\n        this.searchSubmitted = false;\n      }\n\n      this.reloadNotes();\n\n      $timeout(() => {\n        if(!this.selectedNote.visible) {\n          this.selectFirstNote();\n        }\n      }, 100)\n    }\n\n    this.selectedMenuItem = function() {\n      this.showMenu = false;\n    }\n\n    this.togglePrefKey = function(key) {\n      this[key] = !this[key];\n      authManager.setUserPrefValue(key, this[key]);\n      authManager.syncUserPreferences();\n      this.reloadNotes();\n    }\n\n    this.selectedSortByCreated = function() {\n      this.setSortBy(\"created_at\");\n    }\n\n    this.selectedSortByUpdated = function() {\n      this.setSortBy(\"client_updated_at\");\n    }\n\n    this.selectedSortByTitle = function() {\n      this.setSortBy(\"title\");\n    }\n\n    this.toggleReverseSort = function() {\n      this.selectedMenuItem();\n      this.sortReverse = !this.sortReverse;\n      this.reorderNotes();\n      authManager.setUserPrefValue(\"sortReverse\", this.sortReverse);\n      authManager.syncUserPreferences();\n    }\n\n    this.setSortBy = function(type) {\n      this.sortBy = type;\n      this.reorderNotes();\n      authManager.setUserPrefValue(\"sortBy\", this.sortBy);\n      authManager.syncUserPreferences();\n    }\n\n    this.shouldShowTagsForNote = function(note) {\n      if(this.hideTags || note.content.protected) {\n        return false;\n      }\n\n      if(this.tag.content.isAllTag) {\n        return note.tags && note.tags.length > 0;\n      }\n\n      if(this.tag.isSmartTag()) {\n        return true;\n      }\n\n      // Inside a tag, only show tags string if note contains tags other than this.tag\n      return note.tags && note.tags.length > 1;\n    }\n\n    this.filterNotes = function(notes) {\n      return notes.filter((note) => {\n        let canShowArchived = this.showArchived, canShowPinned = !this.hidePinned;\n        let isTrash = this.tag.content.isTrashTag;\n\n        if(!isTrash && note.content.trashed) {\n          note.visible = false;\n          return note.visible;\n        }\n\n        var isSmartTag = this.tag.isSmartTag();\n        if(isSmartTag) {\n          canShowArchived = canShowArchived || this.tag.content.isArchiveTag || isTrash;\n        }\n\n        if((note.archived && !canShowArchived) || (note.pinned && !canShowPinned)) {\n          note.visible = false;\n          return note.visible;\n        }\n\n        var filterText = this.noteFilter.text.toLowerCase();\n        if(filterText.length == 0) {\n          note.visible = true;\n        } else {\n          var words = filterText.split(\" \");\n          var matchesTitle = words.every(function(word) { return  note.safeTitle().toLowerCase().indexOf(word) >= 0; });\n          var matchesBody = words.every(function(word) { return  note.safeText().toLowerCase().indexOf(word) >= 0; });\n          note.visible = matchesTitle || matchesBody;\n        }\n\n        return note.visible;\n      });\n    }\n\n    this.sortNotes = function(items, sortBy, reverse) {\n      let sortValueFn = (a, b, pinCheck = false) => {\n        if(a.dummy) { return -1; }\n        if(b.dummy) { return 1; }\n        if(!pinCheck) {\n          if(a.pinned && b.pinned) {\n            return sortValueFn(a, b, true);\n          }\n          if(a.pinned) { return -1; }\n          if(b.pinned) { return 1; }\n        }\n\n        var aValue = a[sortBy] || \"\";\n        var bValue = b[sortBy] || \"\";\n\n        let vector = 1;\n\n        if(reverse) {\n          vector *= -1;\n        }\n\n        if(sortBy == \"title\") {\n          aValue = aValue.toLowerCase();\n          bValue = bValue.toLowerCase();\n\n          if(aValue.length == 0 && bValue.length == 0) {\n            return 0;\n          } else if(aValue.length == 0 && bValue.length != 0) {\n            return 1 * vector;\n          } else if(aValue.length != 0 && bValue.length == 0) {\n            return -1 * vector;\n          } else  {\n            vector *= -1;\n          }\n        }\n\n        if(aValue > bValue) { return -1 * vector;}\n        else if(aValue < bValue) { return 1 * vector;}\n        return 0;\n      }\n\n      items = items || [];\n      var result = items.sort(function(a, b){\n        return sortValueFn(a, b);\n      })\n      return result;\n    };\n\n\n    /*\n      Keyboard Shortcuts\n    */\n\n    // In the browser we're not allowed to override cmd/ctrl + n, so we have to use Control modifier as well.\n    // These rules don't apply to desktop, but probably better to be consistent.\n    this.newNoteKeyObserver = keyboardManager.addKeyObserver({\n      key: \"n\",\n      modifiers: [KeyboardManager.KeyModifierMeta, KeyboardManager.KeyModifierCtrl],\n      onKeyDown: (event) => {\n        event.preventDefault();\n        $timeout(() => {\n          this.createNewNote();\n        });\n      }\n    })\n\n    this.getSearchBar = function() {\n      return document.getElementById(\"search-bar\");\n    }\n\n    this.nextNoteKeyObserver = keyboardManager.addKeyObserver({\n      key: KeyboardManager.KeyDown,\n      elements: [document.body, this.getSearchBar()],\n      onKeyDown: (event) => {\n        let searchBar = this.getSearchBar();\n        if(searchBar == document.activeElement) {\n          searchBar.blur()\n        }\n        $timeout(() => {\n          this.selectNextNote();\n        });\n      }\n    })\n\n    this.nextNoteKeyObserver = keyboardManager.addKeyObserver({\n      key: KeyboardManager.KeyUp,\n      element: document.body,\n      onKeyDown: (event) => {\n        $timeout(() => {\n          this.selectPreviousNote();\n        });\n      }\n    });\n\n    this.searchKeyObserver = keyboardManager.addKeyObserver({\n      key: \"f\",\n      modifiers: [KeyboardManager.KeyModifierMeta, KeyboardManager.KeyModifierShift],\n      onKeyDown: (event) => {\n        let searchBar = this.getSearchBar();\n        if(searchBar) {searchBar.focus()};\n      }\n    })\n\n  });\n;angular.module('app')\n  .directive(\"tagsSection\", function(){\n    return {\n      restrict: 'E',\n      scope: {\n        addNew: \"&\",\n        selectionMade: \"&\",\n        save: \"&\",\n        removeTag: \"&\"\n      },\n      templateUrl: 'tags.html',\n      replace: true,\n      controller: 'TagsCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n    }\n  })\n  .controller('TagsCtrl', function ($rootScope, modelManager, syncManager, $timeout, componentManager, authManager) {\n    // Wrap in timeout so that selectTag is defined\n    $timeout(() => {\n      this.smartTags = modelManager.getSmartTags();\n      this.selectTag(this.smartTags[0]);\n    })\n\n    syncManager.addEventHandler((syncEvent, data) => {\n      if(syncEvent == \"local-data-loaded\"\n        || syncEvent == \"sync:completed\"\n        || syncEvent == \"local-data-incremental-load\") {\n        this.tags = modelManager.tags;\n        this.smartTags = modelManager.getSmartTags();\n      }\n    });\n\n    modelManager.addItemSyncObserver(\"tags-list\", \"*\", (allItems, validItems, deletedItems, source, sourceKey) => {\n      this.reloadNoteCounts();\n    });\n\n    this.reloadNoteCounts = function() {\n      let allTags = [];\n      if(this.tags) { allTags = allTags.concat(this.tags);}\n      if(this.smartTags) { allTags = allTags.concat(this.smartTags);}\n\n      for(let tag of allTags) {\n        var validNotes = SNNote.filterDummyNotes(tag.notes).filter((note) => {\n          return !note.archived && !note.content.trashed;\n        });\n\n        tag.cachedNoteCount = validNotes.length;\n      }\n    }\n\n    this.panelController = {};\n\n    $rootScope.$on(\"user-preferences-changed\", () => {\n      this.loadPreferences();\n    });\n\n    this.loadPreferences = function() {\n      let width = authManager.getUserPrefValue(\"tagsPanelWidth\");\n      if(width) {\n        this.panelController.setWidth(width);\n        if(this.panelController.isCollapsed()) {\n          $rootScope.$broadcast(\"panel-resized\", {panel: \"tags\", collapsed: this.panelController.isCollapsed()})\n        }\n      }\n    }\n\n    this.loadPreferences();\n\n    this.onPanelResize = function(newWidth, lastLeft, isAtMaxWidth, isCollapsed) {\n      authManager.setUserPrefValue(\"tagsPanelWidth\", newWidth, true);\n      $rootScope.$broadcast(\"panel-resized\", {panel: \"tags\", collapsed: isCollapsed})\n    }\n\n    this.componentManager = componentManager;\n\n    componentManager.registerHandler({identifier: \"tags\", areas: [\"tags-list\"], activationHandler: function(component){\n      this.component = component;\n    }.bind(this), contextRequestHandler: function(component){\n      return null;\n    }.bind(this), actionHandler: function(component, action, data){\n      if(action === \"select-item\") {\n        if(data.item.content_type == \"Tag\") {\n          let tag = modelManager.findItem(data.item.uuid);\n          if(tag) {\n            this.selectTag(tag);\n          }\n        } else if(data.item.content_type == \"SN|SmartTag\") {\n          let smartTag = new SNSmartTag(data.item);\n          this.selectTag(smartTag);\n        }\n      } else if(action === \"clear-selection\") {\n        this.selectTag(this.smartTags[0]);\n      }\n    }.bind(this)});\n\n    this.selectTag = function(tag) {\n      if(tag.isSmartTag()) {\n        Object.defineProperty(tag, \"notes\", {\n          get: () => {\n            return modelManager.notesMatchingSmartTag(tag);\n          }\n        });\n      }\n      this.selectedTag = tag;\n      if(tag.content.conflict_of) {\n        tag.content.conflict_of = null;\n        modelManager.setItemDirty(tag, true);\n        syncManager.sync();\n      }\n      this.selectionMade()(tag);\n    }\n\n    this.clickedAddNewTag = function() {\n      if(this.editingTag) {\n        return;\n      }\n\n      this.newTag = modelManager.createItem({content_type: \"Tag\"});\n      this.selectedTag = this.newTag;\n      this.editingTag = this.newTag;\n      this.addNew()(this.newTag);\n    }\n\n    this.tagTitleDidChange = function(tag) {\n      this.editingTag = tag;\n    }\n\n    this.saveTag = function($event, tag) {\n      this.editingTag = null;\n      $event.target.blur();\n\n      if(!tag.title || tag.title.length == 0) {\n        if(originalTagName) {\n          tag.title = originalTagName;\n          originalTagName = null;\n        } else {\n          // newly created tag without content\n          modelManager.removeItemLocally(tag);\n        }\n        return;\n      }\n\n      this.save()(tag, (savedTag) => {\n        $timeout(() => {\n          this.selectTag(tag);\n          this.newTag = null;\n        })\n      });\n    }\n\n    function inputElementForTag(tag) {\n      return document.getElementById(\"tag-\" + tag.uuid);\n    }\n\n    var originalTagName = \"\";\n    this.selectedRenameTag = function($event, tag) {\n      originalTagName = tag.title;\n      this.editingTag = tag;\n      $timeout(function(){\n        inputElementForTag(tag).focus();\n      })\n    }\n\n    this.selectedDeleteTag = function(tag) {\n      this.removeTag()(tag);\n      this.selectTag(this.smartTags[0]);\n    }\n  });\n;class ActionsManager {\n\n  constructor(httpManager, modelManager, authManager, syncManager, $rootScope, $compile, $timeout) {\n    this.httpManager = httpManager;\n    this.modelManager = modelManager;\n    this.authManager = authManager;\n    this.syncManager = syncManager;\n    this.$rootScope = $rootScope;\n    this.$compile = $compile;\n    this.$timeout = $timeout;\n\n    // Used when decrypting old items with new keys. This array is only kept in memory.\n    this.previousPasswords = [];\n  }\n\n  get extensions() {\n    return this.modelManager.validItemsForContentType(\"Extension\");\n  }\n\n  extensionsInContextOfItem(item) {\n    return this.extensions.filter(function(ext){\n      return _.includes(ext.supported_types, item.content_type) || ext.actionsWithContextForItem(item).length > 0;\n    })\n  }\n\n  /*\n  Loads an extension in the context of a certain item. The server then has the chance to respond with actions that are\n  relevant just to this item. The response extension is not saved, just displayed as a one-time thing.\n  */\n  loadExtensionInContextOfItem(extension, item, callback) {\n    this.httpManager.getAbsolute(extension.url, {content_type: item.content_type, item_uuid: item.uuid}, function(response){\n      this.updateExtensionFromRemoteResponse(extension, response);\n      callback && callback(extension);\n    }.bind(this), function(response){\n      console.log(\"Error loading extension\", response);\n      if(callback) {\n        callback(null);\n      }\n    }.bind(this))\n  }\n\n  updateExtensionFromRemoteResponse(extension, response) {\n    if(response.description) { extension.description = response.description; }\n    if(response.supported_types) { extension.supported_types = response.supported_types; }\n\n    if(response.actions) {\n      extension.actions = response.actions.map(function(action){\n        return new Action(action);\n      })\n    } else {\n      extension.actions = [];\n    }\n  }\n\n  async executeAction(action, extension, item, callback) {\n\n    var customCallback = (response, error) => {\n      action.running = false;\n      this.$timeout(() => {\n        callback(response, error);\n      })\n    }\n\n    action.running = true;\n\n    let decrypted = action.access_type == \"decrypted\";\n\n    var triedPasswords = [];\n\n    let handleResponseDecryption = async (response, keys, merge) => {\n      var item = response.item;\n\n      await SFJS.itemTransformer.decryptItem(item, keys);\n\n      if(!item.errorDecrypting) {\n        if(merge) {\n          var items = await this.modelManager.mapResponseItemsToLocalModels([item], SFModelManager.MappingSourceRemoteActionRetrieved);\n          for(var mappedItem of items) {\n            this.modelManager.setItemDirty(mappedItem, true);\n          }\n          this.syncManager.sync();\n          customCallback({item: item});\n        } else {\n          item = this.modelManager.createItem(item);\n          customCallback({item: item});\n        }\n        return true;\n      } else {\n        // Error decrypting\n        if(!response.auth_params) {\n          // In some cases revisions were missing auth params. Instruct the user to email us to get this remedied.\n          alert(\"We were unable to decrypt this revision using your current keys, and this revision is missing metadata that would allow us to try different keys to decrypt it. This can likely be fixed with some manual intervention. Please email hello@standardnotes.org for assistance.\");\n          return;\n        }\n\n        // Try previous passwords\n        for(let passwordCandidate of this.previousPasswords) {\n          if(triedPasswords.includes(passwordCandidate)) {\n            continue;\n          }\n          triedPasswords.push(passwordCandidate);\n\n          var keyResults = await SFJS.crypto.computeEncryptionKeysForUser(passwordCandidate, response.auth_params);\n          if(!keyResults) {\n            continue;\n          }\n\n          var success = await handleResponseDecryption(response, keyResults, merge);\n          if(success) {\n            return true;\n          }\n        }\n\n        this.presentPasswordModal((password) => {\n          this.previousPasswords.push(password);\n          handleResponseDecryption(response, keys, merge);\n        });\n\n        return false;\n      }\n    }\n\n    switch (action.verb) {\n      case \"get\": {\n        if(confirm(\"Are you sure you want to replace the current note contents with this action's results?\")) {\n          this.httpManager.getAbsolute(action.url, {}, async (response) => {\n            action.error = false;\n            handleResponseDecryption(response, await this.authManager.keys(), true);\n          }, (response) => {\n            let error = (response && response.error) || {message: \"An issue occurred while processing this action. Please try again.\"}\n            alert(error.message);\n            action.error = true;\n            customCallback(null, error);\n          })\n        }\n        break;\n      }\n\n      case \"render\": {\n        this.httpManager.getAbsolute(action.url, {}, async (response) => {\n          action.error = false;\n          handleResponseDecryption(response, await this.authManager.keys(), false);\n        }, (response) => {\n          let error = (response && response.error) || {message: \"An issue occurred while processing this action. Please try again.\"}\n          alert(error.message);\n          action.error = true;\n          customCallback(null, error);\n        })\n\n        break;\n      }\n\n      case \"show\": {\n        let win = window.open(action.url, '_blank');\n        if(win) {\n          win.focus();\n        }\n        customCallback();\n        break;\n      }\n\n      case \"post\": {\n        this.outgoingParamsForItem(item, extension, decrypted).then((itemParams) => {\n          var params = {\n            items: [itemParams] // Wrap it in an array\n          }\n\n          this.performPost(action, extension, params, (response) => {\n            if(response && response.error) {\n              alert(\"An issue occurred while processing this action. Please try again.\");\n            }\n            customCallback(response);\n          });\n        })\n\n        break;\n      }\n\n      default: {\n\n      }\n    }\n\n    action.lastExecuted = new Date();\n  }\n\n  async outgoingParamsForItem(item, extension, decrypted = false) {\n    var keys = await this.authManager.keys();\n    if(decrypted) {\n      keys = null;\n    }\n    var itemParams = new SFItemParams(item, keys, await this.authManager.getAuthParams());\n    return itemParams.paramsForExtension();\n  }\n\n  performPost(action, extension, params, callback) {\n    this.httpManager.postAbsolute(action.url, params, function(response){\n      action.error = false;\n      if(callback) {\n        callback(response);\n      }\n    }.bind(this), function(response){\n      action.error = true;\n      console.log(\"Action error response:\", response);\n      if(callback) {\n        callback({error: \"Request error\"});\n      }\n    })\n  }\n\n  presentRevisionPreviewModal(uuid, content) {\n    var scope = this.$rootScope.$new(true);\n    scope.uuid = uuid;\n    scope.content = content;\n    var el = this.$compile( \"<revision-preview-modal uuid='uuid' content='content' class='sk-modal'></revision-preview-modal>\" )(scope);\n    angular.element(document.body).append(el);\n  }\n\n  presentPasswordModal(callback) {\n    var scope = this.$rootScope.$new(true);\n    scope.type = \"password\";\n    scope.title = \"Decryption Assistance\";\n    scope.message = \"Unable to decrypt this item with your current keys. Please enter your account password at the time of this revision.\";\n    scope.callback = callback;\n    var el = this.$compile( \"<input-modal type='type' message='message' title='title' callback='callback'></input-modal>\" )(scope);\n    angular.element(document.body).append(el);\n  }\n\n}\n\nangular.module('app').service('actionsManager', ActionsManager);\n;class ArchiveManager {\n\n  constructor(passcodeManager, authManager, modelManager, privilegesManager) {\n    this.passcodeManager = passcodeManager;\n    this.authManager = authManager;\n    this.modelManager = modelManager;\n    this.privilegesManager = privilegesManager;\n  }\n\n  /*\n  Public\n  */\n\n  async downloadBackup(encrypted) {\n    return this.downloadBackupOfItems(this.modelManager.allItems, encrypted);\n  }\n\n  async downloadBackupOfItems(items, encrypted) {\n    let run = async () => {\n      // download in Standard File format\n      var keys, authParams;\n      if(encrypted) {\n        if(this.authManager.offline() && this.passcodeManager.hasPasscode()) {\n          keys = this.passcodeManager.keys();\n          authParams = this.passcodeManager.passcodeAuthParams();\n        } else {\n          keys = await this.authManager.keys();\n          authParams = await this.authManager.getAuthParams();\n        }\n      }\n      this.__itemsData(items, keys, authParams).then((data) => {\n        let modifier = encrypted ? \"Encrypted\" : \"Decrypted\";\n        this.__downloadData(data, `Standard Notes ${modifier} Backup - ${this.__formattedDate()}.txt`);\n\n        // download as zipped plain text files\n        if(!keys) {\n          this.__downloadZippedItems(items);\n        }\n      })\n    }\n\n    if(await this.privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManageBackups)) {\n      this.privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManageBackups, () => {\n        run();\n      });\n    } else {\n      run();\n    }\n  }\n\n  /*\n  Private\n  */\n\n  __formattedDate() {\n    var string = `${new Date()}`;\n    // Match up to the first parenthesis, i.e do not include '(Central Standard Time)'\n    var matches = string.match(/^(.*?) \\(/);\n    if(matches.length >= 2) {\n      return matches[1]\n    }\n    return string;\n  }\n\n  async __itemsData(items, keys, authParams) {\n    let data = await this.modelManager.getJSONDataForItems(items, keys, authParams);\n    let blobData = new Blob([data], {type: 'text/json'});\n    return blobData;\n  }\n\n  __loadZip(callback) {\n    if(window.zip) {\n      callback();\n      return;\n    }\n\n    var scriptTag = document.createElement('script');\n    scriptTag.src = \"/assets/zip/zip.js\";\n    scriptTag.async = false;\n    var headTag = document.getElementsByTagName('head')[0];\n    headTag.appendChild(scriptTag);\n    scriptTag.onload = function() {\n      zip.workerScriptsPath = \"assets/zip/\";\n      callback();\n    }\n  }\n\n  __downloadZippedItems(items) {\n    this.__loadZip(() => {\n      zip.createWriter(new zip.BlobWriter(\"application/zip\"), (zipWriter) => {\n        var index = 0;\n\n        let nextFile = () => {\n          var item = items[index];\n          var name, contents;\n\n          if(item.content_type == \"Note\") {\n            name = item.content.title;\n            contents = item.content.text;\n          } else {\n            name = item.content_type;\n            contents = JSON.stringify(item.content, null, 2);\n          }\n\n          if(!name) {\n            name = \"\";\n          }\n\n          var blob = new Blob([contents], {type: 'text/plain'});\n\n          var filePrefix = name.replace(/\\//g, \"\").replace(/\\\\+/g, \"\");\n          var fileSuffix = `-${item.uuid.split(\"-\")[0]}.txt`\n\n          // Standard max filename length is 255. Slice the note name down to allow filenameEnd\n          filePrefix = filePrefix.slice(0, (255 - fileSuffix.length));\n\n          let fileName = `${item.content_type}/${filePrefix}${fileSuffix}`\n\n          zipWriter.add(fileName, new zip.BlobReader(blob), () => {\n            index++;\n            if(index < items.length) {\n              nextFile();\n            } else {\n              zipWriter.close((blob) => {\n                this.__downloadData(blob, `Standard Notes Backup - ${this.__formattedDate()}.zip`);\n                zipWriter = null;\n              });\n            }\n          });\n        }\n\n        nextFile();\n      }, onerror);\n    })\n  }\n\n\n  __hrefForData(data) {\n    // If we are replacing a previously generated file we need to\n    // manually revoke the object URL to avoid memory leaks.\n    if (this.textFile !== null) {\n      window.URL.revokeObjectURL(this.textFile);\n    }\n\n    this.textFile = window.URL.createObjectURL(data);\n\n    // returns a URL you can use as a href\n    return this.textFile;\n  }\n\n  __downloadData(data, fileName) {\n    var link = document.createElement('a');\n    link.setAttribute('download', fileName);\n    link.href = this.__hrefForData(data);\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n  }\n\n\n}\n\nangular.module('app').service('archiveManager', ArchiveManager);\n;class AuthManager extends SFAuthManager {\n\n  constructor(modelManager, singletonManager, storageManager, dbManager, httpManager, $rootScope, $timeout, $compile) {\n    super(storageManager, httpManager, null, $timeout);\n    this.$rootScope = $rootScope;\n    this.$compile = $compile;\n    this.modelManager = modelManager;\n    this.singletonManager = singletonManager;\n    this.storageManager = storageManager;\n    this.dbManager = dbManager;\n  }\n\n  loadInitialData() {\n    var userData = this.storageManager.getItemSync(\"user\");\n    if(userData) {\n      this.user = JSON.parse(userData);\n    } else {\n      // legacy, check for uuid\n      var idData = this.storageManager.getItemSync(\"uuid\");\n      if(idData) {\n        this.user = {uuid: idData};\n      }\n    }\n\n    this.configureUserPrefs();\n    this.checkForSecurityUpdate();\n\n    this.modelManager.addItemSyncObserver(\"user-prefs\", \"SN|UserPreferences\", (allItems, validItems, deletedItems, source, sourceKey) => {\n      this.userPreferencesDidChange();\n    });\n\n  }\n\n  offline() {\n    return !this.user;\n  }\n\n  isEphemeralSession() {\n    if(this.ephemeral == null || this.ephemeral == undefined) {\n      this.ephemeral = JSON.parse(this.storageManager.getItemSync(\"ephemeral\", StorageManager.Fixed));\n    }\n    return this.ephemeral;\n  }\n\n  setEphemeral(ephemeral) {\n    this.ephemeral = ephemeral;\n    if(ephemeral) {\n      this.storageManager.setModelStorageMode(StorageManager.Ephemeral);\n      this.storageManager.setItemsMode(StorageManager.Ephemeral);\n    } else {\n      this.storageManager.setModelStorageMode(StorageManager.Fixed);\n      this.storageManager.setItemsMode(this.storageManager.bestStorageMode());\n      this.storageManager.setItem(\"ephemeral\", JSON.stringify(false), StorageManager.Fixed);\n    }\n  }\n\n  async getAuthParamsForEmail(url, email, extraParams) {\n    return super.getAuthParamsForEmail(url, email, extraParams);\n  }\n\n  async login(url, email, password, ephemeral, strictSignin, extraParams) {\n    return super.login(url, email, password, strictSignin, extraParams).then((response) => {\n      if(!response.error) {\n        this.setEphemeral(ephemeral);\n        this.checkForSecurityUpdate();\n      }\n\n      return response;\n    })\n  }\n\n  async register(url, email, password, ephemeral) {\n    return super.register(url, email, password).then((response) => {\n      if(!response.error) {\n        this.setEphemeral(ephemeral);\n      }\n      return response;\n    })\n  }\n\n  async changePassword(url, email, current_server_pw, newKeys, newAuthParams) {\n    return super.changePassword(url, email, current_server_pw, newKeys, newAuthParams).then((response) => {\n      if(!response.error) {\n        this.checkForSecurityUpdate();\n      }\n      return response;\n    })\n  }\n\n  async handleAuthResponse(response, email, url, authParams, keys) {\n    try {\n      await super.handleAuthResponse(response, email, url, authParams, keys);\n      this.user = response.user;\n      this.storageManager.setItem(\"user\", JSON.stringify(response.user));\n    } catch (e) {\n      this.dbManager.displayOfflineAlert();\n    }\n  }\n\n  async verifyAccountPassword(password) {\n    let authParams = await this.getAuthParams();\n    let keys = await SFJS.crypto.computeEncryptionKeysForUser(password, authParams);\n    let success = keys.mk === (await this.keys()).mk;\n    return success;\n  }\n\n  async checkForSecurityUpdate() {\n    if(this.offline()) {\n      return false;\n    }\n\n    let latest = SFJS.version();\n    let updateAvailable = await this.protocolVersion() !== latest;\n    if(updateAvailable !== this.securityUpdateAvailable) {\n      this.securityUpdateAvailable = updateAvailable;\n      this.$rootScope.$broadcast(\"security-update-status-changed\");\n    }\n\n    return this.securityUpdateAvailable;\n  }\n\n  presentPasswordWizard(type) {\n    var scope = this.$rootScope.$new(true);\n    scope.type = type;\n    var el = this.$compile( \"<password-wizard type='type'></password-wizard>\" )(scope);\n    angular.element(document.body).append(el);\n  }\n\n  signOut() {\n    super.signout();\n    this.user = null;\n    this._authParams = null;\n  }\n\n\n  /* User Preferences */\n\n  configureUserPrefs() {\n    let prefsContentType = \"SN|UserPreferences\";\n\n    let contentTypePredicate = new SFPredicate(\"content_type\", \"=\", prefsContentType);\n    this.singletonManager.registerSingleton([contentTypePredicate], (resolvedSingleton) => {\n      this.userPreferences = resolvedSingleton;\n    }, (valueCallback) => {\n      // Safe to create. Create and return object.\n      var prefs = new SFItem({content_type: prefsContentType});\n      this.modelManager.addItem(prefs);\n      this.modelManager.setItemDirty(prefs, true);\n      this.$rootScope.sync();\n      valueCallback(prefs);\n    });\n  }\n\n  userPreferencesDidChange() {\n    this.$rootScope.$broadcast(\"user-preferences-changed\");\n  }\n\n  syncUserPreferences() {\n    if(this.userPreferences) {\n      this.modelManager.setItemDirty(this.userPreferences, true);\n      this.$rootScope.sync();\n    }\n  }\n\n  getUserPrefValue(key, defaultValue) {\n    if(!this.userPreferences) { return defaultValue; }\n    var value = this.userPreferences.getAppDataItem(key);\n    return (value !== undefined && value != null) ? value : defaultValue;\n  }\n\n  setUserPrefValue(key, value, sync) {\n    if(!this.userPreferences) { console.log(\"Prefs are null, not setting value\", key); return; }\n    this.userPreferences.setAppDataItem(key, value);\n    if(sync) {\n      this.syncUserPreferences();\n    }\n  }\n}\n\nangular.module('app').service('authManager', AuthManager);\n;class ComponentManager extends SNComponentManager {\n  constructor(modelManager, syncManager, desktopManager, nativeExtManager, $rootScope, $timeout, $compile) {\n    super({\n      modelManager,\n      syncManager,\n      desktopManager,\n      nativeExtManager,\n      alertManager: new SFAlertManager(),\n      $uiRunner: $rootScope.safeApply,\n      $timeout: $timeout,\n      environment: isDesktopApplication() ? \"desktop\" : \"web\",\n      platform: getPlatformString()\n    });\n\n    // this.loggingEnabled = true;\n\n    this.$compile = $compile;\n    this.$rootScope = $rootScope;\n  }\n\n  openModalComponent(component) {\n    var scope = this.$rootScope.$new(true);\n    scope.component = component;\n    var el = this.$compile( \"<component-modal component='component' class='sk-modal'></component-modal>\" )(scope);\n    angular.element(document.body).append(el);\n  }\n\n  presentPermissionsDialog(dialog) {\n    let scope = this.$rootScope.$new(true);\n    scope.permissionsString = dialog.permissionsString;\n    scope.component = dialog.component;\n    scope.callback = dialog.callback;\n\n    var el = this.$compile( \"<permissions-modal component='component' permissions-string='permissionsString' callback='callback' class='sk-modal'></permissions-modal>\" )(scope);\n    angular.element(document.body).append(el);\n  }\n}\n\nangular.module('app').service('componentManager', ComponentManager);\n;class DBManager {\n\n  constructor() {\n    this.locked = true;\n  }\n\n  displayOfflineAlert() {\n    var message = \"There was an issue loading your offline database. This could happen for two reasons:\";\n    message += \"\\n\\n1. You're in a private window in your browser. We can't save your data without access to the local database. Please use a non-private window.\";\n    message += \"\\n\\n2. You have two windows of the app open at the same time. Please close any other app instances and reload the page.\";\n    alert(message);\n  }\n\n  setLocked(locked) {\n    this.locked = locked;\n  }\n\n  openDatabase(callback, onUgradeNeeded) {\n    if(this.locked) {\n      return;\n    }\n\n    var request = window.indexedDB.open(\"standardnotes\", 1);\n\n    request.onerror = function(event) {\n      if(event.target.errorCode) {\n        alert(\"Offline database issue: \" + event.target.errorCode);\n      } else {\n        this.displayOfflineAlert();\n      }\n      console.error(\"Offline database issue:\", event);\n      if(callback) {\n        callback(null);\n      }\n    }.bind(this);\n\n    request.onsuccess = (event) => {\n      var db = event.target.result;\n      db.onversionchange = function(event) {\n        db.close();\n      };\n      db.onerror = function(errorEvent) {\n        console.log(\"Database error: \" + errorEvent.target.errorCode);\n      }\n      if(callback) {\n        callback(db);\n      }\n    };\n\n    request.onblocked = (event) => {\n      console.error(\"Request blocked error:\", event.target.errorCode);\n    }\n\n    request.onupgradeneeded = (event) => {\n      var db = event.target.result;\n\n      db.onversionchange = function(event) {\n        db.close();\n      };\n\n      // Create an objectStore for this database\n      var objectStore = db.createObjectStore(\"items\", { keyPath: \"uuid\" });\n      objectStore.createIndex(\"title\", \"title\", { unique: false });\n      objectStore.createIndex(\"uuid\", \"uuid\", { unique: true });\n      objectStore.transaction.oncomplete = function(event) {\n        // Ready to store values in the newly created objectStore.\n        if(db.version === 1) {\n          if(onUgradeNeeded) {\n            onUgradeNeeded();\n          }\n        }\n      };\n    };\n  }\n\n  getAllModels(callback) {\n    this.openDatabase((db) => {\n      var objectStore = db.transaction(\"items\").objectStore(\"items\");\n      var items = [];\n      objectStore.openCursor().onsuccess = function(event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          items.push(cursor.value);\n          cursor.continue();\n        }\n        else {\n          callback(items);\n        }\n      };\n    }, null)\n  }\n\n  saveModel(item) {\n    this.saveModels([item]);\n  }\n\n  saveModels(items, onsuccess, onerror) {\n\n    if(items.length == 0) {\n      if(onsuccess) {\n        onsuccess();\n      }\n      return;\n    }\n\n    this.openDatabase((db) => {\n      var transaction = db.transaction(\"items\", \"readwrite\");\n      transaction.oncomplete = function(event) {\n\n      };\n\n      transaction.onerror = function(event) {\n        console.error(\"Transaction error:\", event.target.errorCode);\n      };\n\n      transaction.onblocked = function(event) {\n        console.error(\"Transaction blocked error:\", event.target.errorCode);\n      };\n\n      transaction.onabort = function(event) {\n        console.log(\"Offline saving aborted:\", event);\n        var error = event.target.error;\n        if(error.name == \"QuotaExceededError\") {\n          alert(\"Unable to save changes locally because your device is out of space. Please free up some disk space and try again, otherwise, your data may end up in an inconsistent state.\");\n        } else {\n          alert(`Unable to save changes locally due to an unknown system issue. Issue Code: ${error.code} Issue Name: ${error.name}.`);\n        }\n        onerror && onerror(error);\n      };\n\n      var itemObjectStore = transaction.objectStore(\"items\");\n      var i = 0;\n      putNext();\n\n      function putNext() {\n        if (i < items.length) {\n          var item = items[i];\n          var request = itemObjectStore.put(item);\n          request.onerror = (event) => {\n            console.error(\"DB put error:\", event.target.error);\n          }\n          request.onsuccess = putNext;\n          ++i;\n        } else {\n          onsuccess && onsuccess();\n        }\n      }\n    }, null)\n  }\n\n  deleteModel(item, callback) {\n    this.openDatabase((db) => {\n      var request = db.transaction(\"items\", \"readwrite\").objectStore(\"items\").delete(item.uuid);\n      request.onsuccess = function(event) {\n        if(callback) {\n          callback(true);\n        }\n      };\n    }, null)\n  }\n\n  clearAllModels(callback) {\n    var deleteRequest = window.indexedDB.deleteDatabase(\"standardnotes\");\n\n    deleteRequest.onerror = function(event) {\n      console.log(\"Error deleting database.\");\n      callback && callback();\n    };\n\n    deleteRequest.onsuccess = function(event) {\n      console.log(\"Database deleted successfully\");\n      callback && callback();\n    };\n\n    deleteRequest.onblocked = function(event) {\n      console.error(\"Delete request blocked\");\n      alert(\"Your browser is blocking Standard Notes from deleting the local database. Make sure there are no other open windows of this app and try again. If the issue persists, please manually delete app data to sign out.\")\n    };\n  }\n}\n\nangular.module('app').service('dbManager', DBManager);\n;// An interface used by the Desktop app to interact with SN\n\nclass DesktopManager {\n\n  constructor($rootScope, $timeout, modelManager, syncManager, authManager, passcodeManager) {\n    this.passcodeManager = passcodeManager;\n    this.modelManager = modelManager;\n    this.authManager = authManager;\n    this.syncManager = syncManager;\n    this.$rootScope = $rootScope;\n    this.timeout = $timeout;\n    this.updateObservers = [];\n    this.componentActivationObservers = [];\n\n    this.isDesktop = isDesktopApplication();\n\n    $rootScope.$on(\"initial-data-loaded\", () => {\n      this.dataLoaded = true;\n      if(this.dataLoadHandler) {\n        this.dataLoadHandler();\n      }\n    });\n\n    $rootScope.$on(\"major-data-change\", () => {\n      if(this.majorDataChangeHandler) {\n        this.majorDataChangeHandler();\n      }\n    })\n  }\n\n  saveBackup() {\n    this.majorDataChangeHandler && this.majorDataChangeHandler();\n  }\n\n  getApplicationDataPath() {\n    console.assert(this.applicationDataPath, \"applicationDataPath is null\");\n    return this.applicationDataPath;\n  }\n\n  /*\n    Sending a component in its raw state is really slow for the desktop app\n    Keys are not passed into ItemParams, so the result is not encrypted\n   */\n  async convertComponentForTransmission(component) {\n    return new SFItemParams(component).paramsForExportFile(true);\n  }\n\n  // All `components` should be installed\n  syncComponentsInstallation(components) {\n    if(!this.isDesktop) return;\n\n    Promise.all(components.map((component) => {\n      return this.convertComponentForTransmission(component);\n    })).then((data) => {\n      this.installationSyncHandler(data);\n    })\n  }\n\n  async installComponent(component) {\n    this.installComponentHandler(await this.convertComponentForTransmission(component));\n  }\n\n  registerUpdateObserver(callback) {\n    var observer = {id: Math.random, callback: callback};\n    this.updateObservers.push(observer);\n    return observer;\n  }\n\n  searchText(text) {\n    if(!this.isDesktop) {\n      return;\n    }\n    this.lastSearchedText = text;\n    this.searchHandler(text);\n  }\n\n  redoSearch()  {\n    if(this.lastSearchedText) {\n      this.searchText(this.lastSearchedText);\n    }\n  }\n\n\n  deregisterUpdateObserver(observer) {\n    _.pull(this.updateObservers, observer);\n  }\n\n  // Pass null to cancel search\n  desktop_setSearchHandler(handler) {\n    this.searchHandler = handler;\n  }\n\n  desktop_windowGainedFocus() {\n    this.$rootScope.$broadcast(\"window-gained-focus\");\n  }\n\n  desktop_windowLostFocus() {\n    this.$rootScope.$broadcast(\"window-lost-focus\");\n  }\n\n  desktop_onComponentInstallationComplete(componentData, error) {\n    // console.log(\"Web|Component Installation/Update Complete\", componentData, error);\n\n    // Desktop is only allowed to change these keys:\n    let permissableKeys = [\"package_info\", \"local_url\"];\n    var component = this.modelManager.findItem(componentData.uuid);\n\n    if(!component) {\n      console.error(\"desktop_onComponentInstallationComplete component is null for uuid\", componentData.uuid);\n      return;\n    }\n\n    if(error) {\n      component.setAppDataItem(\"installError\", error);\n    } else {\n      for(var key of permissableKeys) {\n        component[key] = componentData.content[key];\n      }\n      this.modelManager.notifySyncObserversOfModels([component], SFModelManager.MappingSourceDesktopInstalled);\n      component.setAppDataItem(\"installError\", null);\n    }\n\n    this.modelManager.setItemDirty(component, true);\n    this.syncManager.sync();\n\n    this.timeout(() => {\n      for(var observer of this.updateObservers) {\n        observer.callback(component);\n      }\n    });\n  }\n\n  desktop_registerComponentActivationObserver(callback) {\n    var observer = {id: Math.random, callback: callback};\n    this.componentActivationObservers.push(observer);\n    return observer;\n  }\n\n  desktop_deregisterComponentActivationObserver(observer) {\n    _.pull(this.componentActivationObservers, observer);\n  }\n\n  /* Notify observers that a component has been registered/activated */\n  async notifyComponentActivation(component) {\n    var serializedComponent = await this.convertComponentForTransmission(component);\n\n    this.timeout(() => {\n      for(var observer of this.componentActivationObservers) {\n        observer.callback(serializedComponent);\n      }\n    });\n  }\n\n  /* Used to resolve \"sn://\" */\n  desktop_setApplicationDataPath(path) {\n    this.applicationDataPath = path;\n  }\n\n  desktop_setComponentInstallationSyncHandler(handler) {\n    this.installationSyncHandler = handler;\n  }\n\n  desktop_setInstallComponentHandler(handler) {\n    this.installComponentHandler = handler;\n  }\n\n  desktop_setInitialDataLoadHandler(handler) {\n    this.dataLoadHandler = handler;\n    if(this.dataLoaded) {\n      this.dataLoadHandler();\n    }\n  }\n\n  async desktop_requestBackupFile(callback) {\n    var keys, authParams;\n    if(this.authManager.offline() && this.passcodeManager.hasPasscode()) {\n      keys = this.passcodeManager.keys();\n      authParams = this.passcodeManager.passcodeAuthParams();\n    } else {\n      keys = await this.authManager.keys();\n      authParams = await this.authManager.getAuthParams();\n    }\n\n    this.modelManager.getAllItemsJSONData(\n      keys,\n      authParams,\n      true /* return null on empty */\n    ).then((data) => {\n      callback(data);\n    })\n  }\n\n  desktop_setMajorDataChangeHandler(handler) {\n    this.majorDataChangeHandler = handler;\n  }\n\n  desktop_didBeginBackup() {\n    this.$rootScope.$broadcast(\"did-begin-local-backup\");\n  }\n\n  desktop_didFinishBackup(success) {\n    this.$rootScope.$broadcast(\"did-finish-local-backup\", {success: success});\n  }\n}\n\nangular.module('app').service('desktopManager', DesktopManager);\n;class HttpManager extends SFHttpManager {\n\n  constructor(storageManager, $timeout) {\n    // calling callbacks in a $timeout allows UI to update\n    super($timeout);\n\n    this.setJWTRequestHandler(async () => {\n      return storageManager.getItem(\"jwt\");\n    })\n  }\n}\n\nangular.module('app').service('httpManager', HttpManager);\n;class KeyboardManager {\n\n  constructor() {\n    this.observers = [];\n\n    KeyboardManager.KeyTab = \"Tab\";\n    KeyboardManager.KeyBackspace = \"Backspace\";\n    KeyboardManager.KeyUp = \"ArrowUp\";\n    KeyboardManager.KeyDown = \"ArrowDown\";\n\n    KeyboardManager.KeyModifierShift = \"Shift\";\n    KeyboardManager.KeyModifierCtrl = \"Control\";\n    // ⌘ key on Mac, ⊞ key on Windows\n    KeyboardManager.KeyModifierMeta = \"Meta\";\n    KeyboardManager.KeyModifierAlt = \"Alt\";\n\n    KeyboardManager.KeyEventDown = \"KeyEventDown\";\n    KeyboardManager.KeyEventUp = \"KeyEventUp\";\n\n    KeyboardManager.AllModifiers = [\n      KeyboardManager.KeyModifierShift,\n      KeyboardManager.KeyModifierCtrl,\n      KeyboardManager.KeyModifierMeta,\n      KeyboardManager.KeyModifierAlt\n    ]\n\n    window.addEventListener('keydown', this.handleKeyDown.bind(this));\n    window.addEventListener('keyup', this.handleKeyUp.bind(this));\n  }\n\n  modifiersForEvent(event) {\n    let eventModifiers = KeyboardManager.AllModifiers.filter((modifier) => {\n      // For a modifier like ctrlKey, must check both event.ctrlKey and event.key.\n      // That's because on keyup, event.ctrlKey would be false, but event.key == Control would be true.\n      let matches = (\n        ((event.ctrlKey || event.key == KeyboardManager.KeyModifierCtrl) && modifier === KeyboardManager.KeyModifierCtrl) ||\n        ((event.metaKey || event.key == KeyboardManager.KeyModifierMeta) && modifier === KeyboardManager.KeyModifierMeta) ||\n        ((event.altKey || event.key == KeyboardManager.KeyModifierAlt) && modifier === KeyboardManager.KeyModifierAlt) ||\n        ((event.shiftKey || event.key == KeyboardManager.KeyModifierShift) && modifier === KeyboardManager.KeyModifierShift)\n      )\n\n      return matches;\n    })\n\n    return eventModifiers;\n  }\n\n  eventMatchesKeyAndModifiers(event, key, modifiers = [])  {\n    let eventModifiers = this.modifiersForEvent(event);\n\n    if(eventModifiers.length != modifiers.length) {\n      return false;\n    }\n\n    for(let modifier of modifiers) {\n      if(!eventModifiers.includes(modifier)) {\n        return false;\n      }\n    }\n\n    // Modifers match, check key\n    if(!key) {\n      return true;\n    }\n\n    // In the browser, shift + f results in key 'f', but in Electron, shift + f results in 'F'\n    // In our case we don't differentiate between the two.\n    return key.toLowerCase() == event.key.toLowerCase();\n  }\n\n  notifyObserver(event, keyEventType) {\n    for(let observer of this.observers) {\n      if(observer.element && event.target != observer.element) {\n        continue;\n      }\n\n      if(observer.elements && !observer.elements.includes(event.target)) {\n        continue;\n      }\n\n      if(observer.notElement && observer.notElement == event.target) {\n        continue;\n      }\n\n      if(observer.notElementIds && observer.notElementIds.includes(event.target.id)) {\n        continue;\n      }\n\n      if(this.eventMatchesKeyAndModifiers(event, observer.key, observer.modifiers)) {\n        let callback = keyEventType == KeyboardManager.KeyEventDown ? observer.onKeyDown : observer.onKeyUp;\n        if(callback) {\n          callback(event);\n        }\n      }\n    }\n  }\n\n  handleKeyDown(event) {\n    this.notifyObserver(event, KeyboardManager.KeyEventDown);\n  }\n\n  handleKeyUp(event) {\n    this.notifyObserver(event, KeyboardManager.KeyEventUp);\n  }\n\n  addKeyObserver({key, modifiers, onKeyDown, onKeyUp, element, elements, notElement, notElementIds}) {\n    let observer = {key, modifiers, onKeyDown, onKeyUp, element, elements, notElement, notElementIds};\n    this.observers.push(observer);\n    return observer;\n  }\n\n  removeKeyObserver(observer) {\n    this.observers.splice(this.observers.indexOf(observer), 1);\n  }\n}\n\nangular.module('app').service('keyboardManager', KeyboardManager);\n;class MigrationManager extends SFMigrationManager {\n\n  constructor($rootScope, modelManager, syncManager, componentManager, storageManager, statusManager, authManager, desktopManager) {\n    super(modelManager, syncManager, storageManager, authManager);\n    this.componentManager = componentManager;\n    this.statusManager = statusManager;\n    this.desktopManager = desktopManager;\n  }\n\n  registeredMigrations() {\n    return [\n      this.editorToComponentMigration(),\n      this.componentUrlToHostedUrl(),\n      this.removeTagReferencesFromNotes()\n    ];\n  }\n\n  /*\n  Migrate SN|Editor to SN|Component. Editors are deprecated as of November 2017. Editors using old APIs must\n  convert to using the new component API.\n  */\n\n  editorToComponentMigration() {\n    return {\n      name: \"editor-to-component\",\n      content_type: \"SN|Editor\",\n      handler: async (editors) => {\n        // Convert editors to components\n        for(var editor of editors) {\n          // If there's already a component for this url, then skip this editor\n          if(editor.url && !this.componentManager.componentForUrl(editor.url)) {\n            var component = this.modelManager.createItem({\n              content_type: \"SN|Component\",\n              content: {\n                url: editor.url,\n                name: editor.name,\n                area: \"editor-editor\"\n              }\n            })\n            component.setAppDataItem(\"data\", editor.data);\n            this.modelManager.addItem(component);\n            this.modelManager.setItemDirty(component, true);\n          }\n        }\n\n        for(let editor of editors) {\n          this.modelManager.setItemToBeDeleted(editor);\n        }\n\n        this.syncManager.sync();\n      }\n    }\n  }\n\n  /*\n  Migrate component.url fields to component.hosted_url. This involves rewriting any note data that relied on the\n  component.url value to store clientData, such as the CodeEditor, which stores the programming language for the note\n  in the note's clientData[component.url]. We want to rewrite any matching items to transfer that clientData into\n  clientData[component.uuid].\n\n  April 3, 2019 note: it seems this migration is mis-named. The first part of the description doesn't match what the code is actually doing.\n  It has nothing to do with url/hosted_url relationship and more to do with just mapping client data from the note's hosted_url to its uuid\n\n  Created: July 6, 2018\n  */\n  componentUrlToHostedUrl() {\n    return {\n      name: \"component-url-to-hosted-url\",\n      content_type: \"SN|Component\",\n      handler: async (components) => {\n        let hasChanges = false;\n        let notes = this.modelManager.validItemsForContentType(\"Note\");\n        for(let note of notes) {\n          for(let component of components) {\n            let clientData = note.getDomainDataItem(component.hosted_url, ComponentManager.ClientDataDomain);\n            if(clientData) {\n              note.setDomainDataItem(component.uuid, clientData, ComponentManager.ClientDataDomain);\n              note.setDomainDataItem(component.hosted_url, null, ComponentManager.ClientDataDomain);\n              this.modelManager.setItemDirty(note, true);\n              hasChanges = true;\n            }\n          }\n        }\n\n        if(hasChanges) {\n          this.syncManager.sync();\n        }\n      }\n    }\n  }\n\n\n\n  /*\n  Migrate notes which have relationships on tags to migrate those relationships to the tags themselves.\n  That is, notes.content.references should not include any mention of tags.\n  This will apply to notes created before the schema change. Now, only tags reference notes.\n  Created: April 3, 2019\n  */\n  removeTagReferencesFromNotes() {\n    return {\n      name: \"remove-tag-references-from-notes\",\n      content_type: \"Note\",\n      handler: async (notes) => {\n\n        let needsSync = false;\n        let status = this.statusManager.addStatusFromString(\"Optimizing data...\");\n        let dirtyCount = 0;\n\n        for(let note of notes) {\n          if(!note.content) {\n            continue;\n          }\n\n          let references = note.content.references;\n          // Remove any tag references, and transfer them to the tag if neccessary.\n          let newReferences = [];\n\n          for(let reference of references)  {\n            if(reference.content_type != \"Tag\") {\n              newReferences.push(reference);\n              continue;\n            }\n\n            // is Tag content_type, we will not be adding this to newReferences\n            let tag = this.modelManager.findItem(reference.uuid);\n            if(tag && !tag.hasRelationshipWithItem(note)) {\n              tag.addItemAsRelationship(note);\n              this.modelManager.setItemDirty(tag, true);\n              dirtyCount++;\n            }\n          }\n\n          if(newReferences.length != references.length) {\n            note.content.references = newReferences;\n            this.modelManager.setItemDirty(note, true);\n            dirtyCount++;\n          }\n        }\n\n        if(dirtyCount > 0) {\n          if(isDesktopApplication()) {\n            this.desktopManager.saveBackup();\n          }\n\n          status = this.statusManager.replaceStatusWithString(status, `${dirtyCount} items optimized.`);\n          await this.syncManager.sync();\n\n          status = this.statusManager.replaceStatusWithString(status, `Optimization complete.`);\n          setTimeout(() => {\n            this.statusManager.removeStatus(status);\n          }, 2000);\n        } else {\n          this.statusManager.removeStatus(status);\n        }\n      }\n    }\n  }\n}\n\nangular.module('app').service('migrationManager', MigrationManager);\n;SFModelManager.ContentTypeClassMapping = {\n  \"Note\" : SNNote,\n  \"Tag\" : SNTag,\n  \"SN|SmartTag\" : SNSmartTag,\n  \"Extension\" : SNExtension,\n  \"SN|Editor\" : SNEditor,\n  \"SN|Theme\" : SNTheme,\n  \"SN|Component\" : SNComponent,\n  \"SF|Extension\" : SNServerExtension,\n  \"SF|MFA\" : SNMfa,\n  \"SN|Privileges\" : SFPrivileges\n};\n\nSFItem.AppDomain = \"org.standardnotes.sn\";\n\nclass ModelManager extends SFModelManager {\n\n  constructor(storageManager, $timeout) {\n    super($timeout);\n    this.notes = [];\n    this.tags = [];\n    this.components = [];\n\n    this.storageManager = storageManager;\n\n    this.buildSystemSmartTags();\n  }\n\n  handleSignout() {\n    super.handleSignout();\n    this.notes.length = 0;\n    this.tags.length = 0;\n    this.components.length = 0;\n  }\n\n  noteCount() {\n    return this.notes.filter((n) => !n.dummy).length;\n  }\n\n  removeAllItemsFromMemory() {\n    for(var item of this.items) {\n      item.deleted = true;\n    }\n    this.notifySyncObserversOfModels(this.items);\n    this.handleSignout();\n  }\n\n  findOrCreateTagByTitle(title) {\n    var tag = _.find(this.tags, {title: title})\n    if(!tag) {\n      tag = this.createItem({content_type: \"Tag\", content: {title: title}});\n      this.addItem(tag);\n      this.setItemDirty(tag, true);\n    }\n    return tag;\n  }\n\n  addItems(items, globalOnly = false) {\n    super.addItems(items, globalOnly);\n\n    items.forEach((item) => {\n      // In some cases, you just want to add the item to this.items, and not to the individual arrays\n      // This applies when you want to keep an item syncable, but not display it via the individual arrays\n      if(!globalOnly) {\n        if(item.content_type == \"Tag\") {\n          if(!_.find(this.tags, {uuid: item.uuid})) {\n            this.tags.splice(_.sortedIndexBy(this.tags, item, function(item){\n              if (item.title) return item.title.toLowerCase();\n              else return ''\n            }), 0, item);\n          }\n        } else if(item.content_type == \"Note\") {\n          if(!_.find(this.notes, {uuid: item.uuid})) {\n            this.notes.unshift(item);\n          }\n        } else if(item.content_type == \"SN|Component\") {\n          if(!_.find(this.components, {uuid: item.uuid})) {\n            this.components.unshift(item);\n          }\n        }\n      }\n    });\n  }\n\n  resortTag(tag) {\n    _.pull(this.tags, tag);\n    this.tags.splice(_.sortedIndexBy(this.tags, tag, function(tag){\n      if (tag.title) return tag.title.toLowerCase();\n      else return ''\n    }), 0, tag);\n  }\n\n  setItemToBeDeleted(item) {\n    super.setItemToBeDeleted(item);\n\n    // remove from relevant array, but don't remove from all items.\n    // This way, it's removed from the display, but still synced via get dirty items\n    this.removeItemFromRespectiveArray(item);\n  }\n\n  removeItemLocally(item, callback) {\n    super.removeItemLocally(item, callback);\n\n    this.removeItemFromRespectiveArray(item);\n\n    this.storageManager.deleteModel(item).then(callback);\n  }\n\n  removeItemFromRespectiveArray(item) {\n    if(item.content_type == \"Tag\") {\n      _.remove(this.tags, {uuid: item.uuid});\n    } else if(item.content_type == \"Note\") {\n      _.remove(this.notes, {uuid: item.uuid});\n    } else if(item.content_type == \"SN|Component\") {\n      _.remove(this.components, {uuid: item.uuid});\n    }\n  }\n\n  notesMatchingSmartTag(tag) {\n    let contentTypePredicate = new SFPredicate(\"content_type\", \"=\", \"Note\");\n    let predicates = [contentTypePredicate, tag.content.predicate];\n    if(!tag.content.isTrashTag) {\n      let notTrashedPredicate = new SFPredicate(\"content.trashed\", \"=\", false);\n      predicates.push(notTrashedPredicate);\n    }\n    let results = this.itemsMatchingPredicates(predicates);\n    return results;\n  }\n\n  trashSmartTag() {\n    return this.systemSmartTags.find((tag) => tag.content.isTrashTag);\n  }\n\n  trashedItems() {\n    return this.notesMatchingSmartTag(this.trashSmartTag());\n  }\n\n  emptyTrash() {\n    let notes = this.trashedItems();\n    for(let note of notes) {\n      this.setItemToBeDeleted(note);\n    }\n  }\n\n  buildSystemSmartTags() {\n    this.systemSmartTags = SNSmartTag.systemSmartTags();\n  }\n\n  getSmartTagWithId(id) {\n    return this.getSmartTags().find((candidate) => candidate.uuid == id);\n  }\n\n  getSmartTags() {\n    let userTags = this.validItemsForContentType(\"SN|SmartTag\").sort((a, b) => {\n      return a.content.title < b.content.title ? -1 : 1;\n    });\n    return this.systemSmartTags.concat(userTags);\n  }\n\n  /*\n  Misc\n  */\n\n  humanReadableDisplayForContentType(contentType) {\n    return {\n      \"Note\" : \"note\",\n      \"Tag\" : \"tag\",\n      \"SN|SmartTag\": \"smart tag\",\n      \"Extension\" : \"action-based extension\",\n      \"SN|Component\" : \"component\",\n      \"SN|Editor\" : \"editor\",\n      \"SN|Theme\" : \"theme\",\n      \"SF|Extension\" : \"server extension\",\n      \"SF|MFA\" : \"two-factor authentication setting\",\n      \"SN|FileSafe|Credentials\": \"FileSafe credential\",\n      \"SN|FileSafe|FileMetadata\": \"FileSafe file\",\n      \"SN|FileSafe|Integration\": \"FileSafe integration\"\n    }[contentType];\n  }\n\n}\n\nangular.module('app').service('modelManager', ModelManager);\n;/* A class for handling installation of system extensions */\n\nclass NativeExtManager {\n\n  constructor(modelManager, syncManager, singletonManager) {\n    this.modelManager = modelManager;\n    this.syncManager = syncManager;\n    this.singletonManager = singletonManager;\n\n    this.extensionsManagerIdentifier = \"org.standardnotes.extensions-manager\";\n    this.batchManagerIdentifier = \"org.standardnotes.batch-manager\";\n    this.systemExtensions = [];\n\n    this.resolveExtensionsManager();\n    this.resolveBatchManager();\n  }\n\n  isSystemExtension(extension) {\n    return this.systemExtensions.includes(extension.uuid);\n  }\n\n  resolveExtensionsManager() {\n\n    let contentTypePredicate = new SFPredicate(\"content_type\", \"=\", \"SN|Component\");\n    let packagePredicate = new SFPredicate(\"package_info.identifier\", \"=\", this.extensionsManagerIdentifier);\n\n    this.singletonManager.registerSingleton([contentTypePredicate, packagePredicate], (resolvedSingleton) => {\n      // Resolved Singleton\n      this.systemExtensions.push(resolvedSingleton.uuid);\n\n      var needsSync = false;\n      if(isDesktopApplication()) {\n        if(!resolvedSingleton.local_url) {\n          resolvedSingleton.local_url = window._extensions_manager_location;\n          needsSync = true;\n        }\n      } else {\n        if(!resolvedSingleton.hosted_url) {\n          resolvedSingleton.hosted_url = window._extensions_manager_location;\n          needsSync = true;\n        }\n      }\n\n      // Handle addition of SN|ExtensionRepo permission\n      let permission = resolvedSingleton.content.permissions.find((p) => p.name == \"stream-items\");\n      if(!permission.content_types.includes(\"SN|ExtensionRepo\")) {\n        permission.content_types.push(\"SN|ExtensionRepo\");\n        needsSync = true;\n      }\n\n      if(needsSync) {\n        this.modelManager.setItemDirty(resolvedSingleton, true);\n        this.syncManager.sync();\n      }\n    }, (valueCallback) => {\n      // Safe to create. Create and return object.\n      let url = window._extensions_manager_location;\n      // console.log(\"Installing Extensions Manager from URL\", url);\n      if(!url) {\n        console.error(\"window._extensions_manager_location must be set.\");\n        return;\n      }\n\n      let packageInfo = {\n        name: \"Extensions\",\n        identifier: this.extensionsManagerIdentifier\n      }\n\n      var item = {\n        content_type: \"SN|Component\",\n        content: {\n          name: packageInfo.name,\n          area: \"rooms\",\n          package_info: packageInfo,\n          permissions: [\n            {\n              name: \"stream-items\",\n              content_types: [\n                \"SN|Component\", \"SN|Theme\", \"SF|Extension\",\n                \"Extension\", \"SF|MFA\", \"SN|Editor\", \"SN|ExtensionRepo\"\n              ]\n            }\n          ]\n        }\n      }\n\n      if(isDesktopApplication()) {\n        item.content.local_url = window._extensions_manager_location;\n      } else {\n        item.content.hosted_url = window._extensions_manager_location;\n      }\n\n      var component = this.modelManager.createItem(item);\n      this.modelManager.addItem(component);\n\n      this.modelManager.setItemDirty(component, true);\n      this.syncManager.sync();\n\n      this.systemExtensions.push(component.uuid);\n\n      valueCallback(component);\n    });\n  }\n\n  resolveBatchManager() {\n\n    let contentTypePredicate = new SFPredicate(\"content_type\", \"=\", \"SN|Component\");\n    let packagePredicate = new SFPredicate(\"package_info.identifier\", \"=\", this.batchManagerIdentifier);\n\n    this.singletonManager.registerSingleton([contentTypePredicate, packagePredicate], (resolvedSingleton) => {\n      // Resolved Singleton\n      this.systemExtensions.push(resolvedSingleton.uuid);\n\n      var needsSync = false;\n      if(isDesktopApplication()) {\n        if(!resolvedSingleton.local_url) {\n          resolvedSingleton.local_url = window._batch_manager_location;\n          needsSync = true;\n        }\n      } else {\n        if(!resolvedSingleton.hosted_url) {\n          resolvedSingleton.hosted_url = window._batch_manager_location;\n          needsSync = true;\n        }\n      }\n\n      if(needsSync) {\n        this.modelManager.setItemDirty(resolvedSingleton, true);\n        this.syncManager.sync();\n      }\n    }, (valueCallback) => {\n      // Safe to create. Create and return object.\n      let url = window._batch_manager_location;\n      // console.log(\"Installing Batch Manager from URL\", url);\n      if(!url) {\n        console.error(\"window._batch_manager_location must be set.\");\n        return;\n      }\n\n      let packageInfo = {\n        name: \"Batch Manager\",\n        identifier: this.batchManagerIdentifier\n      }\n\n      var item = {\n        content_type: \"SN|Component\",\n        content: {\n          name: packageInfo.name,\n          area: \"modal\",\n          package_info: packageInfo,\n          permissions: [\n            {\n              name: \"stream-items\",\n              content_types: [\n                \"Note\", \"Tag\", \"SN|SmartTag\",\n                \"SN|Component\", \"SN|Theme\", \"SN|UserPreferences\",\n                \"SF|Extension\", \"Extension\", \"SF|MFA\", \"SN|Editor\",\n                \"SN|FileSafe|Credentials\", \"SN|FileSafe|FileMetadata\", \"SN|FileSafe|Integration\"\n              ]\n            }\n          ]\n        }\n      }\n\n      if(isDesktopApplication()) {\n        item.content.local_url = window._batch_manager_location;\n      } else {\n        item.content.hosted_url = window._batch_manager_location;\n      }\n\n      var component = this.modelManager.createItem(item);\n      this.modelManager.addItem(component);\n\n      this.modelManager.setItemDirty(component, true);\n      this.syncManager.sync();\n\n      this.systemExtensions.push(component.uuid);\n\n      valueCallback(component);\n    });\n  }\n}\n\nangular.module('app').service('nativeExtManager', NativeExtManager);\n;const MillisecondsPerSecond = 1000;\n\nclass PasscodeManager {\n\n    constructor($rootScope, authManager, storageManager, syncManager) {\n      this.authManager = authManager;\n      this.storageManager = storageManager;\n      this.syncManager = syncManager;\n      this.$rootScope = $rootScope;\n\n      this._hasPasscode = this.storageManager.getItemSync(\"offlineParams\", StorageManager.Fixed) != null;\n      this._locked = this._hasPasscode;\n\n      this.visibilityObservers = [];\n      this.passcodeChangeObservers = [];\n\n      this.configureAutoLock();\n    }\n\n    addPasscodeChangeObserver(callback) {\n      this.passcodeChangeObservers.push(callback);\n    }\n\n    lockApplication() {\n      window.location.reload();\n      this.cancelAutoLockTimer();\n    }\n\n    isLocked() {\n      return this._locked;\n    }\n\n    hasPasscode() {\n      return this._hasPasscode;\n    }\n\n    keys() {\n      return this._keys;\n    }\n\n    addVisibilityObserver(callback) {\n      this.visibilityObservers.push(callback);\n      return callback;\n    }\n\n    removeVisibilityObserver(callback) {\n      _.pull(this.visibilityObservers, callback);\n    }\n\n    notifiyVisibilityObservers(visible) {\n      for(let callback of this.visibilityObservers)  {\n        callback(visible);\n      }\n    }\n\n    async setAutoLockInterval(interval) {\n      return this.storageManager.setItem(PasscodeManager.AutoLockIntervalKey, JSON.stringify(interval), StorageManager.FixedEncrypted);\n    }\n\n    async getAutoLockInterval() {\n      let interval = await this.storageManager.getItem(PasscodeManager.AutoLockIntervalKey, StorageManager.FixedEncrypted);\n      if(interval) {\n        return JSON.parse(interval);\n      } else {\n        return PasscodeManager.AutoLockIntervalNone;\n      }\n    }\n\n    passcodeAuthParams() {\n      var authParams = JSON.parse(this.storageManager.getItemSync(\"offlineParams\", StorageManager.Fixed));\n      if(authParams && !authParams.version) {\n        var keys = this.keys();\n        if(keys && keys.ak) {\n          // If there's no version stored, and there's an ak, it has to be 002. Newer versions would have their version stored in authParams.\n          authParams.version = \"002\";\n        } else {\n          authParams.version = \"001\";\n        }\n      }\n      return authParams;\n    }\n\n    async verifyPasscode(passcode) {\n      return new Promise(async (resolve, reject) => {\n        var params = this.passcodeAuthParams();\n        let keys = await SFJS.crypto.computeEncryptionKeysForUser(passcode, params);\n        if(keys.pw !== params.hash) {\n          resolve(false);\n        } else {\n          resolve(true);\n        }\n      })\n    }\n\n    unlock(passcode, callback) {\n      var params = this.passcodeAuthParams();\n      SFJS.crypto.computeEncryptionKeysForUser(passcode, params).then((keys) => {\n        if(keys.pw !== params.hash) {\n          callback(false);\n          return;\n        }\n\n        this._keys = keys;\n        this._authParams = params;\n        this.decryptLocalStorage(keys, params).then(() => {\n          this._locked = false;\n          callback(true);\n        })\n      });\n    }\n\n    setPasscode(passcode, callback) {\n      var uuid = SFJS.crypto.generateUUIDSync();\n\n      SFJS.crypto.generateInitialKeysAndAuthParamsForUser(uuid, passcode).then((results) => {\n        let keys = results.keys;\n        let authParams = results.authParams;\n\n        authParams.hash = keys.pw;\n        this._keys = keys;\n        this._hasPasscode = true;\n        this._authParams = authParams;\n\n        // Encrypting will initially clear localStorage\n        this.encryptLocalStorage(keys, authParams);\n\n        // After it's cleared, it's safe to write to it\n        this.storageManager.setItem(\"offlineParams\", JSON.stringify(authParams), StorageManager.Fixed);\n        callback(true);\n\n        this.notifyObserversOfPasscodeChange();\n      });\n    }\n\n    changePasscode(newPasscode, callback) {\n      this.setPasscode(newPasscode, callback);\n    }\n\n    clearPasscode() {\n      this.storageManager.setItemsMode(this.authManager.isEphemeralSession() ? StorageManager.Ephemeral : StorageManager.Fixed); // Transfer from Ephemeral\n      this.storageManager.removeItem(\"offlineParams\", StorageManager.Fixed);\n      this._keys = null;\n      this._hasPasscode = false;\n\n      this.notifyObserversOfPasscodeChange();\n    }\n\n    notifyObserversOfPasscodeChange() {\n      for(var observer of this.passcodeChangeObservers) {\n        observer();\n      }\n    }\n\n    encryptLocalStorage(keys, authParams) {\n      this.storageManager.setKeys(keys, authParams);\n      // Switch to Ephemeral storage, wiping Fixed storage\n      // Last argument is `force`, which we set to true because in the case of changing passcode\n      this.storageManager.setItemsMode(this.authManager.isEphemeralSession() ? StorageManager.Ephemeral : StorageManager.FixedEncrypted, true);\n    }\n\n    async decryptLocalStorage(keys, authParams) {\n      this.storageManager.setKeys(keys, authParams);\n      return this.storageManager.decryptStorage();\n    }\n\n    configureAutoLock() {\n      if(isDesktopApplication()) {\n        // desktop only\n        this.$rootScope.$on(\"window-lost-focus\", () => {\n          this.documentVisibilityChanged(false);\n        })\n        this.$rootScope.$on(\"window-gained-focus\", () => {\n          this.documentVisibilityChanged(true);\n        })\n      } else {\n        // tab visibility listender, web only\n        document.addEventListener('visibilitychange', (e) => {\n          let visible = document.visibilityState == \"visible\";\n          this.documentVisibilityChanged(visible);\n        });\n      }\n\n      PasscodeManager.AutoLockIntervalNone = 0;\n      PasscodeManager.AutoLockIntervalImmediate = 1;\n      PasscodeManager.AutoLockIntervalOneMinute = 60 * MillisecondsPerSecond;\n      PasscodeManager.AutoLockIntervalFiveMinutes = 300 * MillisecondsPerSecond;\n      PasscodeManager.AutoLockIntervalOneHour = 3600 * MillisecondsPerSecond;\n\n      PasscodeManager.AutoLockIntervalKey = \"AutoLockIntervalKey\";\n    }\n\n    getAutoLockIntervalOptions() {\n      return [\n        {\n          value: PasscodeManager.AutoLockIntervalNone,\n          label: \"Off\"\n        },\n        {\n          value: PasscodeManager.AutoLockIntervalImmediate,\n          label: \"Immediately\"\n        },\n        {\n          value: PasscodeManager.AutoLockIntervalOneMinute,\n          label: \"1m\"\n        },\n        {\n          value: PasscodeManager.AutoLockIntervalFiveMinutes,\n          label: \"5m\"\n        },\n        {\n          value: PasscodeManager.AutoLockIntervalOneHour,\n          label: \"1h\"\n        }\n      ]\n    }\n\n    documentVisibilityChanged(visible) {\n      if(visible) {\n        // check to see if lockAfterDate is not null, and if the application isn't locked.\n        // if that's the case, it needs to be locked immediately.\n        if(this.lockAfterDate && new Date() > this.lockAfterDate && !this.isLocked()) {\n          this.lockApplication();\n        } else {\n          if(!this.isLocked()) {\n            this.syncManager.sync();\n          }\n        }\n        this.cancelAutoLockTimer();\n      } else {\n        this.beginAutoLockTimer();\n      }\n\n      this.notifiyVisibilityObservers(visible);\n    }\n\n    async beginAutoLockTimer() {\n      var interval = await this.getAutoLockInterval();\n      if(interval == PasscodeManager.AutoLockIntervalNone) {\n        return;\n      }\n\n      // Use a timeout if possible, but if the computer is put to sleep, timeouts won't work.\n      // Need to set a date as backup. this.lockAfterDate does not need to be persisted, as\n      // living in memory seems sufficient. If memory is cleared, then the application will lock anyway.\n      let addToNow = (seconds) => {\n        let date = new Date();\n        date.setSeconds(date.getSeconds() + seconds);\n        return date;\n      }\n\n      this.lockAfterDate = addToNow(interval / MillisecondsPerSecond);\n      this.lockTimeout = setTimeout(() => {\n        this.lockApplication();\n        // We don't need to look at this anymore since we've succeeded with timeout lock\n        this.lockAfterDate = null;\n      }, interval);\n    }\n\n    cancelAutoLockTimer() {\n      clearTimeout(this.lockTimeout);\n      this.lockAfterDate = null;\n    }\n}\n\nangular.module('app').service('passcodeManager', PasscodeManager);\n;class PrivilegesManager extends SFPrivilegesManager {\n\n  constructor(passcodeManager, authManager, syncManager, singletonManager, modelManager, storageManager, $rootScope, $compile) {\n    super(modelManager, syncManager, singletonManager);\n\n    this.$rootScope = $rootScope;\n    this.$compile = $compile;\n\n    this.setDelegate({\n      isOffline: async () => {\n        return authManager.offline();\n      },\n      hasLocalPasscode: async () => {\n        return passcodeManager.hasPasscode();\n      },\n      saveToStorage: async (key, value) => {\n        return storageManager.setItem(key, value, storageManager.bestStorageMode());\n      },\n      getFromStorage: async (key) => {\n        return storageManager.getItem(key, storageManager.bestStorageMode());\n      },\n      verifyAccountPassword: async (password) => {\n        return authManager.verifyAccountPassword(password);\n      },\n      verifyLocalPasscode: async (passcode) => {\n        return passcodeManager.verifyPasscode(passcode);\n      },\n    });\n  }\n\n  presentPrivilegesModal(action, onSuccess, onCancel) {\n    if(this.authenticationInProgress()) {\n      onCancel && onCancel();\n      return;\n    }\n\n    let customSuccess = () => {\n      onSuccess && onSuccess();\n      this.currentAuthenticationElement = null;\n    }\n\n    let customCancel = () => {\n      onCancel && onCancel();\n      this.currentAuthenticationElement = null;\n    }\n\n    var scope = this.$rootScope.$new(true);\n    scope.action = action;\n    scope.onSuccess = customSuccess;\n    scope.onCancel = customCancel;\n    var el = this.$compile( \"<privileges-auth-modal action='action' on-success='onSuccess' on-cancel='onCancel' class='sk-modal'></privileges-auth-modal>\" )(scope);\n    angular.element(document.body).append(el);\n\n    this.currentAuthenticationElement = el;\n  }\n\n  presentPrivilegesManagementModal() {\n    var scope = this.$rootScope.$new(true);\n    var el = this.$compile( \"<privileges-management-modal class='sk-modal'></privileges-management-modal>\")(scope);\n    angular.element(document.body).append(el);\n  }\n\n  authenticationInProgress() {\n    return this.currentAuthenticationElement != null;\n  }\n\n}\n\nangular.module('app').service('privilegesManager', PrivilegesManager);\n;class SessionHistory extends SFSessionHistoryManager {\n\n  constructor(modelManager, storageManager, authManager, passcodeManager, $timeout) {\n\n    SFItemHistory.HistoryEntryClassMapping = {\n      \"Note\" : NoteHistoryEntry\n    }\n\n    // Session History can be encrypted with passcode keys. If it changes, we need to resave session\n    // history with the new keys.\n    passcodeManager.addPasscodeChangeObserver(() => {\n      this.saveToDisk();\n    })\n\n    var keyRequestHandler = async () => {\n      let offline = authManager.offline();\n      let auth_params = offline ? passcodeManager.passcodeAuthParams() : await authManager.getAuthParams();\n      let keys = offline ? passcodeManager.keys() : await authManager.keys();\n\n      return {\n        keys: keys,\n        offline: offline,\n        auth_params: auth_params\n      }\n    }\n\n    var contentTypes = [\"Note\"];\n    super(modelManager, storageManager, keyRequestHandler, contentTypes, $timeout);\n  }\n}\n\nangular.module('app').service('sessionHistory', SessionHistory);\n;class SingletonManager extends SFSingletonManager {\n\n  constructor(modelManager, syncManager) {\n    super(modelManager, syncManager);\n  }\n}\n\nangular.module('app').service('singletonManager', SingletonManager);\n;class StatusManager {\n\n  constructor() {\n    this.statuses = [];\n    this.observers = [];\n  }\n\n  statusFromString(string) {\n    return {string: string};\n  }\n\n  replaceStatusWithString(status, string) {\n    this.removeStatus(status);\n    return this.addStatusFromString(string);\n  }\n\n  addStatusFromString(string) {\n    return this.addStatus(this.statusFromString(string));\n  }\n\n  addStatus(status) {\n    if(typeof status !== \"object\") {\n      console.error(\"Attempting to set non-object status\", status);\n      return;\n    }\n\n    this.statuses.push(status);\n    this.notifyObservers();\n    return status;\n  }\n\n  removeStatus(status) {\n    _.pull(this.statuses, status);\n    this.notifyObservers();\n    return null;\n  }\n\n  getStatusString() {\n    let result = \"\";\n    this.statuses.forEach((status, index) => {\n      if(index > 0) {\n        result += \"  \";\n      }\n      result += status.string;\n    })\n\n    return result;\n  }\n\n  notifyObservers() {\n    for(let observer of this.observers) {\n      observer(this.getStatusString());\n    }\n  }\n\n  addStatusObserver(callback) {\n    this.observers.push(callback);\n  }\n\n  removeStatusObserver(callback) {\n    _.pull(this.statuses, callback);\n  }\n\n\n}\n\nangular.module('app').service('statusManager', StatusManager);\n;class MemoryStorage {\n  constructor() {\n    this.memory = {};\n  }\n\n  getItem(key) {\n    return this.memory[key] || null;\n  }\n\n  getItemSync(key) {\n    return this.getItem(key);\n  }\n\n  get length() {\n    return Object.keys(this.memory).length;\n  }\n\n  setItem(key, value) {\n    this.memory[key] = value;\n  }\n\n  removeItem(key) {\n    delete this.memory[key];\n  }\n\n  clear() {\n    this.memory = {};\n  }\n\n  keys() {\n    return Object.keys(this.memory);\n  }\n\n  key(index) {\n    return Object.keys(this.memory)[index];\n  }\n}\n\nclass StorageManager extends SFStorageManager {\n\n  constructor(dbManager) {\n    super();\n    this.dbManager = dbManager;\n  }\n\n  initialize(hasPasscode, ephemeral) {\n    if(hasPasscode) {\n      // We don't want to save anything in fixed storage except for actual item data (in IndexedDB)\n      this.storage = this.memoryStorage;\n      this.itemsStorageMode = StorageManager.FixedEncrypted;\n    } else if(ephemeral) {\n      // We don't want to save anything in fixed storage as well as IndexedDB\n      this.storage = this.memoryStorage;\n      this.itemsStorageMode = StorageManager.Ephemeral;\n    } else {\n      this.storage = localStorage;\n      this.itemsStorageMode = StorageManager.Fixed;\n    }\n\n    this.modelStorageMode = ephemeral ? StorageManager.Ephemeral : StorageManager.Fixed;\n  }\n\n  get memoryStorage() {\n    if(!this._memoryStorage) {\n      this._memoryStorage = new MemoryStorage();\n    }\n    return this._memoryStorage;\n  }\n\n  setItemsMode(mode, force) {\n    var newStorage = this.getVault(mode);\n    if(newStorage !== this.storage || mode !== this.itemsStorageMode || force) {\n      // transfer storages\n      var length = this.storage.length;\n      for(var i = 0; i < length; i++) {\n        var key = this.storage.key(i);\n        newStorage.setItem(key, this.storage.getItem(key));\n      }\n\n      this.itemsStorageMode = mode;\n      if(newStorage !== this.storage) {\n        // Only clear if this.storage isn't the same reference as newStorage\n        this.storage.clear();\n      }\n      this.storage = newStorage;\n\n      if(mode == StorageManager.FixedEncrypted) {\n        this.writeEncryptedStorageToDisk();\n      } else if(mode == StorageManager.Fixed) {\n        // Remove encrypted storage\n        this.removeItem(\"encryptedStorage\", StorageManager.Fixed);\n      }\n    }\n  }\n\n  getVault(vaultKey) {\n    if(vaultKey) {\n      if(vaultKey == StorageManager.Ephemeral || vaultKey == StorageManager.FixedEncrypted) {\n        return this.memoryStorage;\n      } else {\n        return localStorage;\n      }\n    } else {\n      return this.storage;\n    }\n  }\n\n  async setItem(key, value, vaultKey) {\n    var storage = this.getVault(vaultKey);\n    try {\n      storage.setItem(key, value);\n    } catch (e) {\n      console.error(\"Exception while trying to setItem in StorageManager:\", e);\n      alert(\"The application's local storage is out of space. If you have Session History save-to-disk enabled, please disable it, and try again.\");\n    }\n\n    if(vaultKey === StorageManager.FixedEncrypted || (!vaultKey && this.itemsStorageMode === StorageManager.FixedEncrypted)) {\n      this.writeEncryptedStorageToDisk();\n    }\n  }\n\n  async getItem(key, vault) {\n    return this.getItemSync(key, vault);\n  }\n\n  getItemSync(key, vault) {\n    var storage = this.getVault(vault);\n    return storage.getItem(key);\n  }\n\n  async removeItem(key, vault) {\n    var storage = this.getVault(vault);\n    return storage.removeItem(key);\n  }\n\n  async clear() {\n    this.memoryStorage.clear();\n    localStorage.clear();\n  }\n\n  storageAsHash() {\n    var hash = {};\n    var length = this.storage.length;\n    for(var i = 0; i < length; i++) {\n      var key = this.storage.key(i);\n      hash[key] = this.storage.getItem(key)\n    }\n    return hash;\n  }\n\n  setKeys(keys, authParams) {\n    this.encryptedStorageKeys = keys;\n    this.encryptedStorageAuthParams = authParams;\n  }\n\n  writeEncryptedStorageToDisk() {\n    var encryptedStorage = new SNEncryptedStorage();\n    // Copy over totality of current storage\n    encryptedStorage.content.storage = this.storageAsHash();\n\n    // Save new encrypted storage in Fixed storage\n    var params = new SFItemParams(encryptedStorage, this.encryptedStorageKeys, this.encryptedStorageAuthParams);\n    params.paramsForSync().then((syncParams) => {\n      this.setItem(\"encryptedStorage\", JSON.stringify(syncParams), StorageManager.Fixed);\n    })\n  }\n\n  async decryptStorage() {\n    var stored = JSON.parse(this.getItemSync(\"encryptedStorage\", StorageManager.Fixed));\n    await SFJS.itemTransformer.decryptItem(stored, this.encryptedStorageKeys);\n    var encryptedStorage = new SNEncryptedStorage(stored);\n\n    for(var key of Object.keys(encryptedStorage.content.storage)) {\n      this.setItem(key, encryptedStorage.storage[key]);\n    }\n  }\n\n  hasPasscode() {\n    return this.getItemSync(\"encryptedStorage\", StorageManager.Fixed) !== null;\n  }\n\n  bestStorageMode() {\n    return this.hasPasscode() ? StorageManager.FixedEncrypted : StorageManager.Fixed;\n  }\n\n\n  /*\n  Model Storage\n\n  If using ephemeral storage, we don't need to write it to anything as references will be held already by controllers\n  and the global modelManager service.\n  */\n\n  setModelStorageMode(mode) {\n    if(mode == this.modelStorageMode) {\n      return;\n    }\n\n    if(mode == StorageManager.Ephemeral) {\n      // Clear IndexedDB\n      this.dbManager.clearAllModels(null);\n    } else {\n      // Fixed\n    }\n\n    this.modelStorageMode = mode;\n  }\n\n  async getAllModels() {\n    return new Promise((resolve, reject) => {\n      if(this.modelStorageMode == StorageManager.Fixed) {\n        this.dbManager.getAllModels(resolve);\n      } else {\n        resolve();\n      }\n    })\n  }\n\n  async saveModel(item) {\n    return this.saveModels([item]);\n  }\n\n  async saveModels(items, onsuccess, onerror) {\n    return new Promise((resolve, reject) => {\n      if(this.modelStorageMode == StorageManager.Fixed) {\n        this.dbManager.saveModels(items, resolve, reject);\n      } else {\n        resolve();\n      }\n    });\n  }\n\n  async deleteModel(item) {\n    return new Promise((resolve, reject) => {\n      if(this.modelStorageMode == StorageManager.Fixed) {\n        this.dbManager.deleteModel(item, resolve);\n      } else {\n        resolve();\n      }\n    });\n  }\n\n  async clearAllModels() {\n    return new Promise((resolve, reject) => {\n      this.dbManager.clearAllModels(resolve);\n    });\n  }\n}\n\nStorageManager.FixedEncrypted = \"FixedEncrypted\"; // encrypted memoryStorage + localStorage persistence\nStorageManager.Ephemeral = \"Ephemeral\"; // memoryStorage\nStorageManager.Fixed = \"Fixed\"; // localStorage\n\nangular.module('app').service('storageManager', StorageManager);\n;class SyncManager extends SFSyncManager {\n\n  constructor(modelManager, storageManager, httpManager, $timeout, $interval, $compile, $rootScope) {\n    super(modelManager, storageManager, httpManager, $timeout, $interval);\n    this.$rootScope = $rootScope;\n    this.$compile = $compile;\n\n    // this.loggingEnabled = true;\n\n    // Content types appearing first are always mapped first\n    this.contentTypeLoadPriority = [\n      \"SN|UserPreferences\", \"SN|Privileges\",\n      \"SN|Component\", \"SN|Theme\"];\n  }\n\n  presentConflictResolutionModal(items, callback) {\n    var scope = this.$rootScope.$new(true);\n    scope.item1 = items[0];\n    scope.item2 = items[1];\n    scope.callback = callback;\n    var el = this.$compile( \"<conflict-resolution-modal item1='item1' item2='item2' callback='callback' class='sk-modal'></conflict-resolution-modal>\" )(scope);\n    angular.element(document.body).append(el);\n  }\n\n}\n\nangular.module('app').service('syncManager', SyncManager);\n;class ThemeManager {\n\n  constructor(componentManager, desktopManager, storageManager, passcodeManager) {\n    this.componentManager = componentManager;\n    this.storageManager = storageManager;\n    this.desktopManager = desktopManager;\n    this.activeThemes = [];\n\n    ThemeManager.CachedThemesKey = \"cachedThemes\";\n\n    this.registerObservers();\n\n    // When a passcode is added, all local storage will be encrypted (it doesn't know what was\n    // originally saved as Fixed or FixedEncrypted). We want to rewrite cached themes here to Fixed\n    // so that it's readable without authentication.\n    passcodeManager.addPasscodeChangeObserver(() => {\n      this.cacheThemes();\n    })\n\n    // The desktop application won't have its applicationDataPath until the angular document is ready,\n    // so it wont be able to resolve local theme urls until thats ready\n    angular.element(document).ready(() => {\n      this.activateCachedThemes();\n    });\n  }\n\n  activateCachedThemes() {\n    let cachedThemes = this.getCachedThemes();\n    let writeToCache = false;\n    for(var theme of cachedThemes) {\n      this.activateTheme(theme, writeToCache);\n    }\n  }\n\n  registerObservers() {\n    this.desktopManager.registerUpdateObserver((component) => {\n      // Reload theme if active\n      if(component.active && component.isTheme()) {\n        this.deactivateTheme(component);\n        setTimeout(() => {\n          this.activateTheme(component);\n        }, 10);\n      }\n    })\n\n    this.componentManager.registerHandler({identifier: \"themeManager\", areas: [\"themes\"], activationHandler: (component) => {\n      if(component.active) {\n        this.activateTheme(component);\n      } else {\n        this.deactivateTheme(component);\n      }\n    }});\n  }\n\n  hasActiveTheme() {\n    return this.componentManager.getActiveThemes().length > 0;\n  }\n\n  deactivateAllThemes() {\n    var activeThemes = this.componentManager.getActiveThemes();\n    for(var theme of activeThemes) {\n      if(theme) {\n        this.componentManager.deactivateComponent(theme);\n      }\n    }\n\n    this.decacheThemes();\n  }\n\n  activateTheme(theme, writeToCache = true) {\n    if(_.find(this.activeThemes, {uuid: theme.uuid})) {\n      return;\n    }\n\n    this.activeThemes.push(theme);\n\n    var url = this.componentManager.urlForComponent(theme);\n    var link = document.createElement(\"link\");\n    link.href = url;\n    link.type = \"text/css\";\n    link.rel = \"stylesheet\";\n    link.media = \"screen,print\";\n    link.id = theme.uuid;\n    document.getElementsByTagName(\"head\")[0].appendChild(link);\n\n    if(writeToCache) {\n      this.cacheThemes();\n    }\n  }\n\n  deactivateTheme(theme) {\n    var element = document.getElementById(theme.uuid);\n    if(element) {\n      element.disabled = true;\n      element.parentNode.removeChild(element);\n    }\n\n    _.remove(this.activeThemes, {uuid: theme.uuid});\n\n    this.cacheThemes();\n  }\n\n  async cacheThemes() {\n    let mapped = await Promise.all(this.activeThemes.map(async (theme) => {\n      let transformer = new SFItemParams(theme);\n      let params = await transformer.paramsForLocalStorage();\n      return params;\n    }));\n    let data = JSON.stringify(mapped);\n    return this.storageManager.setItem(ThemeManager.CachedThemesKey, data, StorageManager.Fixed);\n  }\n\n  async decacheThemes() {\n    return this.storageManager.removeItem(ThemeManager.CachedThemesKey, StorageManager.Fixed);\n  }\n\n  getCachedThemes() {\n    let cachedThemes = this.storageManager.getItemSync(ThemeManager.CachedThemesKey, StorageManager.Fixed);\n    if(cachedThemes) {\n      let parsed = JSON.parse(cachedThemes);\n      return parsed.map((theme) => {\n        return new SNTheme(theme);\n      });\n    } else {\n      return [];\n    }\n  }\n}\n\nangular.module('app').service('themeManager', ThemeManager);\n;// reuse\nvar locale, formatter;\n\nangular.module('app')\n  .filter('appDate', function ($filter) {\n      return function (input) {\n          return input ? $filter('date')(new Date(input), 'MM/dd/yyyy', 'UTC') : '';\n      };\n  })\n  .filter('appDateTime', function ($filter) {\n      return function (input) {\n        if (typeof Intl !== 'undefined' && Intl.DateTimeFormat) {\n          if (!formatter) {\n            locale = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.language;\n            formatter = new Intl.DateTimeFormat(locale, {\n              year: 'numeric',\n              month: 'numeric',\n              day: '2-digit',\n              hour: '2-digit',\n              minute: '2-digit',\n            });\n          }\n          return formatter.format(input);\n        } else {\n          return input ? $filter('date')(new Date(input), 'MM/dd/yyyy h:mm a') : '';\n        }\n      }\n  });\n;angular.module('app').filter('trusted', ['$sce', function ($sce) {\n    return function(url) {\n        return $sce.trustAsResourceUrl(url);\n    };\n}]);\n;angular\n  .module('app')\n  .directive('snAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('clickOutside', ['$document', function($document) {\n    return {\n      restrict: 'A',\n      replace: false,\n      link : function($scope, $element, attrs) {\n\n        var didApplyClickOutside = false;\n\n        $element.bind('click', function(e) {\n          didApplyClickOutside = false;\n          if (attrs.isOpen) {\n            e.stopPropagation();\n          }\n        });\n\n        $document.bind('click', function() {\n          if(!didApplyClickOutside) {\n            $scope.$apply(attrs.clickOutside);\n            didApplyClickOutside = true;\n          }\n        })\n\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('delayHide', function($timeout) {\n   return {\n     restrict: 'A',\n     scope: {\n       show: '=',\n       delay: '@'\n     },\n     link: function(scope, elem, attrs) {\n       var showTimer;\n\n       showElement(false);\n\n       //This is where all the magic happens!\n       // Whenever the scope variable updates we simply\n       // show if it evaluates to 'true' and hide if 'false'\n       scope.$watch('show', function(newVal){\n         newVal ? showSpinner() : hideSpinner();\n       });\n\n       function showSpinner() {\n         if(scope.hidePromise) {\n           $timeout.cancel(scope.hidePromise);\n           scope.hidePromise = null;\n         }\n         showElement(true);\n       }\n\n       function hideSpinner() {\n          scope.hidePromise = $timeout(showElement.bind(this, false), getDelay());\n       }\n\n       function showElement(show) {\n         show ? elem.css({display:''}) : elem.css({display:'none'});\n       }\n\n       function getDelay() {\n         var delay = parseInt(scope.delay);\n\n         return angular.isNumber(delay) ? delay : 200;\n       }\n     }\n\n   };\n});\n;angular\n.module('app')\n.directive( 'elemReady', function( $parse ) {\n   return {\n       restrict: 'A',\n       link: function( $scope, elem, attrs ) {\n          elem.ready(function(){\n            $scope.$apply(function(){\n                var func = $parse(attrs.elemReady);\n                func($scope);\n            })\n          })\n       }\n    }\n})\n;angular\n  .module('app')\n  .directive('fileChange', function() {\n    return {\n     restrict: 'A',\n     scope: {\n       handler: '&'\n     },\n     link: function (scope, element) {\n      element.on('change', function (event) {\n        scope.$apply(function(){\n          scope.handler({files: event.target.files});\n        });\n      });\n     }\n    };\n});\n;angular.module('app').directive('infiniteScroll', [\n'$rootScope', '$window', '$timeout', function($rootScope, $window, $timeout) {\n  return {\n    link: function(scope, elem, attrs) {\n      var offset = parseInt(attrs.threshold) || 0;\n      var e = elem[0]\n\n      elem.on('scroll', function(){\n        if(scope.$eval(attrs.canLoad) && e.scrollTop + e.offsetHeight >= e.scrollHeight - offset) {\n          scope.$apply(attrs.infiniteScroll);\n        }\n      });\n    }\n  };\n}\n]);\n;angular\n  .module('app')\n  .directive('lowercase', function() {\n    return {\n      require: 'ngModel',\n      link: function(scope, element, attrs, modelCtrl) {\n        var lowercase = function(inputValue) {\n          if (inputValue == undefined) inputValue = '';\n          var lowercased = inputValue.toLowerCase();\n          if (lowercased !== inputValue) {\n            modelCtrl.$setViewValue(lowercased);\n            modelCtrl.$render();\n          }\n          return lowercased;\n        }\n        modelCtrl.$parsers.push(lowercase);\n        lowercase(scope[attrs.ngModel]);\n      }\n    };\n  });\n;angular\n  .module('app')\n  .directive('selectOnClick', ['$window', function ($window) {\n    return {\n        restrict: 'A',\n        link: function (scope, element, attrs) {\n            element.on('focus', function () {\n                if (!$window.getSelection().toString()) {\n                    // Required for mobile Safari\n                    this.setSelectionRange(0, this.value.length)\n                }\n            });\n        }\n    };\n}]);\n;angular\n.module('app')\n.directive('snEnter', function() {\n  return function(scope, element, attrs) {\n    element.bind(\"keydown keypress\", function(event) {\n      if(event.which === 13) {\n        scope.$apply(function(){\n            scope.$eval(attrs.snEnter, {'event': event});\n        });\n\n        event.preventDefault();\n      }\n    });\n  };\n});\n;class AccountMenu {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/account-menu.html\";\n    this.scope = {\n      \"onSuccessfulAuth\" : \"&\",\n      \"closeFunction\" : \"&\"\n    };\n  }\n\n  controller($scope, $rootScope, authManager, modelManager, syncManager, storageManager, dbManager, passcodeManager,\n    $timeout, $compile, archiveManager, privilegesManager, appVersion) {\n    'ngInject';\n\n    $scope.appVersion = \"v\" + appVersion;\n    $scope.formData = {mergeLocal: true, ephemeral: false};\n\n    $scope.user = authManager.user;\n\n    syncManager.getServerURL().then((url) => {\n      $timeout(() => {\n        $scope.server = url;\n        $scope.formData.url = url;\n      })\n    })\n\n    authManager.checkForSecurityUpdate().then((available) => {\n        $scope.securityUpdateAvailable = available;\n    })\n\n    $scope.close = function() {\n      $timeout(() => {\n        $scope.closeFunction()();\n      })\n    }\n\n    $scope.encryptedBackupsAvailable = function() {\n      return authManager.user || passcodeManager.hasPasscode();\n    }\n\n    $scope.canAddPasscode = !authManager.isEphemeralSession();\n    $scope.syncStatus = syncManager.syncStatus;\n\n    $scope.submitMfaForm = function() {\n      var params = {};\n      params[$scope.formData.mfa.payload.mfa_key] = $scope.formData.userMfaCode;\n      $scope.login(params);\n    }\n\n    $scope.submitAuthForm = function() {\n      if(!$scope.formData.email || !$scope.formData.user_password) {\n        return;\n      }\n      if($scope.formData.showLogin) {\n        $scope.login();\n      } else {\n        $scope.register();\n      }\n    }\n\n    $scope.login = function(extraParams) {\n      // Prevent a timed sync from occuring while signing in. There may be a race condition where when\n      // calling `markAllItemsDirtyAndSaveOffline` during sign in, if an authenticated sync happens to occur\n      // right before that's called, items retreived from that sync will be marked as dirty, then resynced, causing mass duplication.\n      // Unlock sync after all sign in processes are complete.\n      syncManager.lockSyncing();\n\n      $scope.formData.status = \"Generating Login Keys...\";\n      $scope.formData.authenticating = true;\n      $timeout(function(){\n        authManager.login($scope.formData.url, $scope.formData.email, $scope.formData.user_password,\n          $scope.formData.ephemeral, $scope.formData.strictSignin, extraParams).then((response) => {\n            $timeout(() => {\n              if(!response || response.error) {\n\n                syncManager.unlockSyncing();\n\n                $scope.formData.status = null;\n                var error = response ? response.error : {message: \"An unknown error occured.\"}\n\n                // MFA Error\n                if(error.tag == \"mfa-required\" || error.tag == \"mfa-invalid\") {\n                  $scope.formData.showLogin = false;\n                  $scope.formData.mfa = error;\n                }\n                // General Error\n                else {\n                  $scope.formData.showLogin = true;\n                  $scope.formData.mfa = null;\n                  if(error.message) { alert(error.message); }\n                }\n\n                $scope.formData.authenticating = false;\n              }\n              // Success\n              else {\n                $scope.onAuthSuccess(() => {\n                  syncManager.unlockSyncing();\n                  syncManager.sync({performIntegrityCheck: true});\n                });\n              }\n            })\n        });\n      })\n    }\n\n    $scope.register = function() {\n      let confirmation = $scope.formData.password_conf;\n      if(confirmation !== $scope.formData.user_password) {\n        alert(\"The two passwords you entered do not match. Please try again.\");\n        return;\n      }\n\n      $scope.formData.confirmPassword = false;\n      $scope.formData.status = \"Generating Account Keys...\";\n      $scope.formData.authenticating = true;\n\n      $timeout(function(){\n        authManager.register($scope.formData.url, $scope.formData.email, $scope.formData.user_password, $scope.formData.ephemeral).then((response) => {\n          $timeout(() => {\n            if(!response || response.error) {\n              $scope.formData.status = null;\n              var error = response ? response.error : {message: \"An unknown error occured.\"}\n              $scope.formData.authenticating = false;\n              alert(error.message);\n            } else {\n              $scope.onAuthSuccess(() => {\n                syncManager.sync();\n              });\n            }\n          })\n        });\n      })\n    }\n\n    $scope.mergeLocalChanged = function() {\n      if(!$scope.formData.mergeLocal) {\n        if(!confirm(\"Unchecking this option means any of the notes you have written while you were signed out will be deleted. Are you sure you want to discard these notes?\")) {\n          $scope.formData.mergeLocal = true;\n        }\n      }\n    }\n\n    $scope.onAuthSuccess = function(callback) {\n      var block = function() {\n        $timeout(function(){\n          $scope.formData.authenticating = false;\n          $scope.onSuccessfulAuth()();\n          syncManager.refreshErroredItems();\n          callback && callback();\n        })\n      }\n\n      if($scope.formData.mergeLocal) {\n        // Allows desktop to make backup file\n        $rootScope.$broadcast(\"major-data-change\");\n        $scope.clearDatabaseAndRewriteAllItems(true, block);\n      }\n      else {\n        modelManager.removeAllItemsFromMemory();\n        storageManager.clearAllModels().then(() => {\n          block();\n        })\n      }\n    }\n\n    $scope.openPasswordWizard = function(type) {\n      // Close the account menu\n      $scope.close();\n      authManager.presentPasswordWizard(type);\n    }\n\n    $scope.openPrivilegesModal = async function() {\n      $scope.close();\n\n      let run = () => {\n        $timeout(() => {\n          privilegesManager.presentPrivilegesManagementModal();\n        })\n      }\n\n      if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManagePrivileges)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManagePrivileges, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    // Allows indexeddb unencrypted logs to be deleted\n    // clearAllModels will remove data from backing store, but not from working memory\n    // See: https://github.com/standardnotes/desktop/issues/131\n    $scope.clearDatabaseAndRewriteAllItems = function(alternateUuids, callback) {\n      storageManager.clearAllModels().then(() => {\n        syncManager.markAllItemsDirtyAndSaveOffline(alternateUuids).then(() => {\n          callback && callback();\n        })\n      });\n    }\n\n    $scope.destroyLocalData = function() {\n      if(!confirm(\"Are you sure you want to end your session? This will delete all local items and extensions.\")) {\n        return;\n      }\n\n      authManager.signout(true).then(() => {\n        window.location.reload();\n      })\n    }\n\n    /* Import/Export */\n\n    $scope.archiveFormData = {encrypted: $scope.encryptedBackupsAvailable() ? true : false};\n    $scope.user = authManager.user;\n\n    $scope.submitImportPassword = function() {\n      $scope.performImport($scope.importData.data, $scope.importData.password);\n    }\n\n    $scope.performImport = function(data, password) {\n      $scope.importData.loading = true;\n      // allow loading indicator to come up with timeout\n      $timeout(function(){\n        $scope.importJSONData(data, password, function(response, errorCount){\n          $timeout(function(){\n            $scope.importData.loading = false;\n            $scope.importData = null;\n\n            // Update UI before showing alert\n            setTimeout(function () {\n              // Response can be null if syncing offline\n              if(response && response.error) {\n                alert(\"There was an error importing your data. Please try again.\");\n              } else {\n                if(errorCount > 0) {\n                  var message = `Import complete. ${errorCount} items were not imported because there was an error decrypting them. Make sure the password is correct and try again.`;\n                  alert(message);\n                } else {\n                  alert(\"Your data has been successfully imported.\")\n                }\n              }\n            }, 10);\n          })\n        })\n      })\n    }\n\n    $scope.importFileSelected = async function(files) {\n\n      let run = () => {\n        $timeout(() => {\n          $scope.importData = {};\n\n          var file = files[0];\n          var reader = new FileReader();\n          reader.onload = function(e) {\n            try {\n              var data = JSON.parse(e.target.result);\n              $timeout(function(){\n                if(data.auth_params) {\n                  // request password\n                  $scope.importData.requestPassword = true;\n                  $scope.importData.data = data;\n\n                  $timeout(() => {\n                    var element = document.getElementById(\"import-password-request\");\n                    if(element) {\n                      element.scrollIntoView(false);\n                    }\n                  })\n                } else {\n                  $scope.performImport(data, null);\n                }\n              })\n            } catch (e) {\n                alert(\"Unable to open file. Ensure it is a proper JSON file and try again.\");\n            }\n          }\n\n          reader.readAsText(file);\n        })\n      }\n\n      if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManageBackups)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManageBackups, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    $scope.importJSONData = function(data, password, callback) {\n      var onDataReady = async (errorCount) => {\n        var items = await modelManager.importItems(data.items);\n        for(var item of items) {\n          // We don't want to activate any components during import process in case of exceptions\n          // breaking up the import proccess\n          if(item.content_type == \"SN|Component\") { item.active = false; }\n        }\n\n        syncManager.sync().then((response) => {\n          // Response can be null if syncing offline\n          callback(response, errorCount);\n        });\n      }\n\n      if(data.auth_params) {\n        SFJS.crypto.computeEncryptionKeysForUser(password, data.auth_params).then((keys) => {\n          try {\n            SFJS.itemTransformer.decryptMultipleItems(data.items, keys, false) /* throws = false as we don't want to interrupt all decryption if just one fails */\n            .then(() => {\n              // delete items enc_item_key since the user's actually key will do the encrypting once its passed off\n              data.items.forEach(function(item){\n                item.enc_item_key = null;\n                item.auth_hash = null;\n              });\n\n              var errorCount = 0;\n              // Don't import items that didn't decrypt properly\n              data.items = data.items.filter(function(item){\n                if(item.errorDecrypting) {\n                  errorCount++;\n                  return false;\n                }\n                return true;\n              })\n\n              onDataReady(errorCount);\n            })\n          }\n          catch (e) {\n            console.log(\"Error decrypting\", e);\n            alert(\"There was an error decrypting your items. Make sure the password you entered is correct and try again.\");\n            callback(null);\n            return;\n          }\n        });\n      } else {\n        onDataReady();\n      }\n    }\n\n    /*\n    Export\n    */\n\n    $scope.downloadDataArchive = async function() {\n      archiveManager.downloadBackup($scope.archiveFormData.encrypted);\n    }\n\n    /*\n    Encryption Status\n    */\n\n    $scope.notesAndTagsCount = function() {\n      var items = modelManager.allItemsMatchingTypes([\"Note\", \"Tag\"]);\n      return items.length;\n    }\n\n    $scope.encryptionStatusForNotes = function() {\n      var length = $scope.notesAndTagsCount();\n      return length + \"/\" + length + \" notes and tags encrypted\";\n    }\n\n    $scope.encryptionEnabled = function() {\n      return passcodeManager.hasPasscode() || !authManager.offline();\n    }\n\n    $scope.encryptionSource = function() {\n      if(!authManager.offline()) {\n        return \"Account keys\";\n      } else if(passcodeManager.hasPasscode()) {\n        return \"Local Passcode\";\n      } else {\n        return null;\n      }\n    }\n\n    $scope.encryptionStatusString = function() {\n      if(!authManager.offline()) {\n        return \"End-to-end encryption is enabled. Your data is encrypted before syncing to your private account.\";\n      } else if(passcodeManager.hasPasscode()) {\n        return \"Encryption is enabled. Your data is encrypted using your passcode before saving to your device storage.\";\n      } else {\n        return \"Encryption is not enabled. Sign in, register, or add a passcode lock to enable encryption.\";\n      }\n    }\n\n    /*\n    Passcode Lock\n    */\n\n    $scope.passcodeAutoLockOptions = passcodeManager.getAutoLockIntervalOptions();\n\n    $scope.reloadAutoLockInterval = function() {\n       passcodeManager.getAutoLockInterval().then((interval) => {\n         $timeout(() => {\n           $scope.selectedAutoLockInterval = interval;\n         })\n       })\n    }\n\n    $scope.reloadAutoLockInterval();\n\n    $scope.selectAutoLockInterval = async function(interval) {\n      let run = async () => {\n        await passcodeManager.setAutoLockInterval(interval);\n        $timeout(() => {\n          $scope.reloadAutoLockInterval();\n        });\n      }\n\n      if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManagePasscode)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManagePasscode, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    $scope.hasPasscode = function() {\n      return passcodeManager.hasPasscode();\n    }\n\n    $scope.addPasscodeClicked = function() {\n      $scope.formData.showPasscodeForm = true;\n    }\n\n    $scope.submitPasscodeForm = function() {\n      var passcode = $scope.formData.passcode;\n      if(passcode !== $scope.formData.confirmPasscode) {\n        alert(\"The two passcodes you entered do not match. Please try again.\");\n        return;\n      }\n\n      let fn = $scope.formData.changingPasscode ? passcodeManager.changePasscode.bind(passcodeManager) : passcodeManager.setPasscode.bind(passcodeManager);\n\n      fn(passcode, () => {\n        $timeout(() => {\n          $scope.formData.passcode = null;\n          $scope.formData.confirmPasscode = null;\n          $scope.formData.showPasscodeForm = false;\n          var offline = authManager.offline();\n\n          if(offline) {\n            // Allows desktop to make backup file\n            $rootScope.$broadcast(\"major-data-change\");\n            $scope.clearDatabaseAndRewriteAllItems(false);\n          }\n        })\n      })\n    }\n\n    $scope.changePasscodePressed = async function() {\n      let run = () => {\n        $timeout(() => {\n          $scope.formData.changingPasscode = true;\n          $scope.addPasscodeClicked();\n        })\n      }\n\n      if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManagePasscode)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManagePasscode, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    $scope.removePasscodePressed = async function() {\n      let run = () => {\n        $timeout(() => {\n          var signedIn = !authManager.offline();\n          var message = \"Are you sure you want to remove your local passcode?\";\n          if(!signedIn) {\n            message += \" This will remove encryption from your local data.\";\n          }\n          if(confirm(message)) {\n            passcodeManager.clearPasscode();\n\n            if(authManager.offline()) {\n              syncManager.markAllItemsDirtyAndSaveOffline();\n              // Don't create backup here, as if the user is temporarily removing the passcode to change it,\n              // we don't want to write unencrypted data to disk.\n              // $rootScope.$broadcast(\"major-data-change\");\n            }\n          }\n        })\n      }\n\n      if(await privilegesManager.actionRequiresPrivilege(PrivilegesManager.ActionManagePasscode)) {\n        privilegesManager.presentPrivilegesModal(PrivilegesManager.ActionManagePasscode, () => {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    $scope.isDesktopApplication = function() {\n      return isDesktopApplication();\n    }\n\n  }\n}\n\nangular.module('app').directive('accountMenu', () => new AccountMenu);\n;class ActionsMenu {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/actions-menu.html\";\n    this.scope = {\n      item: \"=\"\n    };\n  }\n\n  controller($scope, modelManager, actionsManager) {\n    'ngInject';\n\n    $scope.extensions = actionsManager.extensions.sort((a, b) => {\n      return a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1;\n    });\n\n    for(let ext of $scope.extensions) {\n      ext.loading = true;\n      actionsManager.loadExtensionInContextOfItem(ext, $scope.item, function(scopedExtension) {\n        ext.loading = false;\n      })\n    }\n\n    $scope.executeAction = function(action, extension, parentAction) {\n      if(action.verb == \"nested\") {\n        if(!action.subrows) {\n          action.subrows = $scope.subRowsForAction(action, extension);\n        } else {\n          action.subrows = null;\n        }\n        return;\n      }\n\n      action.running = true;\n      actionsManager.executeAction(action, extension, $scope.item, (response, error) => {\n        if(error) {\n          return;\n        }\n\n        action.running = false;\n        $scope.handleActionResponse(action, response);\n\n        // reload extension actions\n        actionsManager.loadExtensionInContextOfItem(extension, $scope.item, function(ext){\n          // keep nested state\n          // 4/1/2019: We're not going to do this anymore because we're no longer using nested actions for version history,\n          // and also because finding the parentAction based on only label is not good enough. Two actions can have same label.\n          // We'd need a way to track actions after they are reloaded, but there's no good way to do this.\n          // if(parentAction) {\n          //   var matchingAction = _.find(ext.actions, {label: parentAction.label});\n          //   matchingAction.subrows = $scope.subRowsForAction(parentAction, extension);\n          // }\n        });\n      })\n    }\n\n    $scope.handleActionResponse = function(action, response) {\n      switch (action.verb) {\n        case \"render\": {\n          var item = response.item;\n          actionsManager.presentRevisionPreviewModal(item.uuid, item.content);\n        }\n      }\n    }\n\n\n    $scope.subRowsForAction = function(parentAction, extension) {\n      if(!parentAction.subactions) {\n        return null;\n      }\n      return parentAction.subactions.map((subaction) => {\n        return {\n          onClick: () => {\n            this.executeAction(subaction, extension, parentAction);\n          },\n          label: subaction.label,\n          subtitle: subaction.desc,\n          spinnerClass: subaction.running ? 'info' : null\n        }\n      })\n    }\n  }\n\n}\n\nangular.module('app').directive('actionsMenu', () => new ActionsMenu);\n;class ComponentModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/component-modal.html\";\n    this.scope = {\n      show: \"=\",\n      component: \"=\",\n      callback: \"=\",\n      onDismiss: \"&\"\n    };\n  }\n\n  link($scope, el, attrs) {\n    $scope.el = el;\n  }\n\n  controller($scope, $timeout, componentManager) {\n    'ngInject';\n\n    $scope.dismiss = function(callback) {\n      $scope.el.remove();\n      $scope.$destroy();\n      $scope.onDismiss && $scope.onDismiss() && $scope.onDismiss()($scope.component);\n      callback && callback();\n    }\n  }\n\n}\n\nangular.module('app').directive('componentModal', () => new ComponentModal);\n;class ComponentView {\n\n  constructor($rootScope, componentManager, desktopManager, $timeout, themeManager) {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/component-view.html\";\n    this.scope = {\n      component: \"=\",\n      onLoad: \"=?\",\n      manualDealloc: \"=?\"\n    };\n\n    this.desktopManager = desktopManager;\n  }\n\n  link($scope, el, attrs, ctrl) {\n    $scope.el = el;\n\n    $scope.componentValid = true;\n\n    $scope.updateObserver = this.desktopManager.registerUpdateObserver((component) => {\n      if(component == $scope.component && component.active) {\n        $scope.reloadComponent();\n      }\n    })\n\n    $scope.$watch('component', function(component, prevComponent){\n      ctrl.componentValueChanging(component, prevComponent);\n    });\n  }\n\n  controller($scope, $rootScope, $timeout, componentManager, desktopManager, themeManager) {\n    'ngInject';\n\n    $scope.onVisibilityChange = function() {\n      if(document.visibilityState == \"hidden\") {\n        return;\n      }\n\n      if($scope.issueLoading) {\n        $scope.reloadComponent();\n      }\n    }\n\n    $scope.themeHandlerIdentifier = \"component-view-\" + Math.random();\n    componentManager.registerHandler({identifier: $scope.themeHandlerIdentifier, areas: [\"themes\"], activationHandler: (component) => {\n      $scope.reloadThemeStatus();\n    }});\n\n    $scope.identifier = \"component-view-\" + Math.random();\n\n    componentManager.registerHandler({\n      identifier: $scope.identifier,\n      areas: [$scope.component.area],\n      activationHandler: (component) => {\n        if(component !== $scope.component) {\n          return;\n        }\n\n        $timeout(() => {\n          $scope.handleActivation();\n        })\n      },\n      actionHandler: (component, action, data) => {\n         if(action == \"set-size\") {\n           componentManager.handleSetSizeEvent(component, data);\n         }\n      }\n    });\n\n    $scope.handleActivation = function() {\n      // activationHandlers may be called multiple times, design below to be idempotent\n      let component = $scope.component;\n      if(!component.active) {\n        return;\n      }\n\n      let iframe = componentManager.iframeForComponent(component);\n      if(iframe) {\n        $scope.loading = true;\n        // begin loading error handler. If onload isn't called in x seconds, display an error\n        if($scope.loadTimeout) { $timeout.cancel($scope.loadTimeout);}\n        $scope.loadTimeout = $timeout(() => {\n          if($scope.loading) {\n            $scope.loading = false;\n            $scope.issueLoading = true;\n\n            if(!$scope.didAttemptReload) {\n              $scope.didAttemptReload = true;\n              $scope.reloadComponent();\n            } else {\n              // We'll attempt to reload when the tab gains focus\n              document.addEventListener(\"visibilitychange\", $scope.onVisibilityChange);\n            }\n          }\n        }, 3500);\n        iframe.onload = (event) => {\n          let desktopError = false;\n          try {\n            // Accessing iframe.contentWindow.origin will throw an exception if we are in the web app, or if the iframe content\n            // is remote content. The only reason it works in this case is because we're accessing a local extension.\n            // In the future when the desktop app falls back to the web location if local fail loads, we won't be able to access this property anymore.\n            if(isDesktopApplication() && (iframe.contentWindow.origin == null || iframe.contentWindow.origin == 'null')) {\n              /*\n              Don't attempt reload in this case, as it results in infinite loop, since a reload will deactivate the extension and then reactivate.\n              This can cause this componentView to be dealloced and a new one to be instantiated. This happens in editor.js, which we'll need to look into.\n              Don't return from this clause either, since we don't want to cancel loadTimeout (that will trigger reload). Instead, handle custom fail logic here.\n              */\n              desktopError = true;\n            }\n          } catch (e) {\n\n          }\n\n          $timeout.cancel($scope.loadTimeout);\n          componentManager.registerComponentWindow(component, iframe.contentWindow).then(() => {\n            // Add small timeout to, as $scope.loading controls loading overlay,\n            // which is used to avoid flicker when enabling extensions while having an enabled theme\n            // we don't use ng-show because it causes problems with rendering iframes after timeout, for some reason.\n            $timeout(() => {\n              $scope.loading = false;\n              $scope.issueLoading = desktopError; /* Typically we'd just set this to false at this point, but we now account for desktopError */\n              $scope.onLoad && $scope.onLoad($scope.component);\n            }, 7)\n          })\n\n        };\n      }\n    }\n\n\n    /*\n    General note regarding activation/deactivation of components:\n    We pass `true` to componentManager.ac/detivateComponent for the `dontSync` parameter.\n    The activation we do in here is not global, but just local, so we don't need to sync the state.\n    For example, if we activate an editor, we just need to do that for display purposes, but dont\n    need to perform a sync to propagate that .active flag.\n    */\n\n    this.componentValueChanging = (component, prevComponent) => {\n      //\n      // See comment above about passing true to componentManager.ac/detivateComponent\n      //\n      if(prevComponent && component !== prevComponent) {\n        // Deactive old component\n        componentManager.deactivateComponent(prevComponent, true);\n      }\n\n      if(component) {\n        componentManager.activateComponent(component, true);\n        // console.log(\"Loading\", $scope.component.name, $scope.getUrl(), component.valid_until);\n\n        $scope.reloadStatus();\n      }\n    }\n\n    $scope.$on(\"ext-reload-complete\", () => {\n      $scope.reloadStatus(false);\n    })\n\n    $scope.reloadComponent = function() {\n      // console.log(\"Reloading component\", $scope.component);\n      // force iFrame to deinit, allows new one to be created\n      $scope.componentValid = false;\n      componentManager.reloadComponent($scope.component).then(() => {\n        $scope.reloadStatus();\n      })\n    }\n\n    $scope.reloadStatus = function(doManualReload = true) {\n      let component = $scope.component;\n      $scope.reloading = true;\n      let previouslyValid = $scope.componentValid;\n\n      let offlineRestricted = component.offlineOnly && !isDesktopApplication();\n\n      let urlError =\n        (!isDesktopApplication() && !component.hasValidHostedUrl())\n        ||\n        (isDesktopApplication() && (!component.local_url && !component.hasValidHostedUrl()))\n\n      $scope.expired = component.valid_until && component.valid_until <= new Date();\n\n      // Here we choose our own readonly state based on custom logic. However, if a parent\n      // wants to implement their own readonly logic, they can lock it.\n      if(!component.lockReadonly) {\n        component.readonly = $scope.expired;\n      }\n\n      $scope.componentValid = !offlineRestricted && !urlError;\n\n      if(!$scope.componentValid) {\n        // required to disable overlay\n        $scope.loading = false;\n      }\n\n      if(offlineRestricted) $scope.error = 'offline-restricted';\n      else if(urlError) $scope.error = 'url-missing';\n      else $scope.error = null;\n\n      if($scope.componentValid !== previouslyValid) {\n        if($scope.componentValid) {\n          // We want to reload here, rather than `activateComponent`, because the component will already have attempted to been activated.\n          componentManager.reloadComponent(component, true);\n        }\n      }\n\n      if($scope.expired && doManualReload) {\n        // Try reloading, handled by footer, which will open Extensions window momentarily to pull in latest data\n        // Upon completion, this method, reloadStatus, will be called, upon where doManualReload will be false to prevent recursion.\n        $rootScope.$broadcast(\"reload-ext-data\");\n      }\n\n      $scope.reloadThemeStatus();\n\n      $timeout(() => {\n        $scope.reloading = false;\n      }, 500)\n    }\n\n    $scope.reloadThemeStatus = function() {\n      if(!$scope.component.acceptsThemes()) {\n        if(themeManager.hasActiveTheme()) {\n          if(!$scope.dismissedNoThemesMessage) {\n            $scope.showNoThemesMessage = true;\n          }\n        } else {\n          // Can be the case if we've just deactivated a theme\n          $scope.showNoThemesMessage = false;\n        }\n      }\n    }\n\n    $scope.noThemesMessageDismiss = function() {\n      $scope.showNoThemesMessage = false;\n      $scope.dismissedNoThemesMessage = true;\n    }\n\n    $scope.disableActiveTheme = function() {\n      themeManager.deactivateAllThemes();\n      $scope.noThemesMessageDismiss();\n    }\n\n    $scope.getUrl = function() {\n      var url = componentManager.urlForComponent($scope.component);\n      $scope.component.runningLocally = (url == $scope.component.local_url);\n      return url;\n    }\n\n    $scope.destroy = function() {\n      componentManager.deregisterHandler($scope.themeHandlerIdentifier);\n      componentManager.deregisterHandler($scope.identifier);\n      if($scope.component && !$scope.manualDealloc) {\n        componentManager.deactivateComponent($scope.component, true);\n      }\n\n      desktopManager.deregisterUpdateObserver($scope.updateObserver);\n      document.removeEventListener(\"visibilitychange\", $scope.onVisibilityChange);\n    }\n\n    $scope.$on(\"$destroy\", function() {\n      $scope.destroy();\n    });\n  }\n\n}\n\nangular.module('app').directive('componentView', ($rootScope, componentManager, desktopManager, $timeout) => new ComponentView($rootScope, componentManager, desktopManager, $timeout));\n;/*\n  The purpose of the conflict resoltion modal is to present two versions of a conflicted item,\n  and allow the user to choose which to keep (or to keep both.)\n*/\n\nclass ConflictResolutionModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/conflict-resolution-modal.html\";\n    this.scope = {\n      item1: \"=\",\n      item2: \"=\",\n      callback: \"=\"\n    };\n  }\n\n  link($scope, el, attrs) {\n\n    $scope.dismiss = function() {\n      el.remove();\n    }\n  }\n\n  controller($scope, modelManager, syncManager, archiveManager) {\n    'ngInject';\n\n    $scope.createContentString = function(item) {\n      return JSON.stringify(\n        Object.assign({created_at: item.created_at, updated_at: item.updated_at}, item.content), null, 2\n      )\n    }\n\n    $scope.contentType = $scope.item1.content_type;\n\n    $scope.item1Content = $scope.createContentString($scope.item1);\n    $scope.item2Content = $scope.createContentString($scope.item2);\n\n    $scope.keepItem1 = function() {\n      if(!confirm(\"Are you sure you want to delete the item on the right?\")) {\n        return;\n      }\n      modelManager.setItemToBeDeleted($scope.item2);\n      syncManager.sync().then(() => {\n        $scope.applyCallback();\n      })\n\n      $scope.dismiss();\n    }\n\n    $scope.keepItem2 = function() {\n      if(!confirm(\"Are you sure you want to delete the item on the left?\")) {\n        return;\n      }\n      modelManager.setItemToBeDeleted($scope.item1);\n      syncManager.sync().then(() => {\n        $scope.applyCallback();\n      })\n\n      $scope.dismiss();\n    }\n\n    $scope.keepBoth = function() {\n      $scope.applyCallback();\n      $scope.dismiss();\n    }\n\n    $scope.export = function() {\n      archiveManager.downloadBackupOfItems([$scope.item1, $scope.item2], true);\n    }\n\n    $scope.applyCallback = function() {\n      $scope.callback && $scope.callback();\n    }\n\n  }\n}\n\nangular.module('app').directive('conflictResolutionModal', () => new ConflictResolutionModal);\n;class EditorMenu {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/editor-menu.html\";\n    this.scope = {\n      callback: \"&\",\n      selectedEditor: \"=\",\n      currentItem: \"=\"\n    };\n  }\n\n  controller($scope, componentManager, syncManager, modelManager, $timeout) {\n    'ngInject';\n\n    $scope.formData = {};\n\n    $scope.editors = componentManager.componentsForArea(\"editor-editor\").sort((a, b) => {\n      return a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1;\n    });\n\n    $scope.isDesktop = isDesktopApplication();\n\n    $scope.defaultEditor = $scope.editors.filter((e) => {return e.isDefaultEditor()})[0];\n\n    $scope.selectComponent = function(component) {\n      if(component) {\n        if(component.content.conflict_of) {\n          component.content.conflict_of = null; // clear conflict if applicable\n          modelManager.setItemDirty(component, true);\n          syncManager.sync();\n        }\n      }\n      $timeout(() => {\n        $scope.callback()(component);\n      })\n    }\n\n    $scope.toggleDefaultForEditor = function(editor) {\n      if($scope.defaultEditor == editor) {\n        $scope.removeEditorDefault(editor);\n      } else {\n        $scope.makeEditorDefault(editor);\n      }\n    }\n\n    $scope.offlineAvailableForComponent = function(component) {\n      return component.local_url && isDesktopApplication();\n    }\n\n    $scope.makeEditorDefault = function(component) {\n      var currentDefault = componentManager.componentsForArea(\"editor-editor\").filter((e) => {return e.isDefaultEditor()})[0];\n      if(currentDefault) {\n        currentDefault.setAppDataItem(\"defaultEditor\", false);\n        modelManager.setItemDirty(currentDefault, true);\n      }\n\n      component.setAppDataItem(\"defaultEditor\", true);\n      modelManager.setItemDirty(component, true);\n      syncManager.sync();\n\n      $scope.defaultEditor = component;\n    }\n\n    $scope.removeEditorDefault = function(component) {\n      component.setAppDataItem(\"defaultEditor\", false);\n      modelManager.setItemDirty(component, true);\n      syncManager.sync();\n\n      $scope.defaultEditor = null;\n    }\n\n    $scope.shouldDisplayRunningLocallyLabel = function(component) {\n      if(!component.runningLocally) {\n        return false;\n      }\n\n      if(component == $scope.selectedEditor) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n}\n\nangular.module('app').directive('editorMenu', () => new EditorMenu);\n;class InputModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/input-modal.html\";\n    this.scope = {\n      type: \"=\",\n      title: \"=\",\n      message: \"=\",\n      placeholder: \"=\",\n      callback: \"&\"\n    };\n  }\n\n  link($scope, el, attrs) {\n    $scope.el = el;\n  }\n\n  controller($scope, modelManager, archiveManager, authManager, syncManager, $timeout) {\n    'ngInject';\n\n    $scope.formData = {};\n\n    $scope.dismiss = function() {\n      $scope.el.remove();\n      $scope.$destroy();\n    }\n\n    $scope.submit = function() {\n      $scope.callback()($scope.formData.input);\n      $scope.dismiss();\n    }\n\n\n  }\n}\n\nangular.module('app').directive('inputModal', () => new InputModal);\n;class MenuRow {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.transclude = true;\n    this.templateUrl = \"directives/menu-row.html\";\n    this.scope = {\n      action: \"&\",\n      circle: \"=\",\n      circleAlign: \"=\",\n      label: \"=\",\n      subtitle: \"=\",\n      hasButton: \"=\",\n      buttonText: \"=\",\n      buttonClass: \"=\",\n      buttonAction: \"&\",\n      spinnerClass: \"=\",\n      subRows: \"=\",\n      faded: \"=\",\n      desc: \"=\",\n      disabled: \"=\",\n      stylekitClass: \"=\"\n    };\n  }\n\n  controller($scope, componentManager) {\n    'ngInject';\n\n    $scope.onClick = function($event) {\n      if($scope.disabled) {\n        return;\n      }\n      $event.stopPropagation();\n      $scope.action();\n    }\n\n    // This is for the accessory button\n    $scope.clickButton = function($event) {\n      if($scope.disabled) {\n        return;\n      }\n      $event.stopPropagation();\n      $scope.buttonAction();\n    }\n\n  }\n}\n\nangular.module('app').directive('menuRow', () => new MenuRow);\n;class PanelResizer {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/panel-resizer.html\";\n    this.scope = {\n      index: \"=\",\n      panelId: \"=\",\n      onResize: \"&\",\n      defaultWidth: \"=\",\n      onResizeFinish: \"&\",\n      control: \"=\",\n      alwaysVisible: \"=\",\n      minWidth: \"=\",\n      property: \"=\",\n      hoverable: \"=\",\n      collapsable: \"=\"\n    };\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    scope.elem = elem;\n\n    scope.control.setWidth = function(value) {\n      scope.setWidth(value, true);\n    }\n\n    scope.control.setLeft = function(value) {\n      scope.setLeft(value);\n    }\n\n    scope.control.flash = function() {\n      scope.flash();\n    }\n\n    scope.control.isCollapsed = function() {\n      return scope.isCollapsed();\n    }\n  }\n\n  controller($scope, $element, modelManager, actionsManager, $timeout, $compile) {\n    'ngInject';\n\n    let panel = document.getElementById($scope.panelId);\n    if(!panel) {\n      console.log(\"Panel not found for\", $scope.panelId);\n    }\n\n    let resizerColumn = $element[0];\n    let resizerWidth = resizerColumn.offsetWidth;\n    let minWidth = $scope.minWidth || resizerWidth;\n    var pressed = false;\n    var startWidth = panel.scrollWidth, startX = 0, lastDownX = 0, collapsed, lastWidth = startWidth, startLeft = panel.offsetLeft, lastLeft = startLeft;\n    var appFrame;\n\n    $scope.isAtMaxWidth = function() {\n      return Math.round((lastWidth + lastLeft)) == Math.round(getParentRect().width);\n    }\n\n    $scope.isCollapsed = function() {\n      return lastWidth <= minWidth;\n    }\n\n    // Handle Double Click Event\n    var widthBeforeLastDblClick = 0;\n    resizerColumn.ondblclick = () => {\n      $timeout(() => {\n        var preClickCollapseState = $scope.isCollapsed();\n        if(preClickCollapseState) {\n          $scope.setWidth(widthBeforeLastDblClick || $scope.defaultWidth);\n        } else {\n          widthBeforeLastDblClick = lastWidth;\n          $scope.setWidth(minWidth);\n        }\n\n        $scope.finishSettingWidth();\n\n        var newCollapseState = !preClickCollapseState;\n        $scope.onResizeFinish()(lastWidth, lastLeft, $scope.isAtMaxWidth(), newCollapseState);\n      })\n    }\n\n    function getParentRect() {\n      return panel.parentNode.getBoundingClientRect();\n    }\n\n    if($scope.property == \"right\") {\n      let handleReize = debounce((event) => {\n        reloadDefaultValues();\n        handleWidthEvent();\n        $timeout(() => { $scope.finishSettingWidth(); })\n      }, 250);\n\n      window.addEventListener('resize', handleReize);\n\n      $scope.$on(\"$destroy\", function() {\n        window.removeEventListener('resize', handleReize);\n      });\n    }\n\n    function reloadDefaultValues() {\n      startWidth = $scope.isAtMaxWidth() ? getParentRect().width : panel.scrollWidth;\n      lastWidth = startWidth;\n      appFrame = document.getElementById(\"app\").getBoundingClientRect();\n    }\n    reloadDefaultValues();\n\n    if($scope.alwaysVisible) {\n      resizerColumn.classList.add(\"always-visible\");\n    }\n\n    if($scope.hoverable) {\n      resizerColumn.classList.add(\"hoverable\");\n    }\n\n    $scope.setWidth = function(width, finish) {\n      if(width < minWidth) {\n        width = minWidth;\n      }\n\n      let parentRect = getParentRect();\n\n      if(width > parentRect.width) {\n        width = parentRect.width;\n      }\n\n      let maxWidth = appFrame.width - panel.getBoundingClientRect().x;\n      if(width > maxWidth) {\n        width = maxWidth;\n      }\n\n      if((Math.round(width + lastLeft)) == Math.round(parentRect.width)) {\n        panel.style.width = `calc(100% - ${lastLeft}px)`;\n        panel.style.flexBasis = `calc(100% - ${lastLeft}px)`;\n      } else {\n        panel.style.flexBasis = width + \"px\";\n        panel.style.width = width + \"px\";\n      }\n\n      lastWidth = width;\n\n      if(finish) {\n        $scope.finishSettingWidth();\n      }\n    }\n\n    $scope.setLeft = function(left) {\n      panel.style.left = left + \"px\";\n      lastLeft = left;\n    }\n\n    $scope.finishSettingWidth = function() {\n      if(!$scope.collapsable) {\n        return;\n      }\n\n      collapsed = $scope.isCollapsed();\n      if(collapsed) {\n        resizerColumn.classList.add(\"collapsed\");\n      } else {\n        resizerColumn.classList.remove(\"collapsed\");\n      }\n    }\n\n    /*\n      If an iframe is displayed adjacent to our panel, and your mouse exits over the iframe,\n      document[onmouseup] is not triggered because the document is no longer the same over the iframe.\n      We add an invisible overlay while resizing so that the mouse context remains in our main document.\n     */\n    $scope.addInvisibleOverlay = function() {\n      if($scope.overlay) {\n        return;\n      }\n\n      $scope.overlay = $compile(\"<div id='resizer-overlay'></div>\")($scope);\n      angular.element(document.body).prepend($scope.overlay);\n    }\n\n    $scope.removeInvisibleOverlay = function() {\n      if($scope.overlay) {\n        $scope.overlay.remove();\n        $scope.overlay = null;\n      }\n    }\n\n    $scope.flash = function() {\n      resizerColumn.classList.add(\"animate-opacity\");\n      $timeout(() => {\n        resizerColumn.classList.remove(\"animate-opacity\");\n      }, 3000)\n    }\n\n    resizerColumn.addEventListener(\"mousedown\", function(event){\n      $scope.addInvisibleOverlay();\n\n      pressed = true;\n      lastDownX = event.clientX;\n      startWidth = panel.scrollWidth;\n      startLeft = panel.offsetLeft;\n      panel.classList.add(\"no-selection\");\n\n      if($scope.hoverable) {\n        resizerColumn.classList.add(\"dragging\");\n      }\n    })\n\n    document.addEventListener(\"mousemove\", function(event){\n      if(!pressed) {\n        return;\n      }\n\n      event.preventDefault();\n\n      if($scope.property && $scope.property == 'left') {\n        handleLeftEvent(event);\n      } else {\n        handleWidthEvent(event);\n      }\n    })\n\n    function handleWidthEvent(event) {\n      let x;\n      if(event) {\n        x = event.clientX;\n      } else {\n        // coming from resize event\n        x = 0;\n        lastDownX = 0;\n      }\n\n      let deltaX = x - lastDownX;\n      var newWidth = startWidth + deltaX;\n\n      $scope.setWidth(newWidth, false);\n\n      if($scope.onResize()) {\n        $scope.onResize()(lastWidth, panel);\n      }\n    }\n\n    function handleLeftEvent(event) {\n      var panelRect = panel.getBoundingClientRect();\n      var x = event.clientX || panelRect.x;\n      let deltaX = x - lastDownX;\n      var newLeft = startLeft + deltaX;\n      if(newLeft < 0) {\n        newLeft = 0;\n        deltaX = -startLeft;\n      }\n\n      let parentRect = getParentRect();\n\n      var newWidth = startWidth - deltaX;\n      if(newWidth < minWidth) {\n        newWidth = minWidth;\n      }\n\n      if(newWidth > parentRect.width) {\n        newWidth = parentRect.width;\n      }\n\n\n      if(newLeft + newWidth > parentRect.width) {\n        newLeft = parentRect.width - newWidth;\n      }\n\n      $scope.setLeft(newLeft, false);\n      $scope.setWidth(newWidth, false);\n    }\n\n    document.addEventListener(\"mouseup\", (event) => {\n      $scope.removeInvisibleOverlay();\n\n      if(pressed) {\n        pressed = false;\n        resizerColumn.classList.remove(\"dragging\");\n        panel.classList.remove(\"no-selection\");\n\n        let isMaxWidth = $scope.isAtMaxWidth();\n\n        if($scope.onResizeFinish) {\n          $scope.onResizeFinish()(lastWidth, lastLeft, isMaxWidth, $scope.isCollapsed());\n        }\n\n        $scope.finishSettingWidth();\n      }\n    })\n  }\n}\n\nangular.module('app').directive('panelResizer', () => new PanelResizer);\n\n/* via https://davidwalsh.name/javascript-debounce-function */\nfunction debounce(func, wait, immediate) {\n\tvar timeout;\n\treturn function() {\n\t\tvar context = this, args = arguments;\n\t\tvar later = function() {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) func.apply(context, args);\n\t\t};\n\t\tvar callNow = immediate && !timeout;\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n};\n;class PasswordWizard {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/password-wizard.html\";\n    this.scope = {\n      type: \"=\"\n    };\n  }\n\n  link($scope, el, attrs) {\n    $scope.el = el;\n  }\n\n  controller($scope, modelManager, archiveManager, authManager, syncManager, $timeout) {\n    'ngInject';\n\n    window.onbeforeunload = (e) => {\n      // Confirms with user to close tab before closing\n      return true;\n    };\n\n    $scope.$on(\"$destroy\", function() {\n      window.onbeforeunload = null;\n    });\n\n    $scope.dismiss = function() {\n      if($scope.lockContinue) {\n        alert(\"Cannot close window until pending tasks are complete.\");\n        return;\n      }\n      $scope.el.remove();\n      $scope.$destroy();\n    }\n\n    $scope.syncStatus = syncManager.syncStatus;\n    $scope.formData = {};\n\n    const IntroStep = 0;\n    const BackupStep = 1;\n    const SignoutStep = 2;\n    const PasswordStep = 3;\n    const SyncStep = 4;\n    const FinishStep = 5;\n\n    let DefaultContinueTitle = \"Continue\";\n    $scope.continueTitle = DefaultContinueTitle;\n\n    $scope.step = IntroStep;\n\n    $scope.titleForStep = function(step) {\n      switch (step) {\n        case BackupStep:\n          return \"Download a backup of your data\";\n        case SignoutStep:\n          return \"Sign out of all your devices\";\n        case PasswordStep:\n          return $scope.changePassword ? \"Password information\" : \"Enter your current password\";\n        case SyncStep:\n          return \"Encrypt and sync data with new keys\";\n        case FinishStep:\n          return \"Sign back in to your devices\";\n        default:\n          return null;\n      }\n    }\n\n    $scope.configure = function() {\n      if($scope.type == \"change-pw\") {\n        $scope.title = \"Change Password\";\n        $scope.changePassword = true;\n      } else if($scope.type == \"upgrade-security\") {\n        $scope.title = \"Security Update\";\n        $scope.securityUpdate = true;\n      }\n    }();\n\n    $scope.continue = function() {\n\n      if($scope.lockContinue || $scope.isContinuing) {\n        return;\n      }\n\n      // isContinuing is a way to lock the continue function separate from lockContinue\n      // lockContinue can be locked by other places, but isContinuing is only lockable from within this function.\n\n      $scope.isContinuing = true;\n\n      if($scope.step == FinishStep) {\n        $scope.dismiss();\n        return;\n      }\n\n      let next = () => {\n        $scope.step += 1;\n        $scope.initializeStep($scope.step);\n\n        $scope.isContinuing = false;\n      }\n\n      var preprocessor = $scope.preprocessorForStep($scope.step);\n      if(preprocessor) {\n        preprocessor(() => {\n          next();\n        }, () => {\n          // on fail\n          $scope.isContinuing = false;\n        })\n      } else {\n        next();\n      }\n    }\n\n    $scope.downloadBackup = function(encrypted) {\n      archiveManager.downloadBackup(encrypted);\n    }\n\n    $scope.preprocessorForStep = function(step) {\n      if(step == PasswordStep) {\n        return (onSuccess, onFail) => {\n          $scope.showSpinner = true;\n          $scope.continueTitle = \"Generating Keys...\";\n          $timeout(() => {\n            $scope.validateCurrentPassword((success) => {\n              $scope.showSpinner = false;\n              $scope.continueTitle = DefaultContinueTitle;\n              if(success) {\n                onSuccess();\n              } else {\n                onFail && onFail();\n              }\n            });\n          })\n        }\n      }\n    }\n\n    let FailedSyncMessage = \"There was an error re-encrypting your items. Your password was changed, but not all your items were properly re-encrypted and synced. You should try syncing again. If all else fails, you should restore your notes from backup.\";\n\n    $scope.initializeStep = function(step) {\n      if(step == SyncStep) {\n        $scope.lockContinue = true;\n        $scope.formData.status = \"Processing encryption keys...\";\n        $scope.formData.processing = true;\n\n        $scope.processPasswordChange((passwordSuccess) => {\n          $scope.formData.statusError = !passwordSuccess;\n          $scope.formData.processing = passwordSuccess;\n\n          if(passwordSuccess) {\n            $scope.formData.status = \"Encrypting and syncing data with new keys...\";\n\n            $scope.resyncData((syncSuccess) => {\n              $scope.formData.statusError = !syncSuccess;\n              $scope.formData.processing = !syncSuccess;\n              if(syncSuccess) {\n                $scope.lockContinue = false;\n\n                if($scope.changePassword) {\n                  $scope.formData.status = \"Successfully changed password and synced all items.\";\n                } else if($scope.securityUpdate) {\n                  $scope.formData.status = \"Successfully performed security update and synced all items.\";\n                }\n              } else {\n                $scope.formData.status = FailedSyncMessage;\n              }\n            })\n          } else {\n            $scope.formData.status = \"Unable to process your password. Please try again.\";\n          }\n        })\n      }\n\n      else if(step == FinishStep) {\n        $scope.continueTitle = \"Finish\";\n      }\n    }\n\n    $scope.validateCurrentPassword = async function(callback) {\n      let currentPassword = $scope.formData.currentPassword;\n      let newPass = $scope.securityUpdate ? currentPassword : $scope.formData.newPassword;\n\n      if(!currentPassword || currentPassword.length == 0) {\n        alert(\"Please enter your current password.\");\n        callback(false);\n        return;\n      }\n\n      if($scope.changePassword) {\n        if(!newPass || newPass.length == 0) {\n          alert(\"Please enter a new password.\");\n          callback(false);\n          return;\n        }\n\n        if(newPass != $scope.formData.newPasswordConfirmation) {\n          alert(\"Your new password does not match its confirmation.\");\n          $scope.formData.status = null;\n          callback(false);\n          return;\n        }\n      }\n\n      if(!authManager.user.email) {\n        alert(\"We don't have your email stored. Please log out then log back in to fix this issue.\");\n        $scope.formData.status = null;\n        callback(false);\n        return;\n      }\n\n      // Ensure value for current password matches what's saved\n      let authParams = await authManager.getAuthParams();\n      let password = $scope.formData.currentPassword;\n      SFJS.crypto.computeEncryptionKeysForUser(password, authParams).then(async (keys) => {\n        let success = keys.mk === (await authManager.keys()).mk;\n        if(success) {\n          this.currentServerPw = keys.pw;\n        } else {\n          alert(\"The current password you entered is not correct. Please try again.\");\n        }\n        $timeout(() => callback(success));\n      });\n    }\n\n    $scope.resyncData = function(callback) {\n      modelManager.setAllItemsDirty();\n      syncManager.sync().then((response) => {\n        if(!response || response.error) {\n          alert(FailedSyncMessage)\n          $timeout(() => callback(false));\n        } else {\n          $timeout(() => callback(true));\n        }\n      });\n    }\n\n    $scope.processPasswordChange = async function(callback) {\n      let newUserPassword = $scope.securityUpdate ? $scope.formData.currentPassword : $scope.formData.newPassword;\n\n      let currentServerPw = this.currentServerPw;\n\n      let results = await SFJS.crypto.generateInitialKeysAndAuthParamsForUser(authManager.user.email, newUserPassword);\n      let newKeys = results.keys;\n      let newAuthParams = results.authParams;\n\n      // perform a sync beforehand to pull in any last minutes changes before we change the encryption key (and thus cant decrypt new changes)\n      let syncResponse = await syncManager.sync();\n      authManager.changePassword(await syncManager.getServerURL(), authManager.user.email, currentServerPw, newKeys, newAuthParams).then((response) => {\n        if(response.error) {\n          alert(response.error.message ? response.error.message : \"There was an error changing your password. Please try again.\");\n          $timeout(() => callback(false));\n        } else {\n          $timeout(() => callback(true));\n        }\n      })\n    }\n  }\n\n}\n\nangular.module('app').directive('passwordWizard', () => new PasswordWizard);\n;class PermissionsModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/permissions-modal.html\";\n    this.scope = {\n      show: \"=\",\n      component: \"=\",\n      permissionsString: \"=\",\n      callback: \"=\"\n    };\n  }\n\n  link($scope, el, attrs) {\n\n    $scope.dismiss = function() {\n      el.remove();\n    }\n\n    $scope.accept = function() {\n      $scope.callback(true);\n      $scope.dismiss();\n    }\n\n    $scope.deny = function() {\n      $scope.callback(false);\n      $scope.dismiss();\n    }\n  }\n\n  controller($scope, modelManager) {\n    'ngInject';\n\n  }\n\n}\n\nangular.module('app').directive('permissionsModal', () => new PermissionsModal);\n;class PrivilegesAuthModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/privileges-auth-modal.html\";\n    this.scope = {\n      action: \"=\",\n      onSuccess: \"=\",\n      onCancel: \"=\",\n    };\n  }\n\n  link($scope, el, attrs) {\n    $scope.dismiss = function() {\n      el.remove();\n    }\n  }\n\n  controller($scope, privilegesManager, passcodeManager, authManager, $timeout) {\n    'ngInject';\n\n    $scope.authenticationParameters = {};\n    $scope.sessionLengthOptions = privilegesManager.getSessionLengthOptions();\n\n    privilegesManager.getSelectedSessionLength().then((length) => {\n      $timeout(() => {\n        $scope.selectedSessionLength = length;\n      })\n    })\n\n    $scope.selectSessionLength = function(length) {\n      $scope.selectedSessionLength = length;\n    }\n\n    privilegesManager.netCredentialsForAction($scope.action).then((credentials) => {\n      $timeout(() => {\n        $scope.requiredCredentials = credentials.sort();\n      });\n    });\n\n    $scope.promptForCredential = function(credential) {\n      return privilegesManager.displayInfoForCredential(credential).prompt;\n    }\n\n    $scope.cancel = function() {\n      $scope.dismiss();\n      $scope.onCancel && $scope.onCancel();\n    }\n\n    $scope.isCredentialInFailureState = function(credential) {\n      if(!$scope.failedCredentials) {\n        return false;\n      }\n      return $scope.failedCredentials.find((candidate) => {\n        return candidate == credential;\n      }) != null;\n    }\n\n    $scope.validate = function() {\n      var failed = [];\n      for(var cred of $scope.requiredCredentials) {\n        var value = $scope.authenticationParameters[cred];\n        if(!value || value.length == 0) {\n          failed.push(cred);\n        }\n      }\n\n      $scope.failedCredentials = failed;\n      return failed.length == 0;\n    }\n\n    $scope.submit = function() {\n      if(!$scope.validate()) {\n        return;\n      }\n      privilegesManager.authenticateAction($scope.action, $scope.authenticationParameters).then((result) => {\n        $timeout(() => {\n          if(result.success) {\n            privilegesManager.setSessionLength($scope.selectedSessionLength);\n            $scope.onSuccess();\n            $scope.dismiss();\n          } else {\n            $scope.failedCredentials = result.failedCredentials;\n          }\n        })\n      })\n    }\n\n  }\n}\n\nangular.module('app').directive('privilegesAuthModal', () => new PrivilegesAuthModal);\n;class PrivilegesManagementModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/privileges-management-modal.html\";\n    this.scope = {\n\n    };\n  }\n\n  link($scope, el, attrs) {\n    $scope.dismiss = function() {\n      el.remove();\n    }\n  }\n\n  controller($scope, privilegesManager, passcodeManager, authManager, $timeout) {\n    'ngInject';\n\n    $scope.dummy = {};\n\n    $scope.hasPasscode = passcodeManager.hasPasscode();\n    $scope.hasAccount = !authManager.offline();\n\n    $scope.displayInfoForCredential = function(credential) {\n      let info = privilegesManager.displayInfoForCredential(credential);\n      if(credential == PrivilegesManager.CredentialLocalPasscode) {\n        info[\"availability\"] = $scope.hasPasscode;\n      } else if(credential == PrivilegesManager.CredentialAccountPassword) {\n        info[\"availability\"] = $scope.hasAccount;\n      } else {\n        info[\"availability\"] = true;\n      }\n\n      return info;\n    }\n\n    $scope.displayInfoForAction = function(action) {\n      return privilegesManager.displayInfoForAction(action).label;\n    }\n\n    $scope.isCredentialRequiredForAction = function(action, credential) {\n      if(!$scope.privileges) {\n        return false;\n      }\n      return $scope.privileges.isCredentialRequiredForAction(action, credential);\n    }\n\n    $scope.clearSession = function() {\n      privilegesManager.clearSession().then(() => {\n        $scope.reloadPrivileges();\n      })\n    }\n\n    $scope.reloadPrivileges = async function() {\n      $scope.availableActions = privilegesManager.getAvailableActions();\n      $scope.availableCredentials = privilegesManager.getAvailableCredentials();\n      let sessionEndDate = await privilegesManager.getSessionExpirey();\n      $scope.sessionExpirey = sessionEndDate.toLocaleString();\n      $scope.sessionExpired = new Date() >= sessionEndDate;\n\n      $scope.credentialDisplayInfo = {};\n      for(let cred of $scope.availableCredentials) {\n        $scope.credentialDisplayInfo[cred] = $scope.displayInfoForCredential(cred);\n      }\n\n      privilegesManager.getPrivileges().then((privs) => {\n        $timeout(() => {\n          $scope.privileges = privs;\n        })\n      })\n    }\n\n    $scope.checkboxValueChanged = function(action, credential) {\n      $scope.privileges.toggleCredentialForAction(action, credential);\n      privilegesManager.savePrivileges();\n    }\n\n    $scope.reloadPrivileges();\n\n    $scope.cancel = function() {\n      $scope.dismiss();\n      $scope.onCancel && $scope.onCancel();\n    }\n  }\n}\n\nangular.module('app').directive('privilegesManagementModal', () => new PrivilegesManagementModal);\n;class RevisionPreviewModal {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/revision-preview-modal.html\";\n    this.scope = {\n      uuid: \"=\",\n      content: \"=\"\n    };\n  }\n\n  link($scope, el, attrs) {\n    $scope.el = el;\n  }\n\n  controller($scope, modelManager, syncManager, componentManager, $timeout) {\n    'ngInject';\n\n    $scope.dismiss = function() {\n      $scope.el.remove();\n      $scope.$destroy();\n    }\n\n    $scope.$on(\"$destroy\", function() {\n      if($scope.identifier) {\n        componentManager.deregisterHandler($scope.identifier);\n      }\n    });\n\n    $scope.note = new SFItem({content: $scope.content, content_type: \"Note\"});\n    // Set UUID to editoForNote can find proper editor,\n    // but then generate new uuid for note as not to save changes to original, if editor makes changes.\n    $scope.note.uuid = $scope.uuid;\n    let editorForNote = componentManager.editorForNote($scope.note);\n    $scope.note.uuid = SFJS.crypto.generateUUIDSync();\n\n    if(editorForNote) {\n      // Create temporary copy, as a lot of componentManager is uuid based,\n      // so might interfere with active editor. Be sure to copy only the content, as the\n      // top level editor object has non-copyable properties like .window, which cannot be transfered\n      let editorCopy = new SNComponent({content: editorForNote.content});\n      editorCopy.readonly = true;\n      editorCopy.lockReadonly = true;\n      $scope.identifier = editorCopy.uuid;\n\n      componentManager.registerHandler({identifier: $scope.identifier, areas: [\"editor-editor\"],\n        contextRequestHandler: (component) => {\n          if(component == $scope.editor) {\n            return $scope.note;\n          }\n        },\n        componentForSessionKeyHandler: (key) => {\n          if(key == $scope.editor.sessionKey) {\n            return $scope.editor;\n          }\n        }\n      });\n\n      $scope.editor = editorCopy;\n    }\n\n\n    $scope.restore = function(asCopy) {\n      if(!asCopy && !confirm(\"Are you sure you want to replace the current note's contents with what you see in this preview?\")) {\n        return;\n      }\n\n      var item;\n      if(asCopy) {\n        var contentCopy = Object.assign({}, $scope.content);\n        if(contentCopy.title) { contentCopy.title += \" (copy)\"; }\n        item = modelManager.createItem({content_type: \"Note\", content: contentCopy});\n        modelManager.addItem(item);\n      } else {\n        var uuid = $scope.uuid;\n        item = modelManager.findItem(uuid);\n        item.content = Object.assign({}, $scope.content);\n        // mapResponseItemsToLocalModels is async, but we don't need to wait here.\n        modelManager.mapResponseItemsToLocalModels([item], SFModelManager.MappingSourceRemoteActionRetrieved);\n      }\n\n      modelManager.setItemDirty(item, true);\n      syncManager.sync();\n\n      $scope.dismiss();\n    }\n  }\n}\n\nangular.module('app').directive('revisionPreviewModal', () => new RevisionPreviewModal);\n;class SessionHistoryMenu {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/session-history-menu.html\";\n    this.scope = {\n      item: \"=\"\n    };\n  }\n\n  controller($scope, modelManager, sessionHistory, actionsManager, $timeout) {\n    'ngInject';\n\n    $scope.diskEnabled = sessionHistory.diskEnabled;\n    $scope.autoOptimize = sessionHistory.autoOptimize;\n\n    $scope.reloadHistory = function() {\n      let history = sessionHistory.historyForItem($scope.item);\n      // make copy as not to sort inline\n      $scope.entries = history.entries.slice(0).sort((a, b) => {\n        return a.item.updated_at < b.item.updated_at ? 1 : -1;\n      })\n      $scope.history = history;\n    }\n\n    $scope.reloadHistory();\n\n    $scope.openRevision = function(revision) {\n      actionsManager.presentRevisionPreviewModal(revision.item.uuid, revision.item.content);\n    }\n\n    $scope.classForRevision = function(revision) {\n      var vector = revision.operationVector();\n      if(vector == 0) {\n        return \"default\";\n      } else if(vector == 1) {\n        return \"success\";\n      } else if(vector == -1) {\n        return \"danger\";\n      }\n    }\n\n    $scope.clearItemHistory = function() {\n      if(!confirm(\"Are you sure you want to delete the local session history for this note?\")) {\n        return;\n      }\n\n      sessionHistory.clearItemHistory($scope.item).then(() => {\n        $timeout(() => {\n          $scope.reloadHistory();\n        })\n      });\n    }\n\n    $scope.clearAllHistory = function() {\n      if(!confirm(\"Are you sure you want to delete the local session history for all notes?\")) {\n        return;\n      }\n\n      sessionHistory.clearAllHistory().then(() => {\n        $timeout(() => {\n          $scope.reloadHistory();\n        })\n      });\n    }\n\n    $scope.toggleDiskSaving = function() {\n      if(!sessionHistory.diskEnabled) {\n        if(!confirm(\"Are you sure you want to save history to disk? This will decrease general performance, especially as you type. You are advised to disable this feature if you experience any lagging.\")){\n          return;\n        }\n      }\n      sessionHistory.toggleDiskSaving().then(() => {\n        $timeout(() => {\n          $scope.diskEnabled = sessionHistory.diskEnabled;\n        })\n      });\n    }\n\n    $scope.toggleAutoOptimize = function() {\n      sessionHistory.toggleAutoOptimize().then(() => {\n        $timeout(() => {\n          $scope.autoOptimize = sessionHistory.autoOptimize;\n        })\n      });\n    }\n\n  }\n\n}\n\nangular.module('app').directive('sessionHistoryMenu', () => new SessionHistoryMenu);\n;class SyncResolutionMenu {\n\n  constructor() {\n    this.restrict = \"E\";\n    this.templateUrl = \"directives/sync-resolution-menu.html\";\n    this.scope = {\n      \"closeFunction\" : \"&\"\n    };\n  }\n\n  controller($scope, modelManager, syncManager, archiveManager, $timeout) {\n    'ngInject';\n\n    $scope.status = {};\n\n    $scope.close = function() {\n      $timeout(() => {\n        $scope.closeFunction()();\n      })\n    }\n\n    $scope.downloadBackup = function(encrypted) {\n      archiveManager.downloadBackup(encrypted);\n      $scope.status.backupFinished = true;\n    }\n\n    $scope.skipBackup = function() {\n      $scope.status.backupFinished = true;\n    }\n\n    $scope.performSyncResolution = function() {\n      $scope.status.resolving = true;\n      syncManager.resolveOutOfSync().then(() => {\n        $scope.status.resolving = false;\n        $scope.status.attemptedResolution = true;\n        if(syncManager.isOutOfSync()) {\n          $scope.status.fail = true;\n        } else {\n          $scope.status.success = true;\n        }\n      })\n    }\n  }\n}\n\nangular.module('app').directive('syncResolutionMenu', () => new SyncResolutionMenu);\n"]}